# 🧩 IEPON MCP 컴포넌트 설계

> **연결 문서**: [03_UI_UX_설계.md](./03_UI_UX_설계.md) | [06_상태_관리.md](./06_상태_관리.md) | [12_개발_가이드.md](./12_개발_가이드.md) | [08_환경_설정.md](./08_환경_설정.md) | [14_결제_설계.md](./14_결제_설계.md)

---

## 5.1 MCP 기반 컴포넌트 아키텍처

### 5.1.1 HTML + Alpine.js + MCP 프로젝트 구조
```
project/
├── pages/               # HTML 페이지 파일들
│   ├── dashboard.html   # 대시보드 페이지
│   ├── students.html    # 학생 관리 페이지
│   ├── education.html   # 교육 관리 페이지
│   └── admin.html       # 관리자 페이지
├── components/          # 재사용 가능한 HTML 컴포넌트
│   ├── common/          # 공통 컴포넌트 (버튼, 모달 등)
│   ├── forms/           # 폼 관련 컴포넌트
│   ├── layout/          # 레이아웃 컴포넌트 (헤더, 사이드바)
│   ├── student/         # 학생 관련 컴포넌트
│   ├── education/       # 교육 관련 컴포넌트
│   └── admin/           # 관리자 컴포넌트
├── assets/              # 정적 자원
│   ├── css/             # 스타일시트
│   ├── js/              # Alpine.js 스토어 및 유틸리티
│   └── images/          # 이미지 파일
├── data/                # 정적 데이터 파일
└── utils/               # 유틸리티 함수 (JavaScript)
```

### 5.1.2 Alpine.js + MCP 컴포넌트 설계 원칙
- **HTML 우선**: 모든 컴포넌트는 HTML부터 시작
- **x-data**: 컴포넌트 로컬 상태 관리
- **Alpine.store()**: 글로벌 상태 관리
- **window.mcp**: MCP 서버 연동 인터페이스
- **kebab-case**: HTML 속성 및 파일명
- **camelCase**: JavaScript 함수 및 변수명
- **UPPER_CASE**: 상수 및 설정값
- **MCP 연동**: AI 에이전트 기반 자동화 지원

### 5.1.3 MCP 기반 컴포넌트 포함 패턴
```html
<!-- MCP 서버 상태 확인 후 컴포넌트 로드 -->
<div x-data="{
  mcpReady: false,
  async init() {
    this.mcpReady = await window.checkMcpServerStatus();
    if (this.mcpReady) {
      // MCP 컴포넌트 초기화
      this.initMcpComponents();
    }
  },
  async initMcpComponents() {
    // Supabase MCP 연동 컴포넌트 초기화
    await this.loadSupabaseComponents();
    // Toss Payments MCP 연동 컴포넌트 초기화
    await this.loadPaymentComponents();
  }
}">
  <div id="mcp-components-container">
    <!-- MCP 기반 컴포넌트들이 여기에 로드됨 -->
  </div>
</div>

<!-- 또는 HTMX로 MCP 연동 컴포넌트 로드 -->
<div hx-get="/components/mcp/payment-widget.html" 
     hx-trigger="mcp-ready from:body" 
     hx-target="#payment-container"
     hx-vals='js:{mcpServer: "tosspayments-integration-guide"}'>
</div>
```

---

## 5.2 공통 컴포넌트

### 5.2.1 Button 컴포넌트 (`components/common/button.html`)
```html
<!-- Alpine.js Button 컴포넌트 -->
<div x-data="{
  variant: $el.dataset.variant || 'primary',
  size: $el.dataset.size || 'md',
  disabled: $el.dataset.disabled === 'true' || false,
  loading: false,
  text: $el.dataset.text || '버튼',
  
  // UTF-8 텍스트 검증
  validateUTF8(text) {
    try {
      const encoded = new TextEncoder().encode(text);
      const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
      return decoded === text;
    } catch (error) {
      console.error('UTF-8 인코딩 오류:', error);
      return false;
    }
  },
  
  // 버튼 클릭 핸들러
  handleClick() {
    if (this.disabled || this.loading) return;
    
    // 텍스트 UTF-8 검증
    if (!this.validateUTF8(this.text)) {
      console.error('버튼 텍스트 인코딩 오류');
      return;
    }
    
    this.loading = true;
    
    // 커스텀 이벤트 발송
    this.$dispatch('button-click', {
      variant: this.variant,
      size: this.size,
      text: this.text
    });
    
    // 로딩 상태 해제 (외부에서 제어 가능)
    setTimeout(() => {
      this.loading = false;
    }, 100);
  }
}">
  <button 
    type="button"
    :class="`btn btn-${variant} btn-${size} ${loading ? 'loading' : ''}`"
    :disabled="disabled || loading"
    @click="handleClick()"
    class="relative inline-flex items-center justify-center font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2"
  >
    <!-- 로딩 스피너 -->
    <div x-show="loading" class="absolute inset-0 flex items-center justify-center">
      <svg class="animate-spin h-4 w-4 text-current" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    </div>
    
    <!-- 버튼 텍스트 -->
    <span :class="{ 'opacity-0': loading, 'opacity-100': !loading }" 
          x-text="text">
    </span>
  </button>
</div>

<!-- CSS 스타일 (assets/css/components.css에 포함) -->
<style>
.btn {
  padding: 0.5rem 1rem;
  border-radius: 0.375rem;
  border: 1px solid;
  font-size: 0.875rem;
  font-weight: 500;
  transition: all 0.2s ease-in-out;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.btn-primary {
  background-color: #2563eb;
  color: #ffffff;
  border-color: #2563eb;
}

.btn-primary:hover {
  background-color: #1d4ed8;
}

.btn-primary:focus {
  outline: none;
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.5);
}

.btn-secondary {
  background-color: #4b5563;
  color: #ffffff;
  border-color: #4b5563;
}

.btn-secondary:hover {
  background-color: #374151;
}

.btn-secondary:focus {
  outline: none;
  box-shadow: 0 0 0 2px rgba(75, 85, 99, 0.5);
}

.btn-outline {
  background-color: transparent;
  color: #2563eb;
  border-color: #2563eb;
}

.btn-outline:hover {
  background-color: #eff6ff;
}

.btn-outline:focus {
  outline: none;
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.5);
}

.btn-ghost {
  background-color: transparent;
  color: #4b5563;
  border-color: transparent;
}

.btn-ghost:hover {
  background-color: #f3f4f6;
}

.btn-ghost:focus {
  outline: none;
  box-shadow: 0 0 0 2px rgba(75, 85, 99, 0.5);
}

.btn-sm {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
}

.btn-md {
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}

.btn-lg {
  padding: 0.75rem 1.5rem;
  font-size: 1rem;
}

.btn:disabled,
.btn.loading {
  opacity: 0.5;
  cursor: not-allowed;
}
</style>

<!-- 사용 예시 -->
<!-- 
<div hx-get="/components/common/button.html" 
     hx-trigger="load"
     data-variant="primary"
     data-size="md"
     data-text="저장하기"
     @button-click="handleSave($event.detail)">
</div>
-->
```

### 5.2.2 Modal 컴포넌트 (`components/common/modal.html`)
```html
<!-- Alpine.js Modal 컴포넌트 -->
<div x-data="{
  isOpen: false,
  title: $el.dataset.title || '모달',
  size: $el.dataset.size || 'md',
  
  // UTF-8 텍스트 검증
  validateUTF8(text) {
    try {
      const encoded = new TextEncoder().encode(text);
      const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
      return decoded === text;
    } catch (error) {
      console.error('UTF-8 인코딩 오류:', error);
      return false;
    }
  },
  
  // 모달 열기
  open(newTitle = null) {
    if (newTitle && this.validateUTF8(newTitle)) {
      this.title = newTitle;
    }
    this.isOpen = true;
    document.body.style.overflow = 'hidden';
    
    // 열기 이벤트 발송
    this.$dispatch('modal-opened', { title: this.title });
  },
  
  // 모달 닫기
  close() {
    this.isOpen = false;
    document.body.style.overflow = 'auto';
    
    // 닫기 이벤트 발송
    this.$dispatch('modal-closed', { title: this.title });
  },
  
  // ESC 키 핸들러
  handleKeydown(event) {
    if (event.key === 'Escape' && this.isOpen) {
      this.close();
    }
  }
}" 
@keydown.window="handleKeydown($event)"
@modal:open.window="open($event.detail?.title)"
@modal:close.window="close()">

  <!-- 모달 오버레이 -->
  <div x-show="isOpen" 
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition ease-in duration-200"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0"
       class="fixed inset-0 z-50 overflow-y-auto"
       style="display: none;">
    
    <!-- 배경 오버레이 -->
    <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity"
         @click="close()"></div>
    
    <!-- 모달 컨테이너 -->
    <div class="flex min-h-screen items-center justify-center p-4 text-center">
      <div x-show="isOpen"
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
           x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
           x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
           :class="`modal-content modal-${size}`"
           class="relative transform rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 sm:p-6"
           @click.stop>
        
        <!-- 모달 헤더 -->
        <div class="modal-header flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900" 
              x-text="title"></h3>
          <button type="button" 
                  @click="close()"
                  class="rounded-md bg-white text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <span class="sr-only">닫기</span>
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        
        <!-- 모달 본문 -->
        <div class="modal-body">
          <!-- 동적 컨텐츠가 HTMX로 로드됩니다 -->
          <div id="modal-content" 
               hx-trigger="modal-opened from:body"
               hx-get=""
               hx-target="this">
            <!-- 기본 내용 또는 로딩 스피너 -->
            <div class="flex items-center justify-center py-8">
              <svg class="animate-spin h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <span class="ml-2 text-gray-600">로딩 중...</span>
            </div>
          </div>
        </div>
        
        <!-- 모달 푸터 (선택적) -->
        <div class="modal-footer mt-6 flex justify-end space-x-3">
          <button type="button" 
                  @click="close()"
                  class="btn btn-outline btn-md">
            취소
          </button>
          <!-- 추가 액션 버튼들은 동적으로 추가 -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CSS 스타일 -->
<style>
.modal-sm {
  max-width: 24rem; /* 384px */
}

.modal-md {
  max-width: 32rem; /* 512px */
}

.modal-lg {
  max-width: 42rem; /* 672px */
}

.modal-xl {
  max-width: 56rem; /* 896px */
}

.modal-content {
  width: 100%;
}
</style>

<!-- 사용 예시 -->
<!-- 
모달 트리거:
<button @click="$dispatch('modal:open', { title: '학생 추가' })" 
        hx-get="/components/student/student-form.html"
        hx-target="#modal-content">
  학생 추가
</button>

모달 닫기:
<button @click="$dispatch('modal:close')">
  닫기
</button>
-->
```

---

## 5.3 폼 컴포넌트

### 5.3.1 FormField 컴포넌트 (`components/forms/form-field.html`)
```html
<!-- Alpine.js FormField 컴포넌트 -->
<div x-data="{
  label: $el.dataset.label || '레이블',
  name: $el.dataset.name || 'field',
  type: $el.dataset.type || 'text',
  value: $el.dataset.value || '',
  error: '',
  required: $el.dataset.required === 'true',
  placeholder: $el.dataset.placeholder || '',
  
  // UTF-8 인코딩 검증
  validateUTF8(text) {
    try {
      const encoded = new TextEncoder().encode(text);
      const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
      return decoded === text;
    } catch (error) {
      return false;
    }
  },
  
  // 입력 유효성 검사
  validateInput(value) {
    if (!this.validateUTF8(value)) {
      return '올바르지 않은 문자가 포함되어 있습니다.';
    }
    
    if (this.required && !value.trim()) {
      return `${this.label}은 필수 항목입니다.`;
    }
    
    return null;
  },
  
  // 입력 핸들러
  handleInput(event) {
    this.value = event.target.value;
    this.error = this.validateInput(this.value) || '';
    
    this.$dispatch('form-field-change', {
      name: this.name,
      value: this.value,
      valid: !this.error
    });
  }
}" class="form-field">
  
  <label :for="name" class="block text-sm font-medium text-gray-700 mb-1">
    <span x-text="label"></span>
    <span x-show="required" class="text-red-500 ml-1">*</span>
  </label>
  
  <input :id="name"
         :name="name"
         :type="type"
         :value="value"
         :placeholder="placeholder"
         :required="required"
         :class="error ? 'border-red-300' : 'border-gray-300'"
         @input="handleInput($event)"
         class="mt-1 block w-full rounded-md border px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1"
  />
  
  <div x-show="error" class="mt-1 text-sm text-red-600" x-text="error"></div>
</div>
```

### 5.3.2 Select 컴포넌트 (`components/forms/select-field.html`)
```html
<!-- Alpine.js Select 컴포넌트 -->
<div x-data="{
  label: $el.dataset.label || '선택',
  name: $el.dataset.name || 'select',
  value: $el.dataset.value || '',
  error: '',
  required: $el.dataset.required === 'true',
  placeholder: $el.dataset.placeholder || '선택해주세요',
  options: [],
  
  // 초기화
  init() {
    const optionsData = this.$el.dataset.options;
    if (optionsData) {
      try {
        this.options = JSON.parse(optionsData);
      } catch (error) {
        console.error('옵션 데이터 파싱 오류:', error);
        this.options = [];
      }
    }
  },
  
  // UTF-8 검증
  validateUTF8(text) {
    try {
      const encoded = new TextEncoder().encode(text);
      const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
      return decoded === text;
    } catch (error) {
      return false;
    }
  },
  
  // 선택 유효성 검사
  validateSelection(value) {
    if (this.required && !value) {
      return `${this.label}을 선택해주세요.`;
    }
    return null;
  },
  
  // 선택 변경 핸들러
  handleChange(event) {
    this.value = event.target.value;
    this.error = this.validateSelection(this.value) || '';
    
    const selectedOption = this.options.find(opt => opt.value === this.value);
    
    this.$dispatch('select-change', {
      name: this.name,
      value: this.value,
      selectedOption: selectedOption,
      valid: !this.error
    });
  }
}" class="form-field">
  
  <label :for="name" class="block text-sm font-medium text-gray-700 mb-1">
    <span x-text="label"></span>
    <span x-show="required" class="text-red-500 ml-1">*</span>
  </label>
  
  <div class="relative">
    <select :id="name"
            :name="name"
            :value="value"
            :required="required"
            :class="error ? 'border-red-300' : 'border-gray-300'"
            @change="handleChange($event)"
            class="mt-1 block w-full rounded-md border px-3 py-2 text-sm bg-white shadow-sm focus:outline-none focus:ring-1">
      
      <option x-show="placeholder" value="" x-text="placeholder"></option>
      
      <template x-for="option in options" :key="option.value">
        <option :value="option.value" 
                :selected="value === option.value"
                x-text="option.label">
        </option>
      </template>
    </select>
    
    <!-- 드롭다운 화살표 -->
    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
      <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
      </svg>
    </div>
  </div>
  
  <div x-show="error" class="mt-1 text-sm text-red-600" x-text="error"></div>
</div>

<!-- 사용 예시 -->
<!-- 
<div hx-get="/components/forms/select-field.html"
     hx-trigger="load"
     data-label="학년"
     data-name="grade"
     data-required="true"
     data-placeholder="학년을 선택하세요"
     data-options='[{"value":"1","label":"1학년"},{"value":"2","label":"2학년"}]'
     @select-change="handleGradeChange($event.detail)">
</div>
-->
```

### 5.3.3 폼 유효성 검사 유틸리티 (`assets/js/form-utils.js`)
```javascript
// Alpine.js 폼 유틸리티 함수
window.FormUtils = {
  // UTF-8 인코딩 검증
  validateUTF8(text) {
    try {
      const encoded = new TextEncoder().encode(text);
      const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
      return decoded === text;
    } catch (error) {
      return false;
    }
  },
  
  // 이메일 유효성 검사
  validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  },
  
  // 폼 데이터 수집
  collectFormData(formElement) {
    const formData = new FormData(formElement);
    const data = {};
    
    for (let [key, value] of formData.entries()) {
      if (this.validateUTF8(value)) {
        data[key] = value;
      } else {
        console.error(`UTF-8 오류: ${key} 필드`);
      }
    }
    
    return data;
  },
  
  // HTMX로 폼 제출
  submitForm(formElement, endpoint) {
    const data = this.collectFormData(formElement);
    
    // HTMX 제출
    htmx.ajax('POST', endpoint, {
      values: data,
      target: '#form-response',
      swap: 'innerHTML'
    });
  }
};

// Alpine.js 글로벌 스토어
Alpine.store('formValidation', {
  forms: {},
  
  // 폼 등록
  registerForm(formId) {
    this.forms[formId] = {
      fields: {},
      isValid: false,
      errors: {}
    };
  },
  
  // 필드 업데이트
  updateField(formId, fieldName, value, error = null) {
    if (!this.forms[formId]) this.registerForm(formId);
    
    this.forms[formId].fields[fieldName] = value;
    
    if (error) {
      this.forms[formId].errors[fieldName] = error;
    } else {
      delete this.forms[formId].errors[fieldName];
    }
    
    // 전체 폼 유효성 업데이트
    this.forms[formId].isValid = Object.keys(this.forms[formId].errors).length === 0;
  },
  
  // 폼 유효성 확인
  isFormValid(formId) {
    return this.forms[formId]?.isValid || false;
  },
  
  // 폼 리셋
  resetForm(formId) {
    if (this.forms[formId]) {
      this.forms[formId] = {
        fields: {},
        isValid: false,
        errors: {}
      };
    }
  }
});
```

---

## 5.4 학생 관련 컴포넌트

### 5.4.1 StudentForm 컴포넌트 (`components/student/student-form.html`)
```html
<div x-data="{
  student: $store.students.selectedStudent,
  formData: {
    name: '',
    birth_date: '',
    school_name: '',
    grade: '',
    gender: '',
    parent_phone: '',
    address: '',
    medical_info: ''
  },
  errors: {},
  isSubmitting: false,
  
  init() {
    if (this.student) {
      this.formData = { ...this.student };
    }
  },
  
  validateField(fieldName, value) {
    if (!FormUtils.validateUTF8(value)) {
      return '올바른 텍스트 형식이 아닙니다.';
    }
    
    switch(fieldName) {
      case 'name':
        return !value ? '학생 이름을 입력해주세요.' : null;
      case 'birth_date':
        return !value ? '생년월일을 입력해주세요.' : null;
      case 'school_name':
        return !value ? '학교명을 입력해주세요.' : null;
      default:
        return null;
    }
  },
  
  async submitForm() {
    this.isSubmitting = true;
    this.errors = {};
    
    // 전체 폼 유효성 검사
    for (let [key, value] of Object.entries(this.formData)) {
      const error = this.validateField(key, value);
      if (error) this.errors[key] = error;
    }
    
    if (Object.keys(this.errors).length > 0) {
      this.isSubmitting = false;
      return;
    }
    
    try {
      if (this.student?.id) {
        await $store.students.updateStudent(this.student.id, this.formData);
      } else {
        await $store.students.addStudent(this.formData);
      }
      
      this.$dispatch('student-form-success', { 
        action: this.student?.id ? 'update' : 'create',
        student: this.formData 
      });
    } catch (error) {
      this.$dispatch('student-form-error', { error });
    } finally {
      this.isSubmitting = false;
    }
  }
}" class="student-form">
  
  <form @submit.prevent="submitForm()" class="space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      
      <!-- 학생 이름 -->
      <div class="form-field">
        <label class="block text-sm font-medium text-gray-700 mb-1">
          학생 이름 <span class="text-red-500">*</span>
        </label>
        <input type="text" 
               x-model="formData.name"
               :class="errors.name ? 'border-red-300' : 'border-gray-300'"
               @blur="errors.name = validateField('name', formData.name)"
               class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-1"
               placeholder="학생 이름을 입력하세요">
        <div x-show="errors.name" x-text="errors.name" class="mt-1 text-sm text-red-600"></div>
      </div>
      
      <!-- 생년월일 -->
      <div class="form-field">
        <label class="block text-sm font-medium text-gray-700 mb-1">
          생년월일 <span class="text-red-500">*</span>
        </label>
        <input type="date" 
               x-model="formData.birth_date"
               :class="errors.birth_date ? 'border-red-300' : 'border-gray-300'"
               @blur="errors.birth_date = validateField('birth_date', formData.birth_date)"
               class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-1">
        <div x-show="errors.birth_date" x-text="errors.birth_date" class="mt-1 text-sm text-red-600"></div>
      </div>
      
    </div>
    
    <div class="form-actions flex justify-end space-x-3">
      <button type="button" 
              @click="$dispatch('student-form-cancel')"
              class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
        취소
      </button>
      
      <button type="submit" 
              :disabled="isSubmitting"
              :class="isSubmitting ? 'opacity-50 cursor-not-allowed' : ''"
              class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
        <span x-show="!isSubmitting">저장</span>
        <span x-show="isSubmitting">저장 중...</span>
      </button>
    </div>
  </form>
</div>

<!-- HTMX 사용 예시 -->
<!-- 
<div hx-get="/components/student/student-form.html"
     hx-trigger="load"
     @student-form-success="handleStudentSuccess($event.detail)"
     @student-form-error="handleStudentError($event.detail)"
     @student-form-cancel="closeStudentForm()">
</div>
-->
```

### 5.4.2 StudentList 컴포넌트 (`components/student/student-list.html`)
```html
<div x-data="{
  students: $store.students.students || [],
  isLoading: $store.students.isLoading,
  
  editStudent(student) {
    $store.students.setSelectedStudent(student);
    this.$dispatch('student-edit', { student });
  },
  
  async deleteStudent(studentId) {
    if (confirm('정말로 이 학생을 삭제하시겠습니까?')) {
      try {
        await $store.students.deleteStudent(studentId);
        this.$dispatch('student-deleted', { studentId });
      } catch (error) {
        this.$dispatch('student-delete-error', { error });
      }
    }
  }
}" class="student-list">
  
  <div x-show="isLoading" class="flex justify-center py-8">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
  </div>
  
  <div x-show="!isLoading && students.length === 0" class="text-center py-8 text-gray-500">
    등록된 학생이 없습니다.
  </div>
  
  <div x-show="!isLoading && students.length > 0" class="grid gap-4">
    <template x-for="student in students" :key="student.id">
      <div class="student-card bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
        <div class="flex justify-between items-start">
          
          <div class="student-info flex-1">
            <h3 class="text-lg font-semibold text-gray-900" x-text="student.name"></h3>
            <div class="mt-1 text-sm text-gray-600">
              <span x-text="student.school_name"></span>
              <span x-text="student.grade + '학년'"></span>
            </div>
            
            <div class="mt-2 text-xs text-gray-500">
              <span>생년월일: </span>
              <span x-text="student.birth_date"></span>
            </div>
            
            <div x-show="student.parent_phone" class="mt-1 text-xs text-gray-500">
              <span>연락처: </span>
              <span x-text="student.parent_phone"></span>
            </div>
          </div>
          
          <div class="student-actions flex space-x-2">
            <button @click="editStudent(student)"
                    class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
              수정
            </button>
            
            <button @click="deleteStudent(student.id)"
                    class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
              삭제
            </button>
          </div>
          
        </div>
      </div>
    </template>
  </div>
</div>

<!-- HTMX 사용 예시 -->
<!-- 
<div hx-get="/components/student/student-list.html"
     hx-trigger="load, student-updated from:body"
     @student-edit="openStudentEdit($event.detail.student)"
     @student-deleted="refreshStudentList()"
     @student-delete-error="showDeleteError($event.detail.error)">
</div>
-->
```

---

---

## 5.5 교육 관련 컴포넌트

### 5.5.1 Calendar 컴포넌트 (`components/education/calendar.html`)
```html
<div x-data="{
  currentDate: new Date(),
  events: $store.education.monthlyPlans || [],
  selectedDate: null,
  
  // 월 포맷팅
  formatMonth(date) {
    return date.toLocaleDateString('ko-KR', { 
      year: 'numeric', 
      month: 'long' 
    });
  },
  
  // 달력 내비게이션
  navigateMonth(direction) {
    const newDate = new Date(this.currentDate);
    newDate.setMonth(newDate.getMonth() + direction);
    this.currentDate = newDate;
    this.loadMonthEvents();
  },
  
  // 달력 날짜 생성
  generateCalendarDays() {
    const year = this.currentDate.getFullYear();
    const month = this.currentDate.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    const days = [];
    for (let i = 0; i < 42; i++) {
      const date = new Date(startDate);
      date.setDate(startDate.getDate() + i);
      days.push(date);
    }
    return days;
  },
  
  // 날짜별 이벤트 조회
  getEventsForDate(date) {
    const dateString = date.toISOString().split('T')[0];
    return this.events.filter(event => 
      event.plan_date && event.plan_date.startsWith(dateString)
    );
  },
  
  // 날짜 클릭 핸들러
  handleDateClick(date) {
    this.selectedDate = date;
    this.$dispatch('calendar-date-click', { 
      date: date,
      events: this.getEventsForDate(date)
    });
  },
  
  // 이벤트 클릭 핸들러
  handleEventClick(event) {
    this.$dispatch('calendar-event-click', { event });
  },
  
  // 월별 이벤트 로드
  async loadMonthEvents() {
    const year = this.currentDate.getFullYear();
    const month = this.currentDate.getMonth() + 1;
    await $store.education.fetchMonthlyPlans(year, month);
  },
  
  // 초기화
  init() {
    this.loadMonthEvents();
  }
}" class="calendar bg-white rounded-lg shadow">
  
  <!-- 월 헤더 -->
  <div class="calendar-header flex items-center justify-between p-4 border-b">
    <button @click="navigateMonth(-1)" 
            class="px-3 py-2 text-gray-600 hover:bg-gray-100 rounded">
      ← 이전
    </button>
    
    <h2 class="text-lg font-semibold text-gray-900" 
        x-text="formatMonth(currentDate)"></h2>
    
    <button @click="navigateMonth(1)" 
            class="px-3 py-2 text-gray-600 hover:bg-gray-100 rounded">
      다음 →
    </button>
  </div>
  
  <!-- 요일 헤더 -->
  <div class="grid grid-cols-7 border-b">
    <template x-for="day in ['일', '월', '화', '수', '목', '금', '토']">
      <div class="p-2 text-center text-sm font-medium text-gray-700 bg-gray-50" 
           x-text="day"></div>
    </template>
  </div>
  
  <!-- 달력 그리드 -->
  <div class="calendar-grid grid grid-cols-7">
    <template x-for="(day, index) in generateCalendarDays()" :key="index">
      <div class="calendar-day border-r border-b h-24 p-1 cursor-pointer hover:bg-gray-50"
           :class="{
             'bg-gray-100': day.getMonth() !== currentDate.getMonth(),
             'bg-blue-50': selectedDate && day.toDateString() === selectedDate.toDateString()
           }"
           @click="handleDateClick(day)">
        
        <div class="flex justify-between items-start h-full">
          <span class="text-sm" 
                :class="day.getMonth() !== currentDate.getMonth() ? 'text-gray-400' : 'text-gray-900'"
                x-text="day.getDate()"></span>
        </div>
        
        <!-- 날짜별 이벤트 -->
        <template x-for="event in getEventsForDate(day).slice(0, 2)">
          <div class="text-xs bg-blue-100 text-blue-800 px-1 rounded mt-1 truncate"
               @click.stop="handleEventClick(event)"
               x-text="event.activity_name">
          </div>
        </template>
        
        <!-- 더 많은 이벤트 표시 -->
        <div x-show="getEventsForDate(day).length > 2" 
             class="text-xs text-gray-500 mt-1"
             x-text="'+' + (getEventsForDate(day).length - 2) + '개'"></div>
      </div>
    </template>
  </div>
</div>

<!-- HTMX 사용 예시 -->
<!-- 
<div hx-get="/components/education/calendar.html"
     hx-trigger="load"
     @calendar-date-click="showDateEvents($event.detail)"
     @calendar-event-click="showEventDetail($event.detail.event)">
</div>
-->
```

### 5.5.2 QuickLinksGrid 컴포넌트 (`components/education/quick-links-grid.html`)
```html
<div x-data="{
  tools: [],
  isLoading: false,
  
  // 초기화
  async init() {
    this.isLoading = true;
    try {
      await this.loadQuickLinks();
    } catch (error) {
      console.error('빠른 링크 로드 오류:', error);
    } finally {
      this.isLoading = false;
    }
  },
  
  // 빠른 링크 로드
  async loadQuickLinks() {
    try {
      const response = await fetch('/api/quick-links');
      const data = await response.json();
      
      if (data.success) {
        this.tools = data.data;
      } else {
        throw new Error(data.error?.message || '데이터 로드 실패');
      }
    } catch (error) {
      this.$dispatch('quick-links-error', { error: error.message });
    }
  },
  
  // 도구 클릭 핸들러
  handleToolClick(tool) {
    // UTF-8 안전성 검사
    if (!FormUtils.validateUTF8(tool.title)) {
      this.$dispatch('tool-click-error', { 
        error: '도구 이름에 오류가 있습니다.' 
      });
      return;
    }
    
    this.$dispatch('quick-link-click', { 
      tool: tool,
      timestamp: new Date().toISOString()
    });
    
    // 도구 사용 통계 업데이트
    this.updateToolUsage(tool.id);
  },
  
  // 도구 사용 통계 업데이트
  async updateToolUsage(toolId) {
    try {
      await fetch('/api/quick-links/usage', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ tool_id: toolId })
      });
    } catch (error) {
      console.error('도구 사용 통계 업데이트 실패:', error);
    }
  }
}" class="education-tools-container">
  
  <!-- 로딩 상태 -->
  <div x-show="isLoading" class="flex justify-center items-center py-12">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    <span class="ml-2 text-gray-600">빠른 링크 로드 중...</span>
  </div>
  
  <!-- 빠른 링크 그리드 -->
  <div x-show="!isLoading && tools.length > 0" 
       class="education-tools-grid grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-4">
    
    <template x-for="tool in tools" :key="tool.id">
      <div class="tool-button group cursor-pointer transform transition-transform hover:scale-105"
           :style="'background: linear-gradient(135deg, ' + tool.color + ', ' + tool.color + '90)'"
           @click="handleToolClick(tool)"
           :title="tool.description">
        
        <div class="tool-card bg-white bg-opacity-90 backdrop-blur-sm rounded-lg p-4 h-32 flex flex-col items-center justify-center text-center shadow-sm group-hover:shadow-md transition-shadow">
          
          <!-- 도구 아이콘 -->
          <div class="tool-icon text-3xl mb-2" x-html="tool.icon"></div>
          
          <!-- 도구 제목 -->
          <div class="tool-title text-sm font-medium text-gray-800" 
               x-text="tool.title"></div>
          
          <!-- 사용 횟수 -->
          <div x-show="tool.usage_count" 
               class="text-xs text-gray-500 mt-1"
               x-text="tool.usage_count + '회 사용'"></div>
          
        </div>
      </div>
    </template>
    
  </div>
  
  <!-- 비어있을 때 -->
  <div x-show="!isLoading && tools.length === 0" 
       class="text-center py-12 text-gray-500">
    <div class="text-lg mb-2">학종 도구</div>
    <p>등록된 빠른 링크가 없습니다.</p>
  </div>
  
</div>

<!-- HTMX 사용 예시 -->
<!-- 
<div hx-get="/components/education/quick-links-grid.html"
     hx-trigger="load"
     @quick-link-click="handleQuickLinkAction($event.detail)"
     @quick-links-error="showQuickLinksError($event.detail.error)"
     @tool-click-error="showToolError($event.detail.error)">
</div>
-->
```

---

---

## 5.6 교육과정 관리 컴포넌트

> **Alpine.js Store 연돐**: 본 절의 모든 교육과정 컴포넌트는 상태 관리를 위해 [06_상태_관리.md](./06_상태_관리.md)에서 정의한 `Alpine.store('curriculum')` 스토어를 사용합니다. 예시 코드에서 `$store.curriculum.units`, `$store.curriculum.fetchUnits()` 형태로 호출하여 HTMX + Alpine.js 패턴의 일관성을 유지합니다.

### 5.6.1 CurriculumUpload 컴포넌트 (`components/curriculum/curriculum-upload.html`)
```html
<div x-data="{
  uploadMethod: 'manual',
  formData: {
    subject: '',
    grade: null,
    semester: null,
    units: []
  },
  isUploading: false,
  uploadProgress: 0,
  errors: {},
  
  // 파일 업로드 관련
  selectedFile: null,
  dragOver: false,
  
  // 초기화
  init() {
    this.resetForm();
  },
  
  // 폼 리셋
  resetForm() {
    this.formData = {
      subject: '',
      grade: null,
      semester: null,
      units: []
    };
    this.errors = {};
    this.selectedFile = null;
  },
  
  // 폼 유효성 검사
  validateForm() {
    const errors = {};
    
    if (!this.formData.subject) {
      errors.subject = '과목을 선택해주세요.';
    }
    if (!this.formData.grade) {
      errors.grade = '학년을 선택해주세요.';
    }
    if (!this.formData.semester) {
      errors.semester = '학기를 선택해주세요.';
    }
    
    if (this.uploadMethod === 'manual' && this.formData.units.length === 0) {
      errors.units = '최소 1개 이상의 교육과정 단위를 추가해주세요.';
    }
    
    if (this.uploadMethod === 'excel' && !this.selectedFile) {
      errors.file = '업로드할 파일을 선택해주세요.';
    }
    
    this.errors = errors;
    return Object.keys(errors).length === 0;
  },
  
  // UTF-8 파일 검증
  async validateFileUTF8(file) {
    try {
      const encoder = new TextEncoder();
      const decoder = new TextDecoder('utf-8', { fatal: true });
      
      // 파일명 UTF-8 검증
      const encodedFileName = encoder.encode(file.name);
      decoder.decode(encodedFileName);
      
      // 텍스트 파일인 경우 내용 검증
      if (file.type.startsWith('text/') || 
          file.name.endsWith('.txt') || 
          file.name.endsWith('.csv') || 
          file.name.endsWith('.xlsx')) {
        if (file.name.endsWith('.xlsx')) {
          return { valid: true }; // Excel 파일은 바이너리이므로 별도 처리
        }
        
        const text = await file.text();
        const encodedText = encoder.encode(text);
        decoder.decode(encodedText);
      }
      
      return { valid: true };
    } catch (error) {
      return { 
        valid: false, 
        error: '파일에 올바르지 않은 UTF-8 문자가 포함되어 있습니다.' 
      };
    }
  },
  
  // 수동 업로드 처리
  async handleManualUpload() {
    if (!this.validateForm()) return;
    
    this.isUploading = true;
    this.uploadProgress = 0;
    
    try {
      // 진행률 시뮬레이션
      const progressInterval = setInterval(() => {
        if (this.uploadProgress < 90) {
          this.uploadProgress += Math.random() * 20;
        }
      }, 100);
      
      const response = await $store.curriculum.uploadUnits(this.formData);
      
      clearInterval(progressInterval);
      this.uploadProgress = 100;
      
      if (response.success) {
        this.$dispatch('curriculum-upload-success', {
          method: 'manual',
          data: response.data
        });
        this.resetForm();
      } else {
        throw new Error(response.error?.message || '업로드 실패');
      }
    } catch (error) {
      this.$dispatch('curriculum-upload-error', {
        error: error.message
      });
    } finally {
      this.isUploading = false;
      this.uploadProgress = 0;
    }
  },
  
  // 파일 업로드 처리
  async handleFileUpload() {
    if (!this.validateForm() || !this.selectedFile) return;
    
    this.isUploading = true;
    this.uploadProgress = 0;
    
    try {
      // UTF-8 검증
      const validation = await this.validateFileUTF8(this.selectedFile);
      if (!validation.valid) {
        throw new Error(validation.error);
      }
      
      // 파일 크기 검증 (10MB)
      const maxSize = 10 * 1024 * 1024;
      if (this.selectedFile.size > maxSize) {
        throw new Error('파일 크기가 10MB를 초과합니다.');
      }
      
      const formData = new FormData();
      formData.append('file', this.selectedFile);
      formData.append('subject', this.formData.subject);
      formData.append('grade', this.formData.grade.toString());
      formData.append('semester', this.formData.semester.toString());
      
      const response = await $store.curriculum.uploadExcelFile(formData);
      
      if (response.success) {
        this.uploadProgress = 100;
        this.$dispatch('curriculum-upload-success', {
          method: 'excel',
          data: response.data
        });
        this.resetForm();
      } else {
        throw new Error(response.error?.message || '업로드 실패');
      }
    } catch (error) {
      this.$dispatch('curriculum-upload-error', {
        error: error.message
      });
    } finally {
      this.isUploading = false;
      this.uploadProgress = 0;
    }
  },
  
  // 파일 선택 핸들러
  handleFileSelect(event) {
    const file = event.target.files[0];
    this.selectedFile = file;
    
    if (file && this.errors.file) {
      delete this.errors.file;
    }
  },
  
  // 드래그 앤 드롭 핸들러
  handleDrop(event) {
    event.preventDefault();
    this.dragOver = false;
    
    const files = event.dataTransfer.files;
    if (files.length > 0) {
      this.selectedFile = files[0];
      if (this.errors.file) {
        delete this.errors.file;
      }
    }
  }
}" class="curriculum-upload max-w-4xl mx-auto p-6 space-y-6">
  
  <div class="bg-white rounded-lg shadow p-6">
    <h2 class="text-2xl font-bold mb-6">교육과정 업로드</h2>
    
    <!-- 업로드 방식 선택 -->
    <div class="mb-6">
      <label class="block text-sm font-semibold text-gray-700 mb-3">
        업로드 방식 선택
      </label>
      <div class="flex space-x-4">
        <button type="button"
                @click="uploadMethod = 'manual'"
                :class="uploadMethod === 'manual' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'"
                class="px-4 py-2 rounded-md font-medium transition-colors">
          직접 입력
        </button>
        <button type="button"
                @click="uploadMethod = 'excel'"
                :class="uploadMethod === 'excel' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'"
                class="px-4 py-2 rounded-md font-medium transition-colors">
          Excel 업로드
        </button>
      </div>
    </div>
    
    <!-- 기본 정보 입력 -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="form-field">
        <label class="block text-sm font-medium text-gray-700 mb-1">
          과목 <span class="text-red-500">*</span>
        </label>
        <select x-model="formData.subject"
                :class="errors.subject ? 'border-red-300' : 'border-gray-300'"
                class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-1">
          <option value="">과목 선택</option>
          <option value="국어">국어</option>
          <option value="수학">수학</option>
        </select>
        <div x-show="errors.subject" x-text="errors.subject" class="mt-1 text-sm text-red-600"></div>
      </div>
      
      <div class="form-field">
        <label class="block text-sm font-medium text-gray-700 mb-1">
          학년 <span class="text-red-500">*</span>
        </label>
        <select x-model="formData.grade"
                :class="errors.grade ? 'border-red-300' : 'border-gray-300'"
                class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-1">
          <option value="">학년 선택</option>
          <option value="1">1학년</option>
          <option value="2">2학년</option>
          <option value="3">3학년</option>
          <option value="4">4학년</option>
          <option value="5">5학년</option>
          <option value="6">6학년</option>
        </select>
        <div x-show="errors.grade" x-text="errors.grade" class="mt-1 text-sm text-red-600"></div>
      </div>
      
      <div class="form-field">
        <label class="block text-sm font-medium text-gray-700 mb-1">
          학기 <span class="text-red-500">*</span>
        </label>
        <select x-model="formData.semester"
                :class="errors.semester ? 'border-red-300' : 'border-gray-300'"
                class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-1">
          <option value="">학기 선택</option>
          <option value="1">1학기</option>
          <option value="2">2학기</option>
        </select>
        <div x-show="errors.semester" x-text="errors.semester" class="mt-1 text-sm text-red-600"></div>
      </div>
    </div>
    
    <!-- Excel 업로드 섹션 -->
    <div x-show="uploadMethod === 'excel'" class="space-y-4">
      <div class="border-2 border-dashed border-gray-300 rounded-lg p-6"
           :class="dragOver ? 'border-blue-500 bg-blue-50' : ''"
           @dragover.prevent="dragOver = true"
           @dragleave="dragOver = false"
           @drop="handleDrop($event)">
        
        <div class="text-center">
          <div class="mb-4">
            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
              <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          
          <div x-show="!selectedFile">
            <p class="text-lg mb-2">Excel 파일을 여기에 드래그하거나</p>
            <label class="cursor-pointer">
              <span class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                파일 선택
              </span>
              <input type="file" 
                     accept=".xlsx,.xls,.csv"
                     @change="handleFileSelect($event)"
                     class="hidden">
            </label>
          </div>
          
          <div x-show="selectedFile" class="text-green-600">
            <p class="font-medium" x-text="'선택된 파일: ' + (selectedFile?.name || '')"></p>
            <p class="text-sm text-gray-500" x-text="selectedFile ? Math.round(selectedFile.size/1024) + 'KB' : ''"></p>
          </div>
        </div>
      </div>
      
      <div x-show="errors.file" x-text="errors.file" class="text-sm text-red-600"></div>
    </div>
    
    <!-- 업로드 진행률 -->
    <div x-show="isUploading" class="space-y-2">
      <div class="flex justify-between text-sm">
        <span>업로드 중...</span>
        <span x-text="Math.round(uploadProgress) + '%'"></span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
             :style="'width: ' + uploadProgress + '%'"></div>
      </div>
    </div>
    
    <!-- 업로드 버튼 -->
    <div class="flex justify-end space-x-3">
      <button type="button" 
              @click="resetForm()"
              :disabled="isUploading"
              class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 disabled:opacity-50">
        초기화
      </button>
      
      <button type="button"
              @click="uploadMethod === 'manual' ? handleManualUpload() : handleFileUpload()"
              :disabled="isUploading"
              class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50">
        <span x-show="!isUploading">업로드</span>
        <span x-show="isUploading">업로드 중...</span>
      </button>
    </div>
  </div>
</div>

<!-- HTMX 사용 예시 -->
<!-- 
<div hx-get="/components/curriculum/curriculum-upload.html"
     hx-trigger="load"
     @curriculum-upload-success="handleUploadSuccess($event.detail)"
     @curriculum-upload-error="handleUploadError($event.detail.error)">
</div>
-->

        </div>

        {/* 업로드 방식별 UI */}
        {uploadMethod === 'manual' && (
          <CurriculumManualInput
            units={units}
            onUnitsChange={setUnits}
            onUpload={handleManualUpload}
            isUploading={isUploading}
          />
        )}

        {uploadMethod === 'excel' && (
          <CurriculumExcelUpload
            onFileUpload={handleExcelUpload}
            isUploading={isUploading}
          />
        )}
      </div>
    </div>
  );
};
```

### 5.6.2 CurriculumUnitForm 컴포넌트
```html
<!-- 교육과정 단원 폼 컴포넌트 -->
<div class="curriculum-unit-form" 
     x-data="curriculumUnitForm()"
     x-init="initForm($el.dataset.unit ? JSON.parse($el.dataset.unit) : null)">
  
  <form @submit.prevent="handleSubmit()" class="space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- 단원 번호 -->
      <div class="form-group">
        <label for="unit_number" class="block text-sm font-semibold text-gray-700 mb-2">
          단원 번호 <span class="text-red-500">*</span>
        </label>
        <input 
          id="unit_number"
          type="number" 
          x-model.number="formData.unit_number"
          min="1" 
          max="20" 
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          style="min-height: 48px;"
        />
      </div>
      
      <!-- 단원명 -->
      <div class="form-group">
        <label for="unit_title" class="block text-sm font-semibold text-gray-700 mb-2">
          단원명 <span class="text-red-500">*</span>
        </label>
        <input 
          id="unit_title"
          type="text" 
          x-model="formData.unit_title"
          placeholder="예: 재미있는 낱말"
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          style="min-height: 48px;"
          @blur="validateUTF8(formData.unit_title, '단원명')"
        />
      </div>
    </div>

    <!-- 성취기준 -->
    <div class="form-group">
      <label class="block text-sm font-semibold text-gray-700 mb-2">
        성취기준 <span class="text-red-500">*</span>
      </label>
      <template x-for="(standard, index) in formData.achievement_standards" :key="index">
        <div class="flex items-center space-x-2 mb-2">
          <input
            type="text"
            x-model="formData.achievement_standards[index]"
            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            style="min-height: 48px;"
            placeholder="성취기준을 입력하세요"
            @blur="validateUTF8(formData.achievement_standards[index], '성취기준')"
          />
          <button
            type="button"
            @click="removeArrayItem('achievement_standards', index)"
            class="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
            style="min-height: 48px; min-width: 48px;"
          >
            삭제
          </button>
        </div>
      </template>
      <button
        type="button"
        @click="addArrayItem('achievement_standards')"
        class="px-4 py-2 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors"
        style="min-height: 48px;"
      >
        + 성취기준 추가
      </button>
    </div>

    <!-- 교육 내용 -->
    <div class="form-group">
      <h4 class="text-md font-semibold text-gray-700 mb-4">교육 내용</h4>
      
      <!-- 주요 주제 -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">주요 주제</label>
        <template x-for="(topic, index) in formData.educational_content.main_topics" :key="index">
          <div class="flex items-center space-x-2 mb-2">
            <input
              type="text"
              x-model="formData.educational_content.main_topics[index]"
              class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              style="min-height: 48px;"
              placeholder="주요 주제를 입력하세요"
              @blur="validateUTF8(formData.educational_content.main_topics[index], '주요 주제')"
            />
            <button
              type="button"
              @click="removeNestedArrayItem('educational_content', 'main_topics', index)"
              class="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
              style="min-height: 48px; min-width: 48px;"
            >
              삭제
            </button>
          </div>
        </template>
        <button
          type="button"
          @click="addNestedArrayItem('educational_content', 'main_topics')"
          class="px-4 py-2 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors"
          style="min-height: 48px;"
        >
          + 주제 추가
        </button>
      </div>
    </div>

    <!-- 액션 버튼 -->
    <div class="flex justify-end space-x-3 pt-4">
      <button 
        type="button" 
        @click="handleCancel()"
        class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
        style="min-height: 48px;"
      >
        취소
      </button>
      <button 
        type="submit" 
        :disabled="isSubmitting"
        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
        style="min-height: 48px;"
      >
        <span x-show="!isSubmitting" x-text="editingUnit ? '수정' : '추가'"></span>
        <span x-show="isSubmitting" class="flex items-center space-x-2">
          <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span>처리 중...</span>
        </span>
      </button>
    </div>
  </form>
</div>

<script>
function curriculumUnitForm() {
  return {
    // 폼 데이터
    formData: {
      unit_number: 1,
      unit_title: '',
      achievement_standards: [''],
      educational_content: {
        main_topics: [''],
        activities: [''],
        materials: [''],
        teaching_methods: ['']
      },
      evaluation_plan: {
        methods: [''],
        criteria: [''],
        tools: [''],
        frequency: ''
      }
    },
    
    // 상태
    isSubmitting: false,
    editingUnit: null,
    errors: {},
    
    // 초기화
    initForm(unit) {
      if (unit) {
        this.editingUnit = unit;
        this.formData = {
          unit_number: unit.unit_number || 1,
          unit_title: unit.unit_title || '',
          achievement_standards: unit.achievement_standards || [''],
          educational_content: unit.educational_content || {
            main_topics: [''],
            activities: [''],
            materials: [''],
            teaching_methods: ['']
          },
          evaluation_plan: unit.evaluation_plan || {
            methods: [''],
            criteria: [''],
            tools: [''],
            frequency: ''
          }
        };
      }
    },
    
    // UTF-8 검증 함수
    validateUTF8(text, fieldName) {
      if (!text) return true;
      
      try {
        const encoded = new TextEncoder().encode(text);
        const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
        return decoded === text;
      } catch (error) {
        console.error(`${fieldName} UTF-8 인코딩 오류:`, error);
        this.errors[fieldName] = 'UTF-8 인코딩 오류가 발생했습니다.';
        return false;
      }
    },
    
    // 배열 항목 추가
    addArrayItem(fieldName) {
      this.formData[fieldName].push('');
    },
    
    // 배열 항목 삭제
    removeArrayItem(fieldName, index) {
      if (this.formData[fieldName].length > 1) {
        this.formData[fieldName].splice(index, 1);
      }
    },
    
    // 중첩 배열 항목 추가
    addNestedArrayItem(parentField, childField) {
      this.formData[parentField][childField].push('');
    },
    
    // 중첩 배열 항목 삭제
    removeNestedArrayItem(parentField, childField, index) {
      if (this.formData[parentField][childField].length > 1) {
        this.formData[parentField][childField].splice(index, 1);
      }
    },
    
    // 폼 검증
    validateForm() {
      this.errors = {};
      
      if (!this.formData.unit_title?.trim()) {
        this.errors.unit_title = '단원명은 필수 입력 사항입니다.';
      }
      
      if (!this.formData.achievement_standards[0]?.trim()) {
        this.errors.achievement_standards = '최소 하나의 성취기준을 입력해주세요.';
      }
      
      // UTF-8 검증
      if (!this.validateUTF8(this.formData.unit_title, 'unit_title')) {
        return false;
      }
      
      return Object.keys(this.errors).length === 0;
    },
    
    // 폼 제출
    async handleSubmit() {
      if (!this.validateForm()) {
        alert('입력 내용을 다시 확인해주세요.');
        return;
      }
      
      this.isSubmitting = true;
      
      try {
        const method = this.editingUnit ? 'PUT' : 'POST';
        const url = this.editingUnit 
          ? `/api/curriculum-units/${this.editingUnit.id}`
          : '/api/curriculum-units';
        
        const response = await fetch(url, {
          method: method,
          headers: {
            'Content-Type': 'application/json; charset=utf-8',
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: JSON.stringify(this.formData)
        });
        
        if (response.ok) {
          const result = await response.json();
          
          // 성공 이벤트 발송
          this.$dispatch('curriculum-unit-saved', {
            unit: result.data,
            isEdit: !!this.editingUnit
          });
          
          alert(`교육과정 단원이 성공적으로 ${this.editingUnit ? '수정' : '추가'}되었습니다.`);
          
          // 폼 초기화
          if (!this.editingUnit) {
            this.resetForm();
          }
        } else {
          const error = await response.json();
          alert(error.message || '저장에 실패했습니다.');
        }
      } catch (error) {
        console.error('교육과정 단원 저장 오류:', error);
        alert('예상치 못한 오류가 발생했습니다.');
      } finally {
        this.isSubmitting = false;
      }
    },
    
    // 취소 처리
    handleCancel() {
      this.$dispatch('curriculum-unit-cancel');
    },
    
    // 폼 초기화
    resetForm() {
      this.formData = {
        unit_number: 1,
        unit_title: '',
        achievement_standards: [''],
        educational_content: {
          main_topics: [''],
          activities: [''],
          materials: [''],
          teaching_methods: ['']
        },
        evaluation_plan: {
          methods: [''],
          criteria: [''],
          tools: [''],
          frequency: ''
        }
      };
      this.editingUnit = null;
      this.errors = {};
    }
  };
}
</script>
```

### 5.6.3 CurriculumList 컴포넌트
```html
<!-- 교육과정 목록 컴포넌트 -->
<div class="curriculum-list" 
     x-data="curriculumList()"
     x-init="loadUnits()">
  
  <!-- 로딩 상태 -->
  <div x-show="isLoading" class="flex justify-center py-8">
    <svg class="animate-spin h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  </div>
  
  <!-- 빈 상태 -->
  <div x-show="!isLoading && units.length === 0" 
       class="text-center py-12 text-gray-500">
    <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
    </svg>
    <p class="text-lg font-medium mb-2">등록된 교육과정이 없습니다</p>
    <p class="text-sm">새로운 교육과정 단원을 추가해보세요.</p>
  </div>
  
  <!-- 교육과정 목록 -->
  <div x-show="!isLoading && units.length > 0" class="space-y-4">
    <template x-for="unit in filteredUnits" :key="unit.id">
      <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow">
        <!-- 헤더 -->
        <div class="flex justify-between items-start mb-4">
          <div class="flex-1">
            <h3 class="text-lg font-semibold text-gray-800" x-text="`${unit.unit_number}. ${unit.unit_title}`"></h3>
            <div class="text-sm text-gray-500 mt-1">
              <span x-text="unit.subject || '교과'"></span>
              <span class="mx-2">|</span>
              <span x-text="`${unit.grade || 0}학년 ${unit.semester || 0}학기`"></span>
              <span class="mx-2">|</span>
              <span x-text="formatDate(unit.created_at)"></span>
            </div>
          </div>
          
          <!-- 액션 버튼 -->
          <div class="flex space-x-2">
            <button
              @click="handleEdit(unit)"
              class="px-3 py-2 text-sm text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors"
              style="min-height: 40px;"
            >
              수정
            </button>
            <button
              @click="handleDelete(unit.id, unit.unit_title)"
              class="px-3 py-2 text-sm text-red-600 border border-red-600 rounded-lg hover:bg-red-50 transition-colors"
              style="min-height: 40px;"
            >
              삭제
            </button>
          </div>
        </div>
        
        <!-- 콘텐츠 그리드 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- 성취기준 -->
          <div>
            <h4 class="font-medium text-gray-700 mb-3 flex items-center">
              <svg class="w-4 h-4 mr-2 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              성취기준
            </h4>
            <div x-show="unit.achievement_standards && unit.achievement_standards.length > 0">
              <ul class="text-sm text-gray-600 space-y-2">
                <template x-for="(standard, index) in unit.achievement_standards" :key="index">
                  <li class="flex items-start" x-show="standard.trim()">
                    <span class="text-green-600 mr-2 mt-1 flex-shrink-0">•</span>
                    <span x-text="standard" class="break-words"></span>
                  </li>
                </template>
              </ul>
            </div>
            <div x-show="!unit.achievement_standards || unit.achievement_standards.length === 0" 
                 class="text-sm text-gray-400 italic">
              성취기준이 설정되지 않았습니다.
            </div>
          </div>
          
          <!-- 주요 내용 -->
          <div>
            <h4 class="font-medium text-gray-700 mb-3 flex items-center">
              <svg class="w-4 h-4 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              주요 내용
            </h4>
            <div x-show="unit.educational_content && unit.educational_content.main_topics && unit.educational_content.main_topics.length > 0">
              <div class="text-sm text-gray-600" x-text="formatTopics(unit.educational_content.main_topics)"></div>
            </div>
            <div x-show="!unit.educational_content || !unit.educational_content.main_topics || unit.educational_content.main_topics.length === 0" 
                 class="text-sm text-gray-400 italic">
              주요 내용이 설정되지 않았습니다.
            </div>
          </div>
        </div>
        
        <!-- 평가 계획 (접을 수 있는 섹션) -->
        <div x-show="unit.evaluation_plan && (unit.evaluation_plan.methods?.length > 0 || unit.evaluation_plan.criteria?.length > 0)" 
             class="mt-6 pt-4 border-t border-gray-200">
          <div x-data="{ expanded: false }">
            <button @click="expanded = !expanded" 
                    class="flex items-center justify-between w-full text-left">
              <h4 class="font-medium text-gray-700 flex items-center">
                <svg class="w-4 h-4 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                  <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                </svg>
                평가 계획
              </h4>
              <svg x-show="!expanded" class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
              <svg x-show="expanded" class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd"/>
              </svg>
            </button>
            <div x-show="expanded" x-transition class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div x-show="unit.evaluation_plan.methods?.length > 0">
                <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">평가 방법</span>
                <div class="mt-1 text-sm text-gray-600" x-text="unit.evaluation_plan.methods.filter(m => m.trim()).join(', ')"></div>
              </div>
              <div x-show="unit.evaluation_plan.criteria?.length > 0">
                <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">평가 기준</span>
                <div class="mt-1 text-sm text-gray-600" x-text="unit.evaluation_plan.criteria.filter(c => c.trim()).join(', ')"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>
  
  <!-- 페이지네이션 (선택적) -->
  <div x-show="totalPages > 1" class="flex justify-center mt-6">
    <nav class="flex items-center space-x-2">
      <button 
        @click="goToPage(currentPage - 1)"
        :disabled="currentPage === 1"
        class="px-3 py-2 text-sm text-gray-600 hover:text-blue-600 disabled:text-gray-300 disabled:cursor-not-allowed"
      >
        이전
      </button>
      
      <template x-for="page in visiblePages" :key="page">
        <button 
          @click="goToPage(page)"
          :class="page === currentPage ? 'bg-blue-600 text-white' : 'text-gray-600 hover:text-blue-600'"
          class="px-3 py-2 text-sm rounded-lg transition-colors"
          x-text="page"
        ></button>
      </template>
      
      <button 
        @click="goToPage(currentPage + 1)"
        :disabled="currentPage === totalPages"
        class="px-3 py-2 text-sm text-gray-600 hover:text-blue-600 disabled:text-gray-300 disabled:cursor-not-allowed"
      >
        다음
      </button>
    </nav>
  </div>
</div>

<script>
function curriculumList() {
  return {
    // 데이터
    units: [],
    filteredUnits: [],
    
    // 상태
    isLoading: false,
    error: null,
    
    // 페이지네이션
    currentPage: 1,
    itemsPerPage: 10,
    totalPages: 1,
    
    // 초기화
    async loadUnits() {
      this.isLoading = true;
      this.error = null;
      
      try {
        const response = await fetch('/api/curriculum-units', {
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          const result = await response.json();
          this.units = result.data || [];
          this.applyFilters();
          this.updatePagination();
        } else {
          const error = await response.json();
          this.error = error.message || '교육과정 목록을 불러오는데 실패했습니다.';
        }
      } catch (error) {
        console.error('교육과정 목록 로드 오류:', error);
        this.error = '예상치 못한 오류가 발생했습니다.';
      } finally {
        this.isLoading = false;
      }
    },
    
    // 필터 적용
    applyFilters() {
      this.filteredUnits = [...this.units];
      
      // 정렬 (단원 번호 순)
      this.filteredUnits.sort((a, b) => (a.unit_number || 0) - (b.unit_number || 0));
    },
    
    // 페이지네이션 업데이트
    updatePagination() {
      this.totalPages = Math.ceil(this.filteredUnits.length / this.itemsPerPage);
      
      // 현재 페이지의 데이터만 표시
      const startIndex = (this.currentPage - 1) * this.itemsPerPage;
      const endIndex = startIndex + this.itemsPerPage;
      this.filteredUnits = this.filteredUnits.slice(startIndex, endIndex);
    },
    
    // 페이지 이동
    goToPage(page) {
      if (page >= 1 && page <= this.totalPages) {
        this.currentPage = page;
        this.applyFilters();
        this.updatePagination();
      }
    },
    
    // 표시할 페이지 번호들
    get visiblePages() {
      const pages = [];
      const maxVisible = 5;
      const start = Math.max(1, this.currentPage - Math.floor(maxVisible / 2));
      const end = Math.min(this.totalPages, start + maxVisible - 1);
      
      for (let i = start; i <= end; i++) {
        pages.push(i);
      }
      return pages;
    },
    
    // 날짜 포맷팅
    formatDate(dateString) {
      if (!dateString) return '';
      
      const date = new Date(dateString);
      return date.toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    },
    
    // 주제 포맷팅
    formatTopics(topics) {
      if (!topics || !Array.isArray(topics)) return '';
      
      const validTopics = topics.filter(topic => topic && topic.trim());
      
      if (validTopics.length === 0) return '';
      if (validTopics.length <= 3) return validTopics.join(', ');
      
      return validTopics.slice(0, 3).join(', ') + ` 외 ${validTopics.length - 3}개`;
    },
    
    // 수정 처리
    handleEdit(unit) {
      // UTF-8 검증
      if (unit.unit_title && !this.validateUTF8(unit.unit_title)) {
        alert('교육과정 데이터에 인코딩 오류가 있습니다.');
        return;
      }
      
      this.$dispatch('curriculum-unit-edit', { unit });
    },
    
    // 삭제 처리
    async handleDelete(unitId, unitTitle) {
      // UTF-8 검증
      if (unitTitle && !this.validateUTF8(unitTitle)) {
        alert('교육과정 데이터에 인코딩 오류가 있습니다.');
        return;
      }
      
      const confirmed = confirm(`"${unitTitle}" 단원을 정말 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없습니다.`);
      
      if (!confirmed) return;
      
      try {
        const response = await fetch(`/api/curriculum-units/${unitId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          // 로컬에서 제거
          this.units = this.units.filter(unit => unit.id !== unitId);
          this.applyFilters();
          this.updatePagination();
          
          // 성공 이벤트 발송
          this.$dispatch('curriculum-unit-deleted', { unitId, unitTitle });
          
          alert('교육과정 단원이 성공적으로 삭제되었습니다.');
        } else {
          const error = await response.json();
          alert(error.message || '삭제에 실패했습니다.');
        }
      } catch (error) {
        console.error('교육과정 단원 삭제 오류:', error);
        alert('예상치 못한 오류가 발생했습니다.');
      }
    },
    
    // 새로고침
    refresh() {
      this.loadUnits();
    },
    
    // UTF-8 검증 함수
    validateUTF8(text) {
      try {
        const encoded = new TextEncoder().encode(text);
        const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
        return decoded === text;
      } catch (error) {
        console.error('UTF-8 인코딩 오류:', error);
        return false;
      }
    }
  };
}
</script>
```

---

## 5.7 Alpine.js 유틸리티 패턴

### 5.7.1 Alpine.js 폼 관리 패턴
```javascript
// Alpine.js 기반 폼 관리 유틸리티
const createFormManager = (initialValues, validationRules = {}) => {
  return {
    // 폼 데이터
    formData: { ...initialValues },
    originalData: { ...initialValues },
    
    // 상태
    errors: {},
    isSubmitting: false,
    isDirty: false,
    isValid: true,
    
    // UTF-8 검증 함수
    validateUTF8(text, fieldName) {
      if (!text) return true;
      
      try {
        const encoded = new TextEncoder().encode(text);
        const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
        return decoded === text;
      } catch (error) {
        console.error(`${fieldName} UTF-8 인코딩 오류:`, error);
        this.errors[fieldName] = 'UTF-8 인코딩 오류가 발생했습니다.';
        return false;
      }
    },
    
    // 필드 값 변경
    handleFieldChange(fieldName, value) {
      // UTF-8 검증
      if (typeof value === 'string' && !this.validateUTF8(value, fieldName)) {
        return false;
      }
      
      this.formData[fieldName] = value;
      this.isDirty = JSON.stringify(this.formData) !== JSON.stringify(this.originalData);
      
      // 에러 초기화
      if (this.errors[fieldName]) {
        delete this.errors[fieldName];
      }
      
      // 실시간 유효성 검사
      this.validateField(fieldName);
      
      return true;
    },
    
    // 개별 필드 유효성 검사
    validateField(fieldName) {
      const value = this.formData[fieldName];
      const rule = validationRules[fieldName];
      
      if (!rule) return true;
      
      // 필수 항목 검사
      if (rule.required && (!value || String(value).trim() === '')) {
        this.errors[fieldName] = rule.message || `${fieldName}은(는) 필수 입력 항목입니다.`;
        return false;
      }
      
      // 최소/최대 길이 검사
      if (rule.minLength && String(value).length < rule.minLength) {
        this.errors[fieldName] = `최소 ${rule.minLength}자 이상 입력해주세요.`;
        return false;
      }
      
      if (rule.maxLength && String(value).length > rule.maxLength) {
        this.errors[fieldName] = `최대 ${rule.maxLength}자까지 입력 가능합니다.`;
        return false;
      }
      
      // 패턴 검사
      if (rule.pattern && !rule.pattern.test(String(value))) {
        this.errors[fieldName] = rule.patternMessage || '올바른 형식이 아닙니다.';
        return false;
      }
      
      // 커스텀 유효성 검사 함수
      if (rule.validator && typeof rule.validator === 'function') {
        const result = rule.validator(value);
        if (result !== true) {
          this.errors[fieldName] = result || '유효성 검사에 실패했습니다.';
          return false;
        }
      }
      
      // 유효하면 에러 제거
      delete this.errors[fieldName];
      return true;
    },
    
    // 전체 폼 유효성 검사
    validateForm() {
      this.errors = {};
      let isValid = true;
      
      Object.keys(validationRules).forEach(fieldName => {
        if (!this.validateField(fieldName)) {
          isValid = false;
        }
      });
      
      this.isValid = isValid;
      return isValid;
    },
    
    // 폼 제출
    async submitForm(submitHandler) {
      if (this.isSubmitting) return;
      
      // 전체 유효성 검사
      if (!this.validateForm()) {
        alert('입력 내용을 다시 확인해주세요.');
        return;
      }
      
      this.isSubmitting = true;
      
      try {
        // UTF-8 검증 (전체 데이터)
        for (const [key, value] of Object.entries(this.formData)) {
          if (typeof value === 'string' && !this.validateUTF8(value, key)) {
            this.isSubmitting = false;
            return;
          }
        }
        
        // 제출 핸들러 실행
        const result = await submitHandler(this.formData);
        
        if (result && result.success) {
          // 성공 시 원본 데이터 업데이트
          this.originalData = { ...this.formData };
          this.isDirty = false;
        }
        
        return result;
      } catch (error) {
        console.error('폼 제출 오류:', error);
        const errorMessage = error.message || '폼 제출 중 오류가 발생했습니다.';
        
        // 서버 오류를 폼 에러로 매핑
        if (error.field) {
          this.errors[error.field] = errorMessage;
        } else {
          alert(errorMessage);
        }
        
        throw error;
      } finally {
        this.isSubmitting = false;
      }
    },
    
    // 폼 초기화
    resetForm() {
      this.formData = { ...initialValues };
      this.originalData = { ...initialValues };
      this.errors = {};
      this.isDirty = false;
      this.isValid = true;
    },
    
    // 변경사항 되돌리기
    revertChanges() {
      this.formData = { ...this.originalData };
      this.errors = {};
      this.isDirty = false;
    },
    
    // 특정 필드 에러 설정
    setFieldError(fieldName, errorMessage) {
      this.errors[fieldName] = errorMessage;
      this.isValid = Object.keys(this.errors).length === 0;
    },
    
    // 에러 개수 계산
    get errorCount() {
      return Object.keys(this.errors).length;
    },
    
    // 필드가 에러가 있는지 확인
    hasFieldError(fieldName) {
      return !!this.errors[fieldName];
    }
  };
};
```

### 5.7.2 Alpine.js API 관리 패턴
```javascript
// Alpine.js 기반 API 관리 유틸리티
const createApiManager = () => {
  return {
    // 상태
    isLoading: false,
    error: null,
    data: null,
    lastResponse: null,
    
    // 기본 설정
    baseURL: '/api',
    defaultHeaders: {
      'Content-Type': 'application/json; charset=utf-8',
      'Accept': 'application/json'
    },
    
    // 인증 헤더 추가
    getAuthHeaders() {
      const token = Alpine.store('auth')?.token;
      return token ? { 'Authorization': `Bearer ${token}` } : {};
    },
    
    // UTF-8 안전 JSON 파싱
    safeJsonParse(text) {
      try {
        // UTF-8 검증
        const encoded = new TextEncoder().encode(text);
        const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
        
        if (decoded !== text) {
          throw new Error('UTF-8 인코딩 오류');
        }
        
        return JSON.parse(text);
      } catch (error) {
        console.error('JSON 파싱 오류:', error);
        throw new Error('응답 데이터 파싱에 실패했습니다.');
      }
    },
    
    // HTTP 요청 실행
    async request(method, endpoint, data = null, options = {}) {
      this.isLoading = true;
      this.error = null;
      
      try {
        const url = endpoint.startsWith('http') ? endpoint : `${this.baseURL}${endpoint}`;
        
        const config = {
          method: method.toUpperCase(),
          headers: {
            ...this.defaultHeaders,
            ...this.getAuthHeaders(),
            ...options.headers
          },
          ...options
        };
        
        // POST, PUT, PATCH 요청에 데이터 추가
        if (data && ['POST', 'PUT', 'PATCH'].includes(config.method)) {
          // UTF-8 안전성 검사
          const dataString = JSON.stringify(data);
          const encoded = new TextEncoder().encode(dataString);
          const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
          
          if (decoded !== dataString) {
            throw new Error('요청 데이터에 UTF-8 인코딩 오류가 있습니다.');
          }
          
          config.body = dataString;
        }
        
        const response = await fetch(url, config);
        this.lastResponse = response;
        
        // 응답 처리
        const responseText = await response.text();
        
        let responseData = null;
        if (responseText) {
          try {
            responseData = this.safeJsonParse(responseText);
          } catch (parseError) {
            // JSON이 아닌 경우 텍스트로 처리
            responseData = responseText;
          }
        }
        
        if (!response.ok) {
          const errorMessage = responseData?.message || 
                             responseData?.error || 
                             `HTTP ${response.status}: ${response.statusText}`;
          throw new Error(errorMessage);
        }
        
        this.data = responseData;
        return responseData;
        
      } catch (error) {
        console.error('API 요청 오류:', error);
        this.error = error.message || '네트워크 오류가 발생했습니다.';
        throw error;
      } finally {
        this.isLoading = false;
      }
    },
    
    // GET 요청
    async get(endpoint, options = {}) {
      return this.request('GET', endpoint, null, options);
    },
    
    // POST 요청
    async post(endpoint, data, options = {}) {
      return this.request('POST', endpoint, data, options);
    },
    
    // PUT 요청
    async put(endpoint, data, options = {}) {
      return this.request('PUT', endpoint, data, options);
    },
    
    // PATCH 요청
    async patch(endpoint, data, options = {}) {
      return this.request('PATCH', endpoint, data, options);
    },
    
    // DELETE 요청
    async delete(endpoint, options = {}) {
      return this.request('DELETE', endpoint, null, options);
    },
    
    // 파일 업로드
    async uploadFile(endpoint, file, additionalData = {}, onProgress = null) {
      this.isLoading = true;
      this.error = null;
      
      try {
        const formData = new FormData();
        formData.append('file', file);
        
        // 추가 데이터 추가
        Object.entries(additionalData).forEach(([key, value]) => {
          // UTF-8 검증
          if (typeof value === 'string') {
            const encoded = new TextEncoder().encode(value);
            const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
            if (decoded !== value) {
              throw new Error(`${key} 필드에 UTF-8 인코딩 오류가 있습니다.`);
            }
          }
          formData.append(key, value);
        });
        
        const config = {
          method: 'POST',
          headers: {
            ...this.getAuthHeaders()
            // Content-Type은 FormData가 자동 설정
          },
          body: formData
        };
        
        // 진행률 추적
        if (onProgress && typeof onProgress === 'function') {
          const xhr = new XMLHttpRequest();
          
          return new Promise((resolve, reject) => {
            xhr.upload.addEventListener('progress', (event) => {
              if (event.lengthComputable) {
                const percentComplete = (event.loaded / event.total) * 100;
                onProgress(Math.round(percentComplete));
              }
            });
            
            xhr.addEventListener('load', () => {
              this.isLoading = false;
              
              if (xhr.status >= 200 && xhr.status < 300) {
                try {
                  const responseData = this.safeJsonParse(xhr.responseText);
                  this.data = responseData;
                  resolve(responseData);
                } catch (error) {
                  this.error = '응답 파싱 오류';
                  reject(new Error(this.error));
                }
              } else {
                this.error = `업로드 실패: ${xhr.status}`;
                reject(new Error(this.error));
              }
            });
            
            xhr.addEventListener('error', () => {
              this.isLoading = false;
              this.error = '업로드 중 네트워크 오류가 발생했습니다.';
              reject(new Error(this.error));
            });
            
            xhr.open('POST', `${this.baseURL}${endpoint}`);
            
            // 인증 헤더 추가
            const authHeaders = this.getAuthHeaders();
            Object.entries(authHeaders).forEach(([key, value]) => {
              xhr.setRequestHeader(key, value);
            });
            
            xhr.send(formData);
          });
        } else {
          // 기본 fetch 사용
          const url = `${this.baseURL}${endpoint}`;
          const response = await fetch(url, config);
          
          const responseText = await response.text();
          const responseData = responseText ? this.safeJsonParse(responseText) : null;
          
          if (!response.ok) {
            const errorMessage = responseData?.message || `업로드 실패: ${response.status}`;
            throw new Error(errorMessage);
          }
          
          this.data = responseData;
          return responseData;
        }
        
      } catch (error) {
        console.error('파일 업로드 오류:', error);
        this.error = error.message || '파일 업로드 중 오류가 발생했습니다.';
        throw error;
      } finally {
        this.isLoading = false;
      }
    },
    
    // 상태 초기화
    reset() {
      this.isLoading = false;
      this.error = null;
      this.data = null;
      this.lastResponse = null;
    },
    
    // 에러 상태인지 확인
    get hasError() {
      return !!this.error;
    },
    
    // 성공 상태인지 확인
    get isSuccess() {
      return !this.error && !this.isLoading && this.data !== null;
    }
  };
};
```

---

## 📋 **체크리스트**

### 기본 컴포넌트
- [ ] Button, Modal, FormField 컴포넌트 구현
- [ ] Select, Checkbox, Radio 컴포넌트 구현
- [ ] Loading, Error 컴포넌트 구현

### 복합 컴포넌트
- [ ] StudentForm, StudentList 컴포넌트 구현
- [ ] Calendar, QuickLinksGrid 컴포넌트 구현
- [ ] DataTable, Pagination 컴포넌트 구현

### 커스텀 훅
- [ ] useForm, useApi 훅 구현
- [ ] useLocalStorage, useDebounce 훅 구현
- [ ] useAuth, usePermissions 훅 구현

---

## 5.8 AI 기반 핵심 서비스 컴포넌트

### 5.8.1 AI 교육계획 생성 컴포넌트
```html
<!-- AI 교육계획 생성 컴포넌트 -->
<div class="bg-white rounded-lg shadow-md p-6" 
     x-data="aiEducationPlanGenerator()" 
     x-init="initComponent()">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-lg font-semibold text-gray-800">
      AI 개별화교육 계획 생성
    </h3>
    <button
      @click="handleGenerate()"
      :disabled="isGenerating"
      class="px-4 py-2 rounded-lg text-white font-medium transition-all"
      :class="isGenerating ? 'bg-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-pink-500 to-violet-500 hover:from-pink-600 hover:to-violet-600'"
    >
      <span x-show="!isGenerating">계획 생성</span>
      <span x-show="isGenerating" class="flex items-center space-x-2">
        <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span>AI 생성 중...</span>
      </span>
    </button>
  </div>
  
  <!-- 생성된 계획 표시 -->
  <div x-show="generatedPlan" x-transition class="space-y-4">
    <div class="flex items-center space-x-2">
      <span class="text-sm text-gray-600">신뢰도:</span>
      <div class="flex-1 bg-gray-200 rounded-full h-2">
        <div 
          class="bg-gradient-to-r from-emerald-400 to-cyan-500 h-2 rounded-full transition-all duration-500"
          :style="`width: ${confidence * 100}%`"
        ></div>
      </div>
      <span class="text-sm font-medium" x-text="Math.round(confidence * 100) + '%'"></span>
    </div>
    
    <!-- 주의사항 -->
    <div x-show="warnings.length > 0" 
         x-transition
         class="bg-amber-50 border border-amber-200 rounded-lg p-3">
      <h4 class="text-sm font-medium text-amber-800 mb-2">⚠️ 주의사항</h4>
      <ul class="text-sm text-amber-700 space-y-1">
        <template x-for="(warning, index) in warnings" :key="index">
          <li>• <span x-text="warning"></span></li>
        </template>
      </ul>
    </div>
    
    <!-- 개선 제안 -->
    <div x-show="suggestions.length > 0" 
         x-transition
         class="bg-blue-50 border border-blue-200 rounded-lg p-3">
      <h4 class="text-sm font-medium text-blue-800 mb-2">💡 개선 제안</h4>
      <ul class="text-sm text-blue-700 space-y-1">
        <template x-for="(suggestion, index) in suggestions" :key="index">
          <li>• <span x-text="suggestion"></span></li>
        </template>
      </ul>
    </div>
    
    <!-- 생성된 교육계획 -->
    <div class="bg-gray-50 rounded-lg p-4">
      <h4 class="font-medium text-gray-800 mb-2">생성된 교육계획</h4>
      <div class="prose prose-sm max-w-none" x-html="generatedPlan?.content || ''"></div>
    </div>
  </div>
  
  <!-- 에러 메시지 -->
  <div x-show="errorMessage" 
       x-transition
       class="mt-4 bg-red-50 border border-red-200 rounded-lg p-3">
    <div class="flex items-center space-x-2">
      <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
      </svg>
      <p class="text-sm text-red-700" x-text="errorMessage"></p>
    </div>
  </div>
</div>

<script>
function aiEducationPlanGenerator() {
  return {
    // 컴포넌트 props (초기화 시 설정)
    studentId: '',
    subject: '국어', // '국어' | '수학'
    unit: '',
    
    // 상태 변수
    isGenerating: false,
    generatedPlan: null,
    confidence: 0,
    warnings: [],
    suggestions: [],
    errorMessage: '',
    
    // 초기화
    initComponent() {
      // 전역 스토어에서 현재 선택된 학생 정보 가져오기
      const studentsStore = Alpine.store('students');
      if (studentsStore.selectedStudent) {
        this.studentId = studentsStore.selectedStudent.id;
      }
      
      // 이벤트 리스너 등록
      this.$el.addEventListener('ai:education-plan-request', (event) => {
        const { studentId, subject, unit } = event.detail;
        this.studentId = studentId;
        this.subject = subject;
        this.unit = unit;
        this.handleGenerate();
      });
    },
    
    // UTF-8 인코딩 검증
    validateUTF8(text) {
      try {
        const encoded = new TextEncoder().encode(text);
        const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
        return decoded === text;
      } catch (error) {
        console.error('UTF-8 인코딩 오류:', error);
        return false;
      }
    },
    
    // AI 교육계획 생성
    async handleGenerate() {
      if (!this.studentId || !this.subject || !this.unit) {
        this.errorMessage = '필수 정보(학생, 과목, 단원)가 누락되었습니다.';
        return;
      }
      
      this.isGenerating = true;
      this.errorMessage = '';
      this.generatedPlan = null;
      
      try {
        // HTMX를 통한 Supabase Edge Function 호출
        const response = await fetch('/api/ai/generate-education-plan', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: JSON.stringify({
            student_id: this.studentId,
            subject: this.subject,
            unit: this.unit,
            standards: [], // 교육과정에서 가져오기
            teacher_preferences: {} // 사용자 설정에서 가져오기
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success) {
          // UTF-8 안전성 검증
          if (!this.validateUTF8(result.data.content)) {
            throw new Error('생성된 계획에 인코딩 문제가 있습니다.');
          }
          
          this.generatedPlan = result.data;
          this.confidence = result.data.confidence || 0;
          this.warnings = result.data.warnings || [];
          this.suggestions = result.data.suggestions || [];
          
          // 성공 이벤트 디스패치
          this.$dispatch('ai:education-plan-generated', {
            plan: result.data,
            studentId: this.studentId
          });
          
          // 교육 상태 스토어 업데이트
          const educationStore = Alpine.store('education');
          if (educationStore.addGeneratedPlan) {
            educationStore.addGeneratedPlan(this.studentId, result.data);
          }
        } else {
          this.errorMessage = result.error?.message || 'AI 교육계획 생성에 실패했습니다.';
        }
      } catch (error) {
        console.error('AI 교육계획 생성 오류:', error);
        this.errorMessage = '예상치 못한 오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
      } finally {
        this.isGenerating = false;
      }
    },
    
    // 계획 승인 및 저장
    approvePlan() {
      if (!this.generatedPlan) return;
      
      // 승인 이벤트 디스패치
      this.$dispatch('ai:education-plan-approved', {
        plan: this.generatedPlan,
        studentId: this.studentId
      });
      
      // HTMX를 통해 서버에 저장 요청
      htmx.trigger(this.$el, 'hx:trigger', {
        target: '/api/education/save-plan',
        values: {
          student_id: this.studentId,
          plan: JSON.stringify(this.generatedPlan)
        }
      });
    }
  };
}
</script>
```
    </div>
  );
};
```

### 5.8.2 AI 학교장 의견서 생성 컴포넌트
```html
<!-- AI 학교장 의견서 생성 컴포넌트 -->
<div class="bg-white rounded-lg shadow-md p-6" 
     x-data="aiSchoolOpinionGenerator()" 
     x-init="initComponent()">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-lg font-semibold text-gray-800">
      AI 학교장 의견서 생성 (<span x-text="opinionTypeLabels[opinionType]"></span>)
    </h3>
    <button x-show="!previewMode"
            @click="handleGenerate()"
            :disabled="isGenerating"
            class="px-4 py-2 rounded-lg text-white font-medium transition-all"
            :class="isGenerating ? 'bg-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-violet-500 to-purple-500 hover:from-violet-600 hover:to-purple-600'">
      <span x-show="!isGenerating">의견서 생성</span>
      <span x-show="isGenerating" class="flex items-center space-x-2">
        <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span>AI 생성 중...</span>
      </span>
    </button>
  </div>
  
  <!-- 미리보기 모드 -->
  <div x-show="previewMode && generatedOpinion" x-transition class="space-y-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <span class="text-sm text-gray-600">신뢰도:</span>
        <div class="w-20 bg-gray-200 rounded-full h-2">
          <div 
            class="bg-gradient-to-r from-violet-400 to-purple-500 h-2 rounded-full transition-all duration-500"
            :style="`width: ${confidence * 100}%`"
          ></div>
        </div>
        <span class="text-sm font-medium" x-text="Math.round(confidence * 100) + '%'"></span>
      </div>
      <div class="flex space-x-2">
        <button
          @click="previewMode = false; generatedOpinion = ''"
          class="px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"
        >
          다시 생성
        </button>
        <button
          @click="handleApprove()"
          class="px-3 py-1 text-sm bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-md hover:from-emerald-600 hover:to-teal-600 transition-all"
        >
          사용하기
        </button>
      </div>
    </div>
    
    <!-- 생성된 의견서 내용 -->
    <div class="bg-gray-50 rounded-lg p-4 max-h-96 overflow-y-auto">
      <div class="prose prose-sm max-w-none whitespace-pre-wrap" x-text="generatedOpinion"></div>
    </div>
  </div>
  
  <!-- 의견서 유형 선택 -->
  <div x-show="!previewMode" class="mb-4">
    <label class="block text-sm font-medium text-gray-700 mb-2">
      의견서 유형 선택
    </label>
    <select x-model="opinionType" 
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-violet-500 focus:border-violet-500">
      <option value="new_placement">신규 배치</option>
      <option value="reselection">재선정</option>
      <option value="replacement">재배치</option>
      <option value="cancellation">선정취소</option>
    </select>
  </div>
  
  <!-- 에러 메시지 -->
  <div x-show="errorMessage" 
       x-transition
       class="mt-4 bg-red-50 border border-red-200 rounded-lg p-3">
    <div class="flex items-center space-x-2">
      <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
      </svg>
      <p class="text-sm text-red-700" x-text="errorMessage"></p>
    </div>
  </div>
</div>

<script>
function aiSchoolOpinionGenerator() {
  return {
    // 컴포넌트 props
    studentId: '',
    opinionType: 'new_placement', // 'new_placement' | 'reselection' | 'replacement' | 'cancellation'
    
    // 상태 변수
    isGenerating: false,
    generatedOpinion: '',
    confidence: 0,
    previewMode: false,
    errorMessage: '',
    
    // 의견서 유형 레이블
    opinionTypeLabels: {
      'new_placement': '신규 배치',
      'reselection': '재선정',
      'replacement': '재배치',
      'cancellation': '선정취소'
    },
    
    // 초기화
    initComponent() {
      // 전역 스토어에서 현재 선택된 학생 정보 가져오기
      const studentsStore = Alpine.store('students');
      if (studentsStore.selectedStudent) {
        this.studentId = studentsStore.selectedStudent.id;
      }
      
      // 이벤트 리스너 등록
      this.$el.addEventListener('ai:school-opinion-request', (event) => {
        const { studentId, opinionType } = event.detail;
        this.studentId = studentId;
        this.opinionType = opinionType;
        this.handleGenerate();
      });
    },
    
    // UTF-8 인코딩 검증
    validateUTF8(text) {
      try {
        const encoded = new TextEncoder().encode(text);
        const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
        return decoded === text;
      } catch (error) {
        console.error('UTF-8 인코딩 오류:', error);
        return false;
      }
    },
    
    // AI 학교장 의견서 생성
    async handleGenerate() {
      if (!this.studentId || !this.opinionType) {
        this.errorMessage = '필수 정보(학생, 의견서 유형)가 누락되었습니다.';
        return;
      }
      
      this.isGenerating = true;
      this.errorMessage = '';
      this.generatedOpinion = '';
      this.previewMode = false;
      
      try {
        // HTMX를 통한 Supabase Edge Function 호출
        const response = await fetch('/api/ai/generate-school-opinion', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: JSON.stringify({
            student_id: this.studentId,
            opinion_type: this.opinionType,
            template_type: 'standard',
            teacher_preferences: {}
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success) {
          // UTF-8 안전성 검증
          if (!this.validateUTF8(result.data.opinion)) {
            throw new Error('생성된 의견서에 인코딩 문제가 있습니다.');
          }
          
          this.generatedOpinion = result.data.opinion;
          this.confidence = result.data.confidence || 0;
          this.previewMode = true;
          
          // 성공 이벤트 디스패치
          this.$dispatch('ai:school-opinion-generated', {
            opinion: result.data.opinion,
            studentId: this.studentId,
            opinionType: this.opinionType
          });
        } else {
          this.errorMessage = result.error?.message || 'AI 학교장 의견서 생성에 실패했습니다.';
        }
      } catch (error) {
        console.error('AI 학교장 의견서 생성 오류:', error);
        this.errorMessage = '예상치 못한 오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
      } finally {
        this.isGenerating = false;
      }
    },
    
    // 의견서 승인 및 저장
    handleApprove() {
      if (!this.generatedOpinion) return;
      
      // 승인 이벤트 디스패치
      this.$dispatch('ai:school-opinion-approved', {
        opinion: this.generatedOpinion,
        studentId: this.studentId,
        opinionType: this.opinionType
      });
      
      // AI 서비스 상태 스토어 업데이트
      const aiStore = Alpine.store('aiSchoolOpinion');
      if (aiStore && aiStore.addApprovedOpinion) {
        aiStore.addApprovedOpinion({
          studentId: this.studentId,
          opinionType: this.opinionType,
          opinion: this.generatedOpinion,
          confidence: this.confidence,
          createdAt: new Date().toISOString()
        });
      }
      
      // HTMX를 통해 서버에 저장 요청
      if (typeof htmx !== 'undefined') {
        htmx.trigger(this.$el, 'hx:trigger', {
          target: '/api/ai/save-school-opinion',
          values: {
            student_id: this.studentId,
            opinion_type: this.opinionType,
            opinion: this.generatedOpinion
          }
        });
      }
      
      // 미리보기 모드 종료
      this.previewMode = false;
      this.generatedOpinion = '';
    }
  };
}
</script>
```
```

### 5.8.3 AI 상담 가이드 생성 컴포넌트
```html
<!-- AI 상담 가이드 생성 컴포넌트 -->
<div class="bg-white rounded-lg shadow-md p-6" 
     x-data="aiCounselingGuideGenerator()" 
     x-init="initComponent()">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-lg font-semibold text-gray-800">
      AI 상담 가이드 생성 (<span x-text="counselingTypeLabels[counselingType]"></span>)
    </h3>
  </div>
  
  <div class="space-y-4">
    <!-- 상담 유형 선택 -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">
        상담 유형 선택
      </label>
      <select x-model="counselingType" 
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500">
        <option value="individual">개별 상담</option>
        <option value="parent">학부모 상담</option>
        <option value="group">집단 상담</option>
        <option value="expert">전문가 상담</option>
      </select>
    </div>
    
    <!-- 주요 관심 영역 선택 -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">
        주요 관심 영역 선택
      </label>
      <div class="grid grid-cols-2 gap-2">
        <template x-for="area in availableFocusAreas" :key="area">
          <label class="flex items-center space-x-2">
            <input
              type="checkbox"
              :value="area"
              x-model="selectedFocusAreas"
              class="rounded border-gray-300 text-cyan-500 focus:ring-cyan-500"
            />
            <span class="text-sm text-gray-700" x-text="area"></span>
          </label>
        </template>
      </div>
    </div>
    
    <!-- 생성 버튼 -->
    <button
      @click="handleGenerate()"
      :disabled="isGenerating || selectedFocusAreas.length === 0"
      class="w-full px-4 py-2 rounded-lg text-white font-medium transition-all"
      :class="(isGenerating || selectedFocusAreas.length === 0) ? 'bg-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600'"
    >
      <span x-show="!isGenerating">상담 가이드 생성</span>
      <span x-show="isGenerating" class="flex items-center justify-center space-x-2">
        <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span>AI 생성 중...</span>
      </span>
    </button>
  </div>
  
  <!-- 생성된 가이드 표시 -->
  <div x-show="generatedGuide" x-transition class="mt-6 space-y-4">
    <div class="flex items-center space-x-2">
      <span class="text-sm text-gray-600">신뢰도:</span>
      <div class="flex-1 bg-gray-200 rounded-full h-2">
        <div 
          class="bg-gradient-to-r from-cyan-400 to-blue-500 h-2 rounded-full transition-all duration-500"
          :style="`width: ${generatedGuide?.confidence * 100 || 0}%`"
        ></div>
      </div>
      <span class="text-sm font-medium" x-text="Math.round((generatedGuide?.confidence || 0) * 100) + '%'"></span>
    </div>
    
    <div class="bg-gray-50 rounded-lg p-4">
      <h4 class="font-medium text-gray-800 mb-2">상담 가이드</h4>
      <div class="prose prose-sm max-w-none whitespace-pre-wrap" x-text="generatedGuide?.guide || ''"></div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="bg-blue-50 rounded-lg p-4">
        <h4 class="font-medium text-blue-800 mb-2">주요 상담 포인트</h4>
        <ul class="text-sm text-blue-700 space-y-1">
          <template x-for="(point, index) in (generatedGuide?.points || [])" :key="index">
            <li>• <span x-text="point"></span></li>
          </template>
        </ul>
      </div>
      
      <div class="bg-green-50 rounded-lg p-4">
        <h4 class="font-medium text-green-800 mb-2">상담 전략</h4>
        <ul class="text-sm text-green-700 space-y-1">
          <template x-for="(strategy, index) in (generatedGuide?.strategies || [])" :key="index">
            <li>• <span x-text="strategy"></span></li>
          </template>
        </ul>
      </div>
    </div>
    
    <!-- 사용 버튼 -->
    <div class="flex justify-end">
      <button
        @click="handleApprove()"
        class="px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-lg hover:from-emerald-600 hover:to-teal-600 transition-all"
      >
        가이드 사용하기
      </button>
    </div>
  </div>
  
  <!-- 에러 메시지 -->
  <div x-show="errorMessage" 
       x-transition
       class="mt-4 bg-red-50 border border-red-200 rounded-lg p-3">
    <div class="flex items-center space-x-2">
      <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
      </svg>
      <p class="text-sm text-red-700" x-text="errorMessage"></p>
    </div>
  </div>
</div>

<script>
function aiCounselingGuideGenerator() {
  return {
    // 컴포넌트 props
    studentId: '',
    counselingType: 'individual', // 'individual' | 'parent' | 'group' | 'expert'
    
    // 상태 변수
    isGenerating: false,
    generatedGuide: null,
    selectedFocusAreas: [],
    errorMessage: '',
    
    // 상담 유형 레이블
    counselingTypeLabels: {
      'individual': '개별 상담',
      'parent': '학부모 상담',
      'group': '집단 상담',
      'expert': '전문가 상담'
    },
    
    // 이용 가능한 관심 영역
    availableFocusAreas: [
      '학습 능력 향상',
      '사회성 발달',
      '의사소통 기술',
      '문제행동 개선',
      '자립생활 기술',
      '진로 탐색',
      '가족 관계',
      '스트레스 관리'
    ],
    
    // 초기화
    initComponent() {
      // 전역 스토어에서 현재 선택된 학생 정보 가져오기
      const studentsStore = Alpine.store('students');
      if (studentsStore.selectedStudent) {
        this.studentId = studentsStore.selectedStudent.id;
      }
      
      // 이벤트 리스너 등록
      this.$el.addEventListener('ai:counseling-guide-request', (event) => {
        const { studentId, counselingType, focusAreas } = event.detail;
        this.studentId = studentId;
        this.counselingType = counselingType;
        this.selectedFocusAreas = focusAreas || [];
        this.handleGenerate();
      });
    },
    
    // UTF-8 인코딩 검증
    validateUTF8(text) {
      try {
        const encoded = new TextEncoder().encode(text);
        const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
        return decoded === text;
      } catch (error) {
        console.error('UTF-8 인코딩 오류:', error);
        return false;
      }
    },
    
    // AI 상담 가이드 생성
    async handleGenerate() {
      if (!this.studentId || !this.counselingType || this.selectedFocusAreas.length === 0) {
        this.errorMessage = '필수 정보(학생, 상담 유형, 관심 영역)가 누락되었습니다.';
        return;
      }
      
      this.isGenerating = true;
      this.errorMessage = '';
      this.generatedGuide = null;
      
      try {
        // HTMX를 통한 Supabase Edge Function 호출
        const response = await fetch('/api/ai/generate-counseling-guide', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: JSON.stringify({
            student_id: this.studentId,
            counseling_type: this.counselingType,
            focus_areas: this.selectedFocusAreas,
            teacher_preferences: {}
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success) {
          // UTF-8 안전성 검증
          if (!this.validateUTF8(result.data.guide)) {
            throw new Error('생성된 상담 가이드에 인코딩 문제가 있습니다.');
          }
          
          this.generatedGuide = result.data;
          
          // 성공 이벤트 디스패치
          this.$dispatch('ai:counseling-guide-generated', {
            guide: result.data,
            studentId: this.studentId,
            counselingType: this.counselingType
          });
        } else {
          this.errorMessage = result.error?.message || 'AI 상담 가이드 생성에 실패했습니다.';
        }
      } catch (error) {
        console.error('AI 상담 가이드 생성 오류:', error);
        this.errorMessage = '예상치 못한 오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
      } finally {
        this.isGenerating = false;
      }
    },
    
    // 가이드 승인 및 저장
    handleApprove() {
      if (!this.generatedGuide) return;
      
      // 승인 이벤트 디스패치
      this.$dispatch('ai:counseling-guide-approved', {
        guide: this.generatedGuide,
        studentId: this.studentId,
        counselingType: this.counselingType,
        focusAreas: this.selectedFocusAreas
      });
      
      // AI 서비스 상태 스토어 업데이트
      const aiStore = Alpine.store('aiCounselingGuide');
      if (aiStore && aiStore.addApprovedGuide) {
        aiStore.addApprovedGuide({
          studentId: this.studentId,
          counselingType: this.counselingType,
          guide: this.generatedGuide,
          focusAreas: this.selectedFocusAreas,
          createdAt: new Date().toISOString()
        });
      }
      
      // HTMX를 통해 서버에 저장 요청
      if (typeof htmx !== 'undefined') {
        htmx.trigger(this.$el, 'hx:trigger', {
          target: '/api/ai/save-counseling-guide',
          values: {
            student_id: this.studentId,
            counseling_type: this.counselingType,
            guide: JSON.stringify(this.generatedGuide),
            focus_areas: JSON.stringify(this.selectedFocusAreas)
          }
        });
      }
    }
  };
}
</script>
```
              </ul>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};
```

### 5.8.4 AI 행정문서 생성 컴포넌트
```html
<!-- AI 행정문서 생성 컴포넌트 -->
<div class="bg-white rounded-lg shadow-md p-6" 
     x-data="aiAdminDocumentGenerator()" 
     x-init="initComponent()">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-lg font-semibold text-gray-800">
      AI <span x-text="documentTypeLabels[documentType]"></span> 생성
    </h3>
    <div class="text-sm text-gray-600">
      대상 학생: <span x-text="selectedStudentIds.length"></span>명
    </div>
  </div>
  
  <div class="space-y-4">
    <!-- 문서 유형 선택 -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">
        문서 유형 선택
      </label>
      <select x-model="documentType" 
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-amber-500 focus:border-amber-500">
        <option value="evaluation_report">평가 보고서</option>
        <option value="progress_summary">진도 요약서</option>
        <option value="transition_plan">전환 계획서</option>
        <option value="iep_summary">IEP 요약서</option>
      </select>
    </div>
    
    <!-- 학생 선택 -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">
        대상 학생 선택
      </label>
      <div class="max-h-32 overflow-y-auto border border-gray-200 rounded-md p-2 space-y-1">
        <template x-for="student in availableStudents" :key="student.id">
          <label class="flex items-center space-x-2">
            <input
              type="checkbox"
              :value="student.id"
              x-model="selectedStudentIds"
              class="rounded border-gray-300 text-amber-500 focus:ring-amber-500"
            />
            <span class="text-sm" x-text="student.name"></span>
          </label>
        </template>
      </div>
      <div class="mt-2 text-xs text-gray-500" x-show="selectedStudentIds.length === 0">
        생성할 문서에 포함할 학생을 선택해주세요.
      </div>
    </div>
    
    <!-- 기간 설정 (옵션) -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">
        대상 기간 (선택사항)
      </label>
      <div class="grid grid-cols-2 gap-2">
        <input
          type="date"
          x-model="period.start"
          class="px-3 py-2 border border-gray-300 rounded-md focus:ring-amber-500 focus:border-amber-500"
          placeholder="시작일"
        />
        <input
          type="date"
          x-model="period.end"
          class="px-3 py-2 border border-gray-300 rounded-md focus:ring-amber-500 focus:border-amber-500"
          placeholder="종료일"
        />
      </div>
    </div>
    
    <!-- 선택된 기간 표시 -->
    <div x-show="period.start && period.end" 
         class="p-3 bg-amber-50 border border-amber-200 rounded-lg">
      <span class="text-sm text-amber-800">대상 기간: </span>
      <span class="text-sm font-medium text-amber-900" x-text="period.start + ' ~ ' + period.end"></span>
    </div>
    
    <!-- 생성 버튼 -->
    <button
      @click="handleGenerate()"
      :disabled="isGenerating || selectedStudentIds.length === 0"
      class="w-full px-4 py-2 rounded-lg text-white font-medium transition-all"
      :class="(isGenerating || selectedStudentIds.length === 0) ? 'bg-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600'"
    >
      <span x-show="!isGenerating">문서 생성</span>
      <span x-show="isGenerating" class="flex items-center justify-center space-x-2">
        <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span>생성 중...</span>
      </span>
    </button>
  </div>
  
  <!-- 생성 진행 상황 -->
  <div x-show="isGenerating" x-transition class="mt-4 space-y-2">
    <div class="flex items-center justify-between text-sm">
      <span class="text-gray-600" x-text="currentStep"></span>
      <span class="font-medium" x-text="progress + '%'"></span>
    </div>
    <div class="w-full bg-gray-200 rounded-full h-2">
      <div 
        class="bg-gradient-to-r from-amber-400 to-orange-500 h-2 rounded-full transition-all duration-300"
        :style="`width: ${progress}%`"
      ></div>
    </div>
  </div>
  
  <!-- 생성된 문서 미리보기 -->
  <div x-show="generatedDocument" x-transition class="mt-6 space-y-4">
    <div class="bg-gray-50 rounded-lg p-4">
      <h4 class="font-medium text-gray-800 mb-2">생성된 문서 미리보기</h4>
      <div class="prose prose-sm max-w-none whitespace-pre-wrap text-sm" 
           x-html="generatedDocument?.content || ''"></div>
    </div>
    
    <!-- 액션 버튼 -->
    <div class="flex justify-end space-x-2">
      <button
        @click="downloadDocument()"
        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all"
      >
        문서 다운로드
      </button>
      <button
        @click="saveDocument()"
        class="px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-lg hover:from-emerald-600 hover:to-teal-600 transition-all"
      >
        문서 저장
      </button>
    </div>
  </div>
  
  <!-- 에러 메시지 -->
  <div x-show="errorMessage" 
       x-transition
       class="mt-4 bg-red-50 border border-red-200 rounded-lg p-3">
    <div class="flex items-center space-x-2">
      <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
      </svg>
      <p class="text-sm text-red-700" x-text="errorMessage"></p>
    </div>
  </div>
</div>

<script>
function aiAdminDocumentGenerator() {
  return {
    // 컴포넌트 props
    documentType: 'evaluation_report', // 'evaluation_report' | 'progress_summary' | 'transition_plan' | 'iep_summary'
    selectedStudentIds: [],
    period: {
      start: '',
      end: ''
    },
    
    // 상태 변수
    isGenerating: false,
    progress: 0,
    currentStep: '',
    generatedDocument: null,
    errorMessage: '',
    availableStudents: [],
    
    // 문서 유형 레이블
    documentTypeLabels: {
      'evaluation_report': '평가 보고서',
      'progress_summary': '진도 요약서',
      'transition_plan': '전환 계획서',
      'iep_summary': 'IEP 요약서'
    },
    
    // 초기화
    initComponent() {
      this.loadAvailableStudents();
      
      // 이벤트 리스너 등록
      this.$el.addEventListener('ai:admin-document-request', (event) => {
        const { documentType, studentIds, period } = event.detail;
        this.documentType = documentType;
        this.selectedStudentIds = studentIds || [];
        if (period) {
          this.period = period;
        }
        this.handleGenerate();
      });
    },
    
    // 사용 가능한 학생 목록 로드
    async loadAvailableStudents() {
      try {
        const studentsStore = Alpine.store('students');
        if (studentsStore.students && studentsStore.students.length > 0) {
          this.availableStudents = studentsStore.students;
        } else {
          // HTMX로 학생 목록 로드
          const response = await fetch('/api/students', {
            headers: {
              'Authorization': `Bearer ${Alpine.store('auth').token}`
            }
          });
          if (response.ok) {
            const result = await response.json();
            this.availableStudents = result.data || [];
          }
        }
      } catch (error) {
        console.error('학생 목록 로드 오류:', error);
      }
    },
    
    // UTF-8 인코딩 검증
    validateUTF8(text) {
      try {
        const encoded = new TextEncoder().encode(text);
        const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
        return decoded === text;
      } catch (error) {
        console.error('UTF-8 인코딩 오류:', error);
        return false;
      }
    },
    
    // 진행 상황 업데이트
    updateProgress(step, progress) {
      this.currentStep = step;
      this.progress = progress;
    },
    
    // AI 행정문서 생성
    async handleGenerate() {
      if (!this.documentType || this.selectedStudentIds.length === 0) {
        this.errorMessage = '문서 유형과 대상 학생을 선택해주세요.';
        return;
      }
      
      this.isGenerating = true;
      this.errorMessage = '';
      this.generatedDocument = null;
      this.progress = 0;
      this.currentStep = '';
      
      try {
        this.updateProgress('학생 데이터 수집 중...', 20);
        
        // 1단계: 학생 데이터 수집
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        this.updateProgress('AI 문서 생성 중...', 60);
        
        // 2단계: AI 문서 생성
        const response = await fetch('/api/ai/generate-admin-document', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: JSON.stringify({
            document_type: this.documentType,
            student_ids: this.selectedStudentIds,
            period: (this.period.start && this.period.end) ? this.period : null,
            template_options: {}
          })
        });
        
        this.updateProgress('문서 후처리 중...', 90);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success) {
          // UTF-8 안전성 검증
          if (!this.validateUTF8(result.data.document)) {
            throw new Error('생성된 문서에 인코딩 문제가 있습니다.');
          }
          
          this.generatedDocument = {
            content: result.data.document,
            metadata: result.data.metadata || {}
          };
          
          this.updateProgress('문서 생성 완료', 100);
          
          // 성공 이벤트 디스패치
          this.$dispatch('ai:admin-document-generated', {
            document: this.generatedDocument,
            documentType: this.documentType,
            studentIds: this.selectedStudentIds,
            period: this.period
          });
        } else {
          this.errorMessage = result.error?.message || 'AI 행정문서 생성에 실패했습니다.';
        }
      } catch (error) {
        console.error('AI 행정문서 생성 오류:', error);
        this.errorMessage = '예상치 못한 오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
      } finally {
        this.isGenerating = false;
        // 진행 표시 리셋
        setTimeout(() => {
          this.progress = 0;
          this.currentStep = '';
        }, 2000);
      }
    },
    
    // 문서 다운로드
    downloadDocument() {
      if (!this.generatedDocument) return;
      
      const blob = new Blob([this.generatedDocument.content], { type: 'text/plain;charset=utf-8' });
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `${this.documentTypeLabels[this.documentType]}_${new Date().toISOString().split('T')[0]}.txt`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      window.URL.revokeObjectURL(url);
      
      // 다운로드 이벤트 디스패치
      this.$dispatch('ai:document-downloaded', {
        documentType: this.documentType,
        studentIds: this.selectedStudentIds
      });
    },
    
    // 문서 저장
    saveDocument() {
      if (!this.generatedDocument) return;
      
      // HTMX를 통해 서버에 저장
      if (typeof htmx !== 'undefined') {
        htmx.trigger(this.$el, 'hx:trigger', {
          target: '/api/ai/save-admin-document',
          values: {
            document_type: this.documentType,
            student_ids: JSON.stringify(this.selectedStudentIds),
            period: JSON.stringify(this.period),
            document: this.generatedDocument.content,
            metadata: JSON.stringify(this.generatedDocument.metadata)
          }
        });
      }
      
      // 저장 이벤트 디스패치
      this.$dispatch('ai:document-saved', {
        documentType: this.documentType,
        studentIds: this.selectedStudentIds,
        document: this.generatedDocument
      });
    }
  };
}
</script>
```
```

---

## 5.9 교육과정 관리 컴포넌트 (관리자 전용)

### 5.9.1 교육과정 목록 컴포넌트
```html
<!-- 교육과정 목록 컴포넌트 -->
<div class="bg-white rounded-lg shadow-md p-6" 
     x-data="curriculumListManager()" 
     x-init="initComponent()">
  
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-semibold">교육과정 관리</h3>
    <button
      @click="showUploadModal = true"
      class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
    >
      Excel 업로드
    </button>
  </div>
  
  <!-- 필터 및 검색 -->
  <div class="grid grid-cols-4 gap-4 mb-4">
    <!-- 교과 선택 -->
    <select x-model="filters.subject" 
            @change="applyFilters()"
            class="px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
      <option value="">교과 선택</option>
      <option value="국어">국어</option>
      <option value="수학">수학</option>
    </select>
    
    <!-- 학년 선택 -->
    <select x-model="filters.gradeLevel" 
            @change="applyFilters()"
            class="px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
      <option value="">학년 선택</option>
      <option value="1학년">1학년</option>
      <option value="2학년">2학년</option>
      <option value="3학년">3학년</option>
      <option value="4학년">4학년</option>
      <option value="5학년">5학년</option>
      <option value="6학년">6학년</option>
    </select>
    
    <!-- 학기 선택 -->
    <select x-model="filters.semester" 
            @change="applyFilters()"
            class="px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
      <option value="">학기 선택</option>
      <option value="1학기">1학기</option>
      <option value="2학기">2학기</option>
    </select>
    
    <!-- 검색 -->
    <input 
      type="text" 
      x-model="searchQuery" 
      @input="debounceSearch()"
      placeholder="단원명 검색" 
      class="px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
    />
  </div>
  
  <!-- 로딩 인디케이터 -->
  <div x-show="isLoading" class="flex justify-center py-8">
    <svg class="animate-spin h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  </div>
  
  <!-- 교육과정 목록 테이블 -->
  <div x-show="!isLoading" class="overflow-x-auto">
    <table class="w-full border-collapse">
      <thead>
        <tr class="bg-gray-50">
          <th class="p-3 text-left border-b">교과</th>
          <th class="p-3 text-left border-b">학년</th>
          <th class="p-3 text-left border-b">학기</th>
          <th class="p-3 text-left border-b">단원</th>
          <th class="p-3 text-left border-b">단원명</th>
          <th class="p-3 text-left border-b">상태</th>
          <th class="p-3 text-left border-b">작업</th>
        </tr>
      </thead>
      <tbody>
        <template x-for="unit in filteredUnits" :key="unit.id">
          <tr class="border-b hover:bg-gray-50 transition-colors">
            <td class="p-3" x-text="unit.subject"></td>
            <td class="p-3" x-text="unit.grade_level"></td>
            <td class="p-3" x-text="unit.semester"></td>
            <td class="p-3" x-text="unit.unit_number"></td>
            <td class="p-3" x-text="unit.unit_name"></td>
            <td class="p-3">
              <span 
                class="px-2 py-1 rounded text-xs"
                :class="unit.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'"
                x-text="unit.is_active ? '활성' : '비활성'"
              ></span>
            </td>
            <td class="p-3">
              <button
                @click="editUnit(unit)"
                class="px-3 py-1 text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-colors"
              >
                수정
              </button>
              <button
                @click="deleteUnit(unit.id)"
                class="ml-2 px-3 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded transition-colors"
              >
                삭제
              </button>
            </td>
          </tr>
        </template>
      </tbody>
    </table>
    
    <!-- 데이터 없음 -->
    <div x-show="filteredUnits.length === 0" class="text-center py-8 text-gray-500">
      조건에 맞는 교육과정을 찾을 수 없습니다.
    </div>
  </div>
  
  <!-- 페이지네이션 -->
  <div x-show="totalPages > 1" class="flex justify-center items-center mt-4 space-x-2">
    <button
      @click="changePage(currentPage - 1)"
      :disabled="currentPage === 1"
      class="px-3 py-1 rounded border disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"
    >
      이전
    </button>
    
    <template x-for="page in pageNumbers" :key="page">
      <button
        @click="changePage(page)"
        :class="page === currentPage ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'"
        class="px-3 py-1 rounded border"
        x-text="page"
      ></button>
    </template>
    
    <button
      @click="changePage(currentPage + 1)"
      :disabled="currentPage === totalPages"
      class="px-3 py-1 rounded border disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"
    >
      다음
    </button>
  </div>
</div>

<script>
function curriculumListManager() {
  return {
    // 컴포넌트 상태
    units: [],
    filteredUnits: [],
    isLoading: false,
    searchQuery: '',
    showUploadModal: false,
    
    // 필터
    filters: {
      subject: '',
      gradeLevel: '',
      semester: ''
    },
    
    // 페이지네이션
    currentPage: 1,
    itemsPerPage: 20,
    totalPages: 0,
    pageNumbers: [],
    
    // 검색 디바운싱
    searchTimeout: null,
    
    // 초기화
    async initComponent() {
      await this.loadUnits();
      this.applyFilters();
      
      // 이벤트 리스너 등록
      this.$el.addEventListener('curriculum:unit-updated', () => {
        this.loadUnits();
      });
      
      this.$el.addEventListener('curriculum:unit-deleted', () => {
        this.loadUnits();
      });
    },
    
    // 교육과정 단원 로드
    async loadUnits() {
      this.isLoading = true;
      
      try {
        const response = await fetch('/api/curriculum/units', {
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          const result = await response.json();
          this.units = result.data || [];
          
          // 전역 상태 업데이트
          const curriculumStore = Alpine.store('curriculum');
          if (curriculumStore) {
            curriculumStore.units = this.units;
          }
        } else {
          console.error('교육과정 로드 실패');
        }
      } catch (error) {
        console.error('교육과정 로드 오류:', error);
      } finally {
        this.isLoading = false;
      }
    },
    
    // 필터 적용
    applyFilters() {
      let filtered = [...this.units];
      
      // 교과 필터
      if (this.filters.subject) {
        filtered = filtered.filter(unit => unit.subject === this.filters.subject);
      }
      
      // 학년 필터
      if (this.filters.gradeLevel) {
        filtered = filtered.filter(unit => unit.grade_level === this.filters.gradeLevel);
      }
      
      // 학기 필터
      if (this.filters.semester) {
        filtered = filtered.filter(unit => unit.semester === this.filters.semester);
      }
      
      // 검색 필터
      if (this.searchQuery.trim()) {
        const query = this.searchQuery.toLowerCase().trim();
        filtered = filtered.filter(unit => 
          unit.unit_name.toLowerCase().includes(query) ||
          unit.unit_number.toString().includes(query)
        );
      }
      
      this.filteredUnits = filtered;
      this.updatePagination();
    },
    
    // 검색 디바운싱
    debounceSearch() {
      clearTimeout(this.searchTimeout);
      this.searchTimeout = setTimeout(() => {
        this.applyFilters();
      }, 300);
    },
    
    // 페이지네이션 업데이트
    updatePagination() {
      this.totalPages = Math.ceil(this.filteredUnits.length / this.itemsPerPage);
      
      // 페이지 번호 리스트 생성
      const pages = [];
      for (let i = 1; i <= this.totalPages; i++) {
        pages.push(i);
      }
      this.pageNumbers = pages;
      
      // 현재 페이지 범위 조정
      if (this.currentPage > this.totalPages) {
        this.currentPage = Math.max(1, this.totalPages);
      }
      
      // 페이지별 데이터 설정
      const startIndex = (this.currentPage - 1) * this.itemsPerPage;
      const endIndex = startIndex + this.itemsPerPage;
      this.filteredUnits = this.filteredUnits.slice(startIndex, endIndex);
    },
    
    // 페이지 변경
    changePage(page) {
      if (page >= 1 && page <= this.totalPages) {
        this.currentPage = page;
        this.applyFilters();
      }
    },
    
    // 단원 편집
    editUnit(unit) {
      // 편집 이벤트 디스패치
      this.$dispatch('curriculum:edit-unit', {
        unit: unit
      });
    },
    
    // 단원 삭제
    async deleteUnit(unitId) {
      if (!confirm('이 단원을 삭제하시겠습니까?')) return;
      
      try {
        const response = await fetch(`/api/curriculum/units/${unitId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          // 로컬 상태 업데이트
          this.units = this.units.filter(unit => unit.id !== unitId);
          this.applyFilters();
          
          // 삭제 이벤트 디스패치
          this.$dispatch('curriculum:unit-deleted', {
            unitId: unitId
          });
        } else {
          alert('단원 삭제에 실패했습니다.');
        }
      } catch (error) {
        console.error('단원 삭제 오류:', error);
        alert('예상치 못한 오류가 발생했습니다.');
      }
    }
  };
}
</script>
```
```

### 5.9.2 교육과정 업로드 컴포넌트
```html
<!-- 교육과정 업로드 모달 -->
<div x-show="showUploadModal" 
     x-data="curriculumUploadManager()"
     x-init="initComponent()"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
     @click.self="closeModal()"
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0">
  
  <div class="bg-white rounded-lg p-6 w-96 max-w-md mx-4"
       @click.stop
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0 transform scale-95"
       x-transition:enter-end="opacity-100 transform scale-100"
       x-transition:leave="transition ease-in duration-200"
       x-transition:leave-start="opacity-100 transform scale-100"
       x-transition:leave-end="opacity-0 transform scale-95">
    
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">교육과정 업로드</h3>
      <button
        @click="closeModal()"
        class="text-gray-400 hover:text-gray-600 text-xl leading-none"
      >
        ×
      </button>
    </div>
    
    <!-- 파일 선택 -->
    <div class="mb-4">
      <label class="block text-sm font-medium mb-2">Excel 파일 선택</label>
      <input
        type="file"
        accept=".xlsx"
        @change="handleFileSelect($event)"
        class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
      />
      
      <!-- 선택된 파일 정보 -->
      <div x-show="selectedFile" class="mt-2 p-2 bg-blue-50 rounded border">
        <div class="flex items-center">
          <svg class="w-4 h-4 text-blue-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"/>
          </svg>
          <span class="text-sm text-blue-700" x-text="selectedFile?.name"></span>
        </div>
        <div class="text-xs text-blue-600 mt-1" x-text="formatFileSize(selectedFile?.size)"></div>
      </div>
      
      <!-- 파일 형식 에러 -->
      <div x-show="fileError" x-text="fileError" class="mt-2 text-sm text-red-600"></div>
    </div>
    
    <!-- 템플릿 다운로드 -->
    <div class="mb-4">
      <button
        @click="downloadTemplate()"
        class="px-4 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"
      >
        📄 템플릿 다운로드
      </button>
      <p class="text-sm text-gray-600 mt-2">
        템플릿 컬럼: 단원번호 | 단원명 | 단원 교육목표(성취기준) | 단원 교육내용 | 평가계획(참고용)
      </p>
    </div>
    
    <!-- 업로드 진행상황 -->
    <div x-show="isUploading" class="mb-4">
      <div class="flex justify-between text-sm mb-1">
        <span>업로드 중...</span>
        <span x-text="uploadProgress + '%'"></span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div 
          class="bg-blue-500 h-2 rounded-full transition-all duration-300"
          :style="`width: ${uploadProgress}%`"
        ></div>
      </div>
      <div x-show="currentStep" class="text-xs text-gray-600 mt-1" x-text="currentStep"></div>
    </div>
    
    <!-- 업로드 결과 -->
    <div x-show="uploadResult" class="mb-4">
      <div :class="uploadResult?.success ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800'"
           class="p-3 rounded border">
        <div class="font-medium" x-text="uploadResult?.success ? '✅ 업로드 완료' : '❌ 업로드 실패'"></div>
        <div class="text-sm mt-1" x-text="uploadResult?.message"></div>
        
        <!-- 성공 시 통계 정보 -->
        <div x-show="uploadResult?.success && uploadResult?.stats" class="mt-2 text-sm">
          <div>총 <span x-text="uploadResult?.stats?.total"></span>개 항목 중</div>
          <div>✅ 성공: <span x-text="uploadResult?.stats?.success"></span>개</div>
          <div x-show="uploadResult?.stats?.failed > 0">
            ❌ 실패: <span x-text="uploadResult?.stats?.failed"></span>개
          </div>
        </div>
      </div>
    </div>
    
    <!-- 액션 버튼 -->
    <div class="flex justify-end space-x-2">
      <button
        @click="closeModal()"
        :disabled="isUploading"
        class="px-4 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        취소
      </button>
      <button
        @click="handleUpload()"
        :disabled="!selectedFile || isUploading"
        class="px-4 py-2 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        x-text="isUploading ? '업로드 중...' : '업로드'"
      >
      </button>
    </div>
  </div>
</div>

<script>
function curriculumUploadManager() {
  return {
    // 컴포넌트 상태
    selectedFile: null,
    fileError: '',
    isUploading: false,
    uploadProgress: 0,
    currentStep: '',
    uploadResult: null,
    
    // 초기화
    initComponent() {
      // 모달이 열릴 때 상태 초기화
      this.selectedFile = null;
      this.fileError = '';
      this.isUploading = false;
      this.uploadProgress = 0;
      this.currentStep = '';
      this.uploadResult = null;
    },
    
    // 파일 선택 처리
    handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) {
        this.selectedFile = null;
        this.fileError = '';
        return;
      }
      
      // 파일 형식 검증
      const allowedTypes = [
        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        'application/vnd.ms-excel'
      ];
      
      if (!allowedTypes.includes(file.type) && !file.name.toLowerCase().endsWith('.xlsx')) {
        this.selectedFile = null;
        this.fileError = 'Excel 파일(.xlsx)만 업로드 가능합니다.';
        return;
      }
      
      // 파일 크기 검증 (10MB 제한)
      const maxSize = 10 * 1024 * 1024;
      if (file.size > maxSize) {
        this.selectedFile = null;
        this.fileError = '파일 크기는 10MB 이하여야 합니다.';
        return;
      }
      
      this.selectedFile = file;
      this.fileError = '';
      this.uploadResult = null;
    },
    
    // 파일 크기 포맷팅
    formatFileSize(bytes) {
      if (!bytes) return '';
      
      if (bytes < 1024) return bytes + ' bytes';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    },
    
    // 템플릿 다운로드
    async downloadTemplate() {
      try {
        const response = await fetch('/api/curriculum/template', {
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = '교육과정_업로드_템플릿.xlsx';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          window.URL.revokeObjectURL(url);
        } else {
          alert('템플릿 다운로드에 실패했습니다.');
        }
      } catch (error) {
        console.error('템플릿 다운로드 오류:', error);
        alert('템플릿 다운로드 중 오류가 발생했습니다.');
      }
    },
    
    // 업로드 처리
    async handleUpload() {
      if (!this.selectedFile) return;
      
      this.isUploading = true;
      this.uploadProgress = 0;
      this.currentStep = '파일 검증 중...';
      this.uploadResult = null;
      
      try {
        // FormData 생성
        const formData = new FormData();
        formData.append('file', this.selectedFile);
        
        // 업로드 요청
        const response = await fetch('/api/curriculum/upload', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: formData
        });
        
        // 진행상황 시뮬레이션 (실제 환경에서는 서버에서 progress 이벤트 사용)
        const progressInterval = setInterval(() => {
          if (this.uploadProgress < 90) {
            this.uploadProgress += Math.random() * 20;
            if (this.uploadProgress > 90) this.uploadProgress = 90;
          }
        }, 200);
        
        this.currentStep = '데이터 처리 중...';
        
        const result = await response.json();
        clearInterval(progressInterval);
        
        this.uploadProgress = 100;
        this.currentStep = '완료';
        
        if (response.ok) {
          this.uploadResult = {
            success: true,
            message: result.message || '교육과정 업로드가 완료되었습니다.',
            stats: result.stats
          };
          
          // 성공 이벤트 디스패치
          this.$dispatch('curriculum:upload-complete', {
            result: result.data,
            stats: result.stats
          });
          
        } else {
          this.uploadResult = {
            success: false,
            message: result.error || '업로드에 실패했습니다.'
          };
        }
        
      } catch (error) {
        console.error('업로드 오류:', error);
        this.uploadResult = {
          success: false,
          message: '네트워크 오류가 발생했습니다.'
        };
      } finally {
        this.isUploading = false;
        this.currentStep = '';
      }
    },
    
    // 모달 닫기
    closeModal() {
      if (this.isUploading) {
        if (!confirm('업로드가 진행 중입니다. 정말 취소하시겠습니까?')) {
          return;
        }
      }
      
      // 상위 컴포넌트에 모달 닫기 이벤트 전달
      this.$dispatch('curriculum:close-upload-modal');
      
      // 모달 숨기기
      this.$el.closest('[x-data]').showUploadModal = false;
    }
  };
}
</script>
```

### 5.9.3 교육과정 단원 편집 컴포넌트
```html
<!-- 교육과정 단원 편집 폼 -->
<form @submit.prevent="handleSubmit()" 
      x-data="curriculumUnitEditor()" 
      x-init="initEditor()"
      class="bg-white rounded-lg shadow-md p-6">
  
  <h3 class="text-lg font-semibold mb-4" x-text="editingUnit ? '교육과정 단원 수정' : '교육과정 단원 추가'"></h3>
  
  <!-- 기본 정보 -->
  <div class="grid grid-cols-2 gap-4 mb-4">
    <!-- 교과 선택 -->
    <div>
      <label class="block text-sm font-medium mb-2">교과</label>
      <select x-model="formData.subject" 
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
        <option value="국어">국어</option>
        <option value="수학">수학</option>
      </select>
    </div>
    
    <!-- 학년 선택 -->
    <div>
      <label class="block text-sm font-medium mb-2">학년</label>
      <select x-model="formData.grade_level" 
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
        <template x-for="grade in grades" :key="grade">
          <option :value="grade" x-text="grade"></option>
        </template>
      </select>
    </div>
  </div>
  
  <!-- 학기, 단원번호, 단원명 -->
  <div class="grid grid-cols-3 gap-4 mb-4">
    <div>
      <label class="block text-sm font-medium mb-2">학기</label>
      <select x-model="formData.semester" 
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
        <option value="1학기">1학기</option>
        <option value="2학기">2학기</option>
      </select>
    </div>
    
    <div>
      <label class="block text-sm font-medium mb-2">단원 번호</label>
      <input type="number" 
             x-model="formData.unit_number" 
             min="1" 
             class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" />
    </div>
    
    <div>
      <label class="block text-sm font-medium mb-2">단원명 *</label>
      <input type="text" 
             x-model="formData.unit_name" 
             required 
             class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
             placeholder="단원명을 입력하세요" />
    </div>
  </div>
  
  <!-- 교육목표 (성취기준) -->
  <div class="mb-4">
    <label class="block text-sm font-medium mb-2">교육목표 (성취기준)</label>
    <template x-for="(objective, index) in formData.learning_objectives" :key="index">
      <div class="flex mb-2">
        <input type="text" 
               x-model="formData.learning_objectives[index]" 
               class="flex-1 mr-2 px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
               placeholder="교육목표를 입력하세요" />
        <button type="button" 
                @click="removeObjective(index)" 
                x-show="formData.learning_objectives.length > 1"
                class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
          삭제
        </button>
      </div>
    </template>
    <button type="button" 
            @click="addObjective()" 
            class="px-4 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
      + 목표 추가
    </button>
  </div>
  
  <!-- 교육내용 -->
  <div class="mb-4">
    <label class="block text-sm font-medium mb-2">교육내용</label>
    <template x-for="(content, index) in formData.learning_contents" :key="index">
      <div class="flex mb-2">
        <input type="text" 
               x-model="formData.learning_contents[index]" 
               class="flex-1 mr-2 px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
               placeholder="교육내용을 입력하세요" />
        <button type="button" 
                @click="removeContent(index)" 
                x-show="formData.learning_contents.length > 1"
                class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
          삭제
        </button>
      </div>
    </template>
    <button type="button" 
            @click="addContent()" 
            class="px-4 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
      + 내용 추가
    </button>
  </div>
  
  <!-- 평가계획 -->
  <div class="mb-6">
    <label class="block text-sm font-medium mb-2">평가계획</label>
    <textarea x-model="formData.assessment_plan" 
              class="w-full p-3 border border-gray-300 rounded-lg h-24 focus:ring-blue-500 focus:border-blue-500" 
              placeholder="평가 방법 및 기준을 입력하세요..."></textarea>
  </div>
  
  <!-- 저장 버튼 -->
  <div class="flex justify-end space-x-2">
    <button type="button" 
            @click="cancelEdit()" 
            class="px-4 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
      취소
    </button>
    <button type="submit" 
            :disabled="isSaving" 
            class="px-4 py-2 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            x-text="isSaving ? '저장 중...' : '저장'">
    </button>
  </div>
</form>

<script>
function curriculumUnitEditor() {
  return {
    // 컴포넌트 상태
    editingUnit: null,
    isSaving: false,
    
    // 폼 데이터
    formData: {
      subject: '국어',
      grade_level: '1학년',
      semester: '1학기',
      unit_number: 1,
      unit_name: '',
      learning_objectives: [''],
      learning_contents: [''],
      assessment_plan: ''
    },
    
    // 옵션 데이터
    grades: ['1학년', '2학년', '3학년', '4학년', '5학년', '6학년'],
    
    // 초기화
    initEditor() {
      // 편집 모드 이벤트 리스너
      this.$el.addEventListener('curriculum:edit-unit', (e) => {
        this.loadUnitForEdit(e.detail.unit);
      });
      
      // 새 단원 추가 이벤트 리스너
      this.$el.addEventListener('curriculum:add-unit', () => {
        this.resetForm();
      });
    },
    
    // 편집할 단원 로드
    loadUnitForEdit(unit) {
      this.editingUnit = unit;
      this.formData = {
        subject: unit.subject || '국어',
        grade_level: unit.grade_level || '1학년',
        semester: unit.semester || '1학기',
        unit_number: unit.unit_number || 1,
        unit_name: unit.unit_name || '',
        learning_objectives: unit.learning_objectives?.length ? [...unit.learning_objectives] : [''],
        learning_contents: unit.learning_contents?.length ? [...unit.learning_contents] : [''],
        assessment_plan: unit.assessment_plan || ''
      };
    },
    
    // 폼 초기화
    resetForm() {
      this.editingUnit = null;
      this.formData = {
        subject: '국어',
        grade_level: '1학년',
        semester: '1학기',
        unit_number: 1,
        unit_name: '',
        learning_objectives: [''],
        learning_contents: [''],
        assessment_plan: ''
      };
    },
    
    // 교육목표 추가
    addObjective() {
      this.formData.learning_objectives.push('');
    },
    
    // 교육목표 제거
    removeObjective(index) {
      if (this.formData.learning_objectives.length > 1) {
        this.formData.learning_objectives.splice(index, 1);
      }
    },
    
    // 교육내용 추가
    addContent() {
      this.formData.learning_contents.push('');
    },
    
    // 교육내용 제거
    removeContent(index) {
      if (this.formData.learning_contents.length > 1) {
        this.formData.learning_contents.splice(index, 1);
      }
    },
    
    // 폼 제출
    async handleSubmit() {
      // 유효성 검사
      if (!this.validateForm()) return;
      
      this.isSaving = true;
      
      try {
        // UTF-8 안전성 검증
        const textFields = [this.formData.unit_name, this.formData.assessment_plan, ...this.formData.learning_objectives, ...this.formData.learning_contents];
        for (const text of textFields) {
          if (text && !this.validateUTF8(text)) {
            alert('입력된 텍스트에 인코딩 문제가 있습니다. 다시 확인해주세요.');
            return;
          }
        }
        
        const url = this.editingUnit ? `/api/curriculum/units/${this.editingUnit.id}` : '/api/curriculum/units';
        const method = this.editingUnit ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method: method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: JSON.stringify(this.formData)
        });
        
        if (response.ok) {
          const result = await response.json();
          
          // 성공 이벤트 디스패치
          this.$dispatch('curriculum:unit-saved', {
            unit: result.data,
            isNew: !this.editingUnit
          });
          
          // 폼 초기화
          this.resetForm();
          
        } else {
          const error = await response.json();
          alert(error.message || '저장에 실패했습니다.');
        }
        
      } catch (error) {
        console.error('단원 저장 오류:', error);
        alert('예상치 못한 오류가 발생했습니다.');
      } finally {
        this.isSaving = false;
      }
    },
    
    // 편집 취소
    cancelEdit() {
      this.resetForm();
      this.$dispatch('curriculum:cancel-edit');
    },
    
    // 폼 유효성 검사
    validateForm() {
      if (!this.formData.unit_name.trim()) {
        alert('단원명을 입력해주세요.');
        return false;
      }
      
      if (this.formData.unit_number < 1) {
        alert('단원 번호는 1 이상이어야 합니다.');
        return false;
      }
      
      // 빈 교육목표 제거
      this.formData.learning_objectives = this.formData.learning_objectives.filter(obj => obj.trim());
      if (this.formData.learning_objectives.length === 0) {
        this.formData.learning_objectives = [''];
      }
      
      // 빈 교육내용 제거
      this.formData.learning_contents = this.formData.learning_contents.filter(content => content.trim());
      if (this.formData.learning_contents.length === 0) {
        this.formData.learning_contents = [''];
      }
      
      return true;
    },
    
    // UTF-8 검증
    validateUTF8(text) {
      try {
        const encoded = new TextEncoder().encode(text);
        const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
        return decoded === text;
      } catch (error) {
        return false;
      }
    }
  };
}
</script>
```

---

## 5.13 관리자 시스템 컴포넌트

### 5.13.1 AdminDashboard 컴포넌트
```html
<!-- 관리자 대시보드 -->
<div class="space-y-6" 
     x-data="adminDashboard()" 
     x-init="initDashboard()">
  
  <!-- 통계 카드 -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
    <!-- 전체 사용자 -->
    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center">
        <div class="p-2 bg-blue-100 rounded-lg">
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
          </svg>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-gray-600">전체 사용자</p>
          <p class="text-2xl font-semibold text-gray-900" x-text="statistics.totalUsers"></p>
          <p class="text-sm text-green-600" x-text="statistics.userGrowth"></p>
        </div>
      </div>
    </div>
    
    <!-- 활성 사용자 -->
    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center">
        <div class="p-2 bg-green-100 rounded-lg">
          <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-gray-600">활성 사용자</p>
          <p class="text-2xl font-semibold text-gray-900" x-text="statistics.activeUsers"></p>
          <p class="text-sm text-blue-600" x-text="getActiveUserPercentage() + '%'"></p>
        </div>
      </div>
    </div>
    
    <!-- 전체 학생 -->
    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center">
        <div class="p-2 bg-yellow-100 rounded-lg">
          <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-gray-600">전체 학생</p>
          <p class="text-2xl font-semibold text-gray-900" x-text="statistics.totalStudents"></p>
          <p class="text-sm text-gray-500" x-text="statistics.avgStudentsPerUser + ' 명/교사'"></p>
        </div>
      </div>
    </div>
    
    <!-- MCP 기반 총 결제액 -->
    <div class="bg-white rounded-lg shadow p-6" x-data="{
      mcpRevenue: 0,
      mcpGrowth: '0%',
      async init() {
        await this.loadMcpRevenueData();
      },
      async loadMcpRevenueData() {
        try {
          // Toss Payments MCP를 통한 수익 데이터 조회
          const revenueResult = await window.mcp.callTool(
            'tosspayments-integration-guide',
            'getRevenueStatistics',
            { period: 'monthly' }
          );
          
          if (revenueResult.success) {
            this.mcpRevenue = revenueResult.data.total_revenue;
            this.mcpGrowth = revenueResult.data.growth_percentage + '%';
          }
        } catch (error) {
          console.error('💳 MCP 수익 데이터 로드 오류:', error);
          // 폴백: Supabase MCP로 대체 데이터 조회
          await this.loadSupabaseRevenueData();
        }
      },
      async loadSupabaseRevenueData() {
        try {
          const result = await window.mcp.callTool(
            'supabase-mcp-server',
            'execute_sql',
            {
              query: 'SELECT SUM(amount) as total_revenue FROM payments WHERE status = \'completed\''
            }
          );
          
          if (result.success && result.data.length > 0) {
            this.mcpRevenue = result.data[0].total_revenue || 0;
          }
        } catch (error) {
          console.error('📊 Supabase MCP 수익 데이터 오류:', error);
        }
      }
    }">
      <div class="flex items-center">
        <div class="p-2 bg-purple-100 rounded-lg">
          <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
          </svg>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-gray-600">MCP 총 결제액</p>
          <p class="text-2xl font-semibold text-gray-900" x-text="formatCurrency(mcpRevenue)"></p>
          <p class="text-sm text-green-600" x-text="mcpGrowth"></p>
          <p class="text-xs text-gray-400 mt-1">토스페이먼츠 MCP 연동</p>
        </div>
      </div>
    </div>
    
    <!-- 활성 라이선스 -->
    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center">
        <div class="p-2 bg-indigo-100 rounded-lg">
          <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-gray-600">활성 라이선스</p>
          <p class="text-2xl font-semibold text-gray-900" x-text="statistics.activeLicenses"></p>
          <p class="text-sm text-gray-500" x-text="statistics.licenseUtilization + '%'"></p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 차트 영역 -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- 사용자 성장 차트 -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold mb-4">사용자 성장 추이</h3>
      <canvas x-ref="userGrowthChart" class="w-full h-64"></canvas>
    </div>
    
    <!-- 라이선스 분포 차트 -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold mb-4">라이선스 분포</h3>
      <canvas x-ref="licenseChart" class="w-full h-64"></canvas>
    </div>
  </div>
  
  <!-- 활동 로그 -->
  <div class="bg-white rounded-lg shadow p-6">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">최근 활동</h3>
      <button
        @click="refreshActivityLog()"
        class="px-3 py-1 text-sm text-blue-600 hover:text-blue-800 border border-blue-600 rounded hover:bg-blue-50 transition-colors"
      >
        새로고침
      </button>
    </div>
    
    <div x-show="isLoadingActivity" class="flex justify-center py-8">
      <svg class="animate-spin h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    </div>
    
    <div x-show="!isLoadingActivity" class="space-y-3">
      <template x-for="activity in recentActivities" :key="activity.id">
        <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
          <div class="flex-shrink-0">
            <div :class="getActivityIconClass(activity.type)" class="w-8 h-8 rounded-full flex items-center justify-center">
              <span class="text-xs font-medium" x-text="getActivityIcon(activity.type)"></span>
            </div>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-gray-900" x-text="activity.user_name"></p>
            <p class="text-sm text-gray-500" x-text="activity.description"></p>
          </div>
          <div class="flex-shrink-0 text-sm text-gray-400" x-text="formatTimeAgo(activity.created_at)"></div>
        </div>
      </template>
      
      <div x-show="recentActivities.length === 0" class="text-center py-8 text-gray-500">
        최근 활동이 없습니다.
      </div>
    </div>
  </div>
</div>

<script>
function adminDashboard() {
  return {
    // 컴포넌트 상태
    statistics: {
      totalUsers: 0,
      activeUsers: 0,
      totalStudents: 0,
      totalRevenue: 0,
      activeLicenses: 0,
      userGrowth: '+0%',
      revenueGrowth: '+0%',
      avgStudentsPerUser: 0,
      licenseUtilization: 0
    },
    recentActivities: [],
    isLoadingActivity: false,
    userGrowthChart: null,
    licenseChart: null,
    
    // 초기화
    async initDashboard() {
      await this.loadStatistics();
      await this.loadRecentActivities();
      
      // 차트 초기화 (다음 틱에서 실행하여 DOM 준비 대기)
      this.$nextTick(() => {
        this.initCharts();
      });
      
      // 주기적 업데이트 (5분마다)
      setInterval(() => {
        this.loadStatistics();
        this.loadRecentActivities();
      }, 5 * 60 * 1000);
    },
    
    // 통계 데이터 로드
    async loadStatistics() {
      try {
        const response = await fetch('/api/admin/statistics', {
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          const result = await response.json();
          this.statistics = {
            ...this.statistics,
            ...result.data
          };
        }
      } catch (error) {
        console.error('통계 데이터 로드 오류:', error);
      }
    },
    
    // 최근 활동 로드
    async loadRecentActivities() {
      this.isLoadingActivity = true;
      
      try {
        const response = await fetch('/api/admin/activities?limit=10', {
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          const result = await response.json();
          this.recentActivities = result.data || [];
        }
      } catch (error) {
        console.error('활동 로그 로드 오류:', error);
      } finally {
        this.isLoadingActivity = false;
      }
    },
    
    // 활동 로그 새로고침
    async refreshActivityLog() {
      await this.loadRecentActivities();
    },
    
    // 활성 사용자 비율 계산
    getActiveUserPercentage() {
      if (this.statistics.totalUsers === 0) return 0;
      return Math.round((this.statistics.activeUsers / this.statistics.totalUsers) * 100);
    },
    
    // 통화 포맷팅
    formatCurrency(amount) {
      return new Intl.NumberFormat('ko-KR', {
        style: 'currency',
        currency: 'KRW'
      }).format(amount);
    },
    
    // 상대적 시간 포맷팅
    formatTimeAgo(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffInMinutes = Math.floor((now - date) / (1000 * 60));
      
      if (diffInMinutes < 1) return '방금 전';
      if (diffInMinutes < 60) return `${diffInMinutes}분 전`;
      if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}시간 전`;
      return `${Math.floor(diffInMinutes / 1440)}일 전`;
    },
    
    // 활동 아이콘 클래스
    getActivityIconClass(type) {
      const classes = {
        'login': 'bg-green-100 text-green-600',
        'logout': 'bg-gray-100 text-gray-600',
        'create': 'bg-blue-100 text-blue-600',
        'update': 'bg-yellow-100 text-yellow-600',
        'delete': 'bg-red-100 text-red-600',
        'payment': 'bg-purple-100 text-purple-600'
      };
      return classes[type] || 'bg-gray-100 text-gray-600';
    },
    
    // 활동 아이콘
    getActivityIcon(type) {
      const icons = {
        'login': '→',
        'logout': '←',
        'create': '+',
        'update': '✎',
        'delete': '×',
        'payment': '$'
      };
      return icons[type] || '?';
    },
    
    // 차트 초기화
    initCharts() {
      if (typeof Chart === 'undefined') {
        console.warn('Chart.js가 로드되지 않았습니다.');
        return;
      }
      
      // 사용자 성장 차트
      if (this.$refs.userGrowthChart) {
        this.userGrowthChart = new Chart(this.$refs.userGrowthChart, {
          type: 'line',
          data: {
            labels: ['지난달', '이번달'],
            datasets: [{
              label: '사용자 수',
              data: [this.statistics.totalUsers - 50, this.statistics.totalUsers],
              borderColor: 'rgb(59, 130, 246)',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              tension: 0.1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false
          }
        });
      }
      
      // 라이선스 분포 차트
      if (this.$refs.licenseChart) {
        this.licenseChart = new Chart(this.$refs.licenseChart, {
          type: 'doughnut',
          data: {
            labels: ['활성', '비활성'],
            datasets: [{
              data: [this.statistics.activeLicenses, this.statistics.totalUsers - this.statistics.activeLicenses],
              backgroundColor: ['rgb(34, 197, 94)', 'rgb(229, 231, 235)']
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false
          }
        });
      }
    }
  };
}
</script>
```

### 5.13.2 UserManagementTable 컴포넌트
```html
<!-- 사용자 관리 테이블 -->
<div class="space-y-4" x-data="userManagementTable()" x-init="initTable()">
  
  <!-- 필터 영역 -->
  <div class="flex flex-col sm:flex-row gap-4">
    <input type="text" x-model="filters.search" @input="debounceSearch()" placeholder="사용자 검색..." class="flex-1 px-3 py-2 border border-gray-300 rounded-md" />
    <select x-model="filters.role" @change="applyFilters()" class="px-3 py-2 border rounded-md">
      <option value="all">전체 역할</option>
      <option value="teacher">교사</option>
      <option value="admin">관리자</option>
      <option value="super_admin">슈퍼 관리자</option>
    </select>
    <select x-model="filters.status" @change="applyFilters()" class="px-3 py-2 border rounded-md">
      <option value="all">전체 상태</option>
      <option value="active">활성</option>
      <option value="inactive">비활성</option>
    </select>
  </div>
  
  <!-- 로딩 인디케이터 -->
  <div x-show="isLoading" class="flex justify-center py-8">
    <svg class="animate-spin h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  </div>
  
  <!-- 사용자 테이블 -->
  <div x-show="!isLoading" class="bg-white rounded-lg shadow overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">사용자</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">역할</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">상태</th>
          <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">작업</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <template x-for="user in filteredUsers" :key="user.id">
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4">
              <div class="flex items-center space-x-3">
                <img :src="user.profile_image_url || '/default-avatar.png'" :alt="user.full_name" class="w-10 h-10 rounded-full" />
                <div>
                  <div class="text-sm font-medium" x-text="user.full_name"></div>
                  <div class="text-sm text-gray-500" x-text="user.email"></div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4">
              <span :class="getRoleClass(user.role)" class="px-2 py-1 text-xs rounded-full" x-text="getRoleLabel(user.role)"></span>
            </td>
            <td class="px-6 py-4">
              <span :class="user.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'" class="px-2 py-1 text-xs rounded-full" x-text="user.is_active ? '활성' : '비활성'"></span>
            </td>
            <td class="px-6 py-4 text-right space-x-2">
              <button @click="viewUserDetails(user.id)" class="text-blue-600 hover:text-blue-900 text-sm">상세</button>
              <button @click="toggleUserStatus(user.id, user.is_active)" :class="user.is_active ? 'text-red-600' : 'text-green-600'" class="text-sm" x-text="user.is_active ? '비활성화' : '활성화'"></button>
            </td>
          </tr>
        </template>
      </tbody>
    </table>
  </div>
</div>

<script>
function userManagementTable() {
  return {
    users: [],
    filteredUsers: [],
    isLoading: false,
    filters: { search: '', role: 'all', status: 'all' },
    searchTimeout: null,
    
    async initTable() {
      await this.loadUsers();
      this.applyFilters();
    },
    
    async loadUsers() {
      this.isLoading = true;
      try {
        const response = await fetch('/api/admin/users', {
          headers: { 'Authorization': `Bearer ${Alpine.store('auth').token}` }
        });
        if (response.ok) {
          const result = await response.json();
          this.users = result.data || [];
        }
      } catch (error) {
        console.error('사용자 로드 오류:', error);
      } finally {
        this.isLoading = false;
      }
    },
    
    applyFilters() {
      let filtered = [...this.users];
      if (this.filters.search.trim()) {
        const query = this.filters.search.toLowerCase();
        filtered = filtered.filter(user => 
          user.full_name.toLowerCase().includes(query) || user.email.toLowerCase().includes(query)
        );
      }
      if (this.filters.role !== 'all') {
        filtered = filtered.filter(user => user.role === this.filters.role);
      }
      if (this.filters.status !== 'all') {
        filtered = filtered.filter(user => 
          this.filters.status === 'active' ? user.is_active : !user.is_active
        );
      }
      this.filteredUsers = filtered;
    },
    
    debounceSearch() {
      clearTimeout(this.searchTimeout);
      this.searchTimeout = setTimeout(() => this.applyFilters(), 300);
    },
    
    viewUserDetails(userId) {
      this.$dispatch('user:view-details', { userId });
    },
    
    async toggleUserStatus(userId, currentStatus) {
      if (!confirm(currentStatus ? '비활성화하시겠습니까?' : '활성화하시겠습니까?')) return;
      try {
        const response = await fetch(`/api/admin/users/${userId}/toggle-status`, {
          method: 'PATCH',
          headers: { 'Authorization': `Bearer ${Alpine.store('auth').token}` }
        });
        if (response.ok) {
          await this.loadUsers();
          this.applyFilters();
        }
      } catch (error) {
        console.error('상태 변경 오류:', error);
      }
    },
    
    getRoleClass(role) {
      return role === 'super_admin' ? 'bg-red-100 text-red-800' :
             role === 'admin' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800';
    },
    
    getRoleLabel(role) {
      return role === 'super_admin' ? '슈퍼 관리자' :
             role === 'admin' ? '관리자' : '교사';
    }
  };
}
</script>
```

### 5.13.3 SystemSettingsPanel 컴포넌트
```html
<!-- 시스템 설정 패널 -->
<div class="bg-white rounded-lg shadow p-6" x-data="systemSettingsPanel()" x-init="initSettings()">
  
  <!-- 탭 네비게이션 -->
  <div class="border-b border-gray-200">
    <nav class="-mb-px flex space-x-8">
      <template x-for="tab in tabs" :key="tab.value">
        <button
          @click="activeTab = tab.value; filterSettingsByTab()"
          :class="activeTab === tab.value ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
          class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors"
          x-text="tab.label"
        ></button>
      </template>
    </nav>
  </div>
  
  <!-- 로딩 인디케이터 -->
  <div x-show="isLoading" class="flex justify-center py-8">
    <svg class="animate-spin h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  </div>
  
  <!-- 설정 목록 -->
  <div x-show="!isLoading" class="mt-6 space-y-6">
    <template x-for="setting in currentTabSettings" :key="setting.setting_key">
      <div class="flex items-center justify-between py-4 border-b border-gray-100 last:border-b-0">
        <!-- 설정 정보 -->
        <div class="flex-1">
          <h4 class="text-sm font-medium text-gray-900" x-text="setting.display_name"></h4>
          <p x-show="setting.description" class="text-sm text-gray-500 mt-1" x-text="setting.description"></p>
        </div>
        
        <!-- 설정 입력 -->
        <div class="ml-4">
          <!-- Boolean 스위치 -->
          <div x-show="setting.data_type === 'boolean'">
            <button
              @click="toggleBooleanSetting(setting.setting_key)"
              :class="getBooleanValue(setting) ? 'bg-blue-600' : 'bg-gray-200'"
              class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
            >
              <span 
                :class="getBooleanValue(setting) ? 'translate-x-6' : 'translate-x-1'"
                class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"
              ></span>
            </button>
          </div>
          
          <!-- Number 입력 -->
          <div x-show="setting.data_type === 'number'">
            <input
              type="number"
              :value="getCurrentValue(setting)"
              @input="handleSettingChange(setting.setting_key, parseInt($event.target.value))"
              class="w-24 px-3 py-1 text-sm border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          
          <!-- Text 입력 -->
          <div x-show="setting.data_type === 'string' || setting.data_type === 'text'">
            <input
              type="text"
              :value="getCurrentValue(setting)"
              @input="handleSettingChange(setting.setting_key, $event.target.value)"
              class="w-48 px-3 py-1 text-sm border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          
          <!-- Select 옵션 -->
          <div x-show="setting.data_type === 'select'">
            <select
              :value="getCurrentValue(setting)"
              @change="handleSettingChange(setting.setting_key, $event.target.value)"
              class="px-3 py-1 text-sm border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            >
              <template x-for="option in setting.options" :key="option.value">
                <option :value="option.value" x-text="option.label"></option>
              </template>
            </select>
          </div>
        </div>
      </div>
    </template>
    
    <!-- 데이터 없음 -->
    <div x-show="currentTabSettings.length === 0 && !isLoading" class="text-center py-8 text-gray-500">
      이 카테고리에는 설정이 없습니다.
    </div>
    
    <!-- 변경사항 적용 -->
    <div x-show="hasPendingChanges()" class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
      <button
        @click="cancelChanges()"
        class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
      >
        취소
      </button>
      <button
        @click="applyChanges()"
        :disabled="isSaving"
        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
        x-text="isSaving ? '저장 중...' : '변경사항 적용'"
      >
      </button>
    </div>
  </div>
  
  <!-- 성공 메시지 -->
  <div x-show="showSuccessMessage" 
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0 transform translate-y-2"
       x-transition:enter-end="opacity-100 transform translate-y-0"
       x-transition:leave="transition ease-in duration-200"
       x-transition:leave-start="opacity-100 transform translate-y-0"
       x-transition:leave-end="opacity-0 transform translate-y-2"
       class="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded shadow-lg z-50">
    <div class="flex items-center">
      <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
      </svg>
      설정이 성공적으로 저장되었습니다.
    </div>
  </div>
</div>

<script>
function systemSettingsPanel() {
  return {
    // 컴포넌트 상태
    settings: [],
    currentTabSettings: [],
    pendingChanges: {},
    isLoading: false,
    isSaving: false,
    showSuccessMessage: false,
    
    // 탭 설정
    activeTab: 'general',
    tabs: [
      { value: 'general', label: '일반 설정' },
      { value: 'security', label: '보안 설정' },
      { value: 'api', label: 'API 설정' },
      { value: 'notification', label: '알림 설정' }
    ],
    
    // 초기화
    async initSettings() {
      await this.loadSettings();
      this.filterSettingsByTab();
    },
    
    // 설정 데이터 로드
    async loadSettings() {
      this.isLoading = true;
      
      try {
        const response = await fetch('/api/admin/settings', {
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          const result = await response.json();
          this.settings = result.data || [];
        } else {
          console.error('설정 로드 실패');
        }
      } catch (error) {
        console.error('설정 로드 오류:', error);
      } finally {
        this.isLoading = false;
      }
    },
    
    // 탭별 설정 필터링
    filterSettingsByTab() {
      this.currentTabSettings = this.settings.filter(setting => 
        setting.setting_type === this.activeTab
      );
    },
    
    // 설정값 변경 처리
    handleSettingChange(key, value) {
      this.pendingChanges[key] = value;
    },
    
    // Boolean 설정 토글
    toggleBooleanSetting(key) {
      const currentValue = this.getBooleanValue(this.settings.find(s => s.setting_key === key));
      this.handleSettingChange(key, !currentValue);
    },
    
    // 현재값 가져오기
    getCurrentValue(setting) {
      return this.pendingChanges[setting.setting_key] ?? setting.setting_value;
    },
    
    // Boolean 값 가져오기
    getBooleanValue(setting) {
      const value = this.getCurrentValue(setting);
      return value === 'true' || value === true;
    },
    
    // 변경사항 존재 여부
    hasPendingChanges() {
      return Object.keys(this.pendingChanges).length > 0;
    },
    
    // 변경사항 취소
    cancelChanges() {
      this.pendingChanges = {};
    },
    
    // 변경사항 적용
    async applyChanges() {
      if (!this.hasPendingChanges()) return;
      
      this.isSaving = true;
      
      try {
        // 변경사항을 서버에 전송
        const response = await fetch('/api/admin/settings', {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: JSON.stringify({
            changes: this.pendingChanges
          })
        });
        
        if (response.ok) {
          // 로컬 상태 업데이트
          Object.entries(this.pendingChanges).forEach(([key, value]) => {
            const setting = this.settings.find(s => s.setting_key === key);
            if (setting) {
              setting.setting_value = value;
            }
          });
          
          // 변경사항 초기화
          this.pendingChanges = {};
          
          // 성공 메시지 표시
          this.showSuccessMessage = true;
          setTimeout(() => {
            this.showSuccessMessage = false;
          }, 3000);
          
          // 이벤트 디스패치
          this.$dispatch('settings:updated', {
            changes: this.pendingChanges
          });
          
        } else {
          const error = await response.json();
          alert(error.message || '설정 저장에 실패했습니다.');
        }
        
      } catch (error) {
        console.error('설정 저장 오류:', error);
        alert('예상치 못한 오류가 발생했습니다.');
      } finally {
        this.isSaving = false;
      }
    }
  };
}
</script>
```

### 5.13.4 NotificationCenter 컴포넌트
```html
<!-- 알림 센터 -->
<div class="bg-white rounded-lg shadow max-w-md mx-auto" x-data="notificationCenter()" x-init="loadNotifications()">
  
  <!-- 헤더 -->
  <div class="flex items-center justify-between p-4 border-b border-gray-200">
    <h3 class="text-lg font-semibold text-gray-900">
      알림
      <span x-show="unreadCount > 0" class="ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800" x-text="unreadCount"></span>
    </h3>
    <button 
      x-show="unreadCount > 0"
      @click="markAllAsRead()"
      :disabled="isProcessing"
      class="text-sm text-blue-600 hover:text-blue-800 disabled:opacity-50"
    >
      모두 읽음
    </button>
  </div>
  
  <!-- 로딩 -->
  <div x-show="isLoading" class="flex justify-center py-8">
    <svg class="animate-spin h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  </div>
  
  <!-- 알림 목록 -->
  <div x-show="!isLoading" class="max-h-96 overflow-y-auto">
    <!-- 빈 상태 -->
    <div x-show="notifications.length === 0" class="text-center py-8 text-gray-500">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5-5h5V7H9v5l-5 5h5v5z" />
      </svg>
      <h3 class="mt-2 text-sm font-medium text-gray-900">새로운 알림이 없습니다</h3>
      <p class="mt-1 text-sm text-gray-500">새 알림이 도착하면 여기에 표시됩니다.</p>
    </div>
    
    <!-- 알림 아이템 -->
    <template x-for="notification in notifications" :key="notification.id">
      <div 
        :class="notification.is_read ? 'bg-white hover:bg-gray-50' : 'bg-blue-50 hover:bg-blue-100'"
        class="border-b border-gray-100 last:border-b-0 transition-colors"
      >
        <div class="p-4">
          <div class="flex items-start justify-between">
            <!-- 알림 내용 -->
            <div class="flex-1 min-w-0">
              <!-- 읽지 않음 표시 -->
              <div x-show="!notification.is_read" class="flex items-center mb-1">
                <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                <span class="text-xs text-blue-600 font-medium">새 알림</span>
              </div>
              
              <h4 class="text-sm font-medium text-gray-900 mb-1" x-text="notification.title"></h4>
              <p class="text-sm text-gray-600 mb-2" x-text="notification.message"></p>
              <p class="text-xs text-gray-400" x-text="formatRelativeTime(notification.created_at)"></p>
            </div>
            
            <!-- 액션 버튼 -->
            <div class="flex items-center space-x-1 ml-3">
              <!-- 읽음 처리 -->
              <button 
                x-show="!notification.is_read"
                @click="markAsRead(notification.id)"
                :disabled="isProcessing"
                class="text-xs text-blue-600 hover:text-blue-800 px-2 py-1 rounded disabled:opacity-50"
              >
                읽음
              </button>
              
              <!-- 삭제 -->
              <button 
                @click="deleteNotification(notification.id)"
                :disabled="isProcessing"
                class="text-xs text-red-600 hover:text-red-800 px-2 py-1 rounded disabled:opacity-50"
              >
                삭제
              </button>
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>
  
  <!-- 하단 액션 -->
  <div x-show="notifications.length > 0 && !isLoading" class="p-4 border-t border-gray-200 bg-gray-50">
    <div class="flex justify-between items-center">
      <span class="text-sm text-gray-500" x-text="`총 ${notifications.length}개의 알림`"></span>
      <button 
        @click="refreshNotifications()"
        :disabled="isLoading"
        class="text-sm text-gray-600 hover:text-gray-800 disabled:opacity-50"
      >
        새로고침
      </button>
    </div>
  </div>
</div>

<script>
function notificationCenter() {
  return {
    // 상태
    notifications: [],
    isLoading: false,
    isProcessing: false,
    
    // 계산된 속성
    get unreadCount() {
      return this.notifications.filter(n => !n.is_read).length;
    },
    
    // 초기화
    async loadNotifications() {
      this.isLoading = true;
      
      try {
        const response = await fetch('/api/notifications', {
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          const result = await response.json();
          this.notifications = result.data || [];
        } else {
          console.error('알림 로드 실패');
        }
      } catch (error) {
        console.error('알림 로드 오류:', error);
      } finally {
        this.isLoading = false;
      }
    },
    
    // 새로고침
    async refreshNotifications() {
      await this.loadNotifications();
    },
    
    // 개별 읽음 처리
    async markAsRead(id) {
      if (this.isProcessing) return;
      
      this.isProcessing = true;
      
      try {
        const response = await fetch(`/api/notifications/${id}/read`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          // 로컬 상태 업데이트
          const notification = this.notifications.find(n => n.id === id);
          if (notification) {
            notification.is_read = true;
          }
          
          // 이벤트 디스패치
          this.$dispatch('notification:read', { id });
        } else {
          alert('읽음 처리에 실패했습니다.');
        }
      } catch (error) {
        console.error('읽음 처리 오류:', error);
        alert('예상치 못한 오류가 발생했습니다.');
      } finally {
        this.isProcessing = false;
      }
    },
    
    // 전체 읽음 처리
    async markAllAsRead() {
      if (this.isProcessing || this.unreadCount === 0) return;
      
      this.isProcessing = true;
      
      try {
        const response = await fetch('/api/notifications/read-all', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          // 모든 알림을 읽음으로 표시
          this.notifications.forEach(notification => {
            notification.is_read = true;
          });
          
          // 이벤트 디스패치
          this.$dispatch('notification:read-all');
        } else {
          alert('전체 읽음 처리에 실패했습니다.');
        }
      } catch (error) {
        console.error('전체 읽음 처리 오류:', error);
        alert('예상치 못한 오류가 발생했습니다.');
      } finally {
        this.isProcessing = false;
      }
    },
    
    // 알림 삭제
    async deleteNotification(id) {
      if (this.isProcessing) return;
      
      if (!confirm('이 알림을 삭제하시겠습니까?')) return;
      
      this.isProcessing = true;
      
      try {
        const response = await fetch(`/api/notifications/${id}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          // 로컬에서 제거
          this.notifications = this.notifications.filter(n => n.id !== id);
          
          // 이벤트 디스패치
          this.$dispatch('notification:deleted', { id });
        } else {
          alert('알림 삭제에 실패했습니다.');
        }
      } catch (error) {
        console.error('알림 삭제 오류:', error);
        alert('예상치 못한 오류가 발생했습니다.');
      } finally {
        this.isProcessing = false;
      }
    },
    
    // 상대 시간 포맷
    formatRelativeTime(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffInSeconds = Math.floor((now - date) / 1000);
      
      if (diffInSeconds < 60) {
        return '방금 전';
      } else if (diffInSeconds < 3600) {
        const minutes = Math.floor(diffInSeconds / 60);
        return `${minutes}분 전`;
      } else if (diffInSeconds < 86400) {
        const hours = Math.floor(diffInSeconds / 3600);
        return `${hours}시간 전`;
      } else {
        const days = Math.floor(diffInSeconds / 86400);
        return `${days}일 전`;
      }
    }
  };
}
</script>
```

---

## 🔗 **관련 문서**

- **[03_UI_UX_설계.md](./03_UI_UX_설계.md)**: 디자인 시스템 및 스타일 가이드
- **[06_상태_관리.md](./06_상태_관리.md)**: Alpine.js 상태 관리 설계
- **[12_개발_가이드.md](./12_개발_가이드.md)**: 컴포넌트 개발 가이드라인
