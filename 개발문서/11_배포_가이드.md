# 🚀 IEPON 배포 가이드

> **연결 문서**: [01_시스템_아키텍처.md](./01_시스템_아키텍처.md) | [08_환경_설정.md](./08_환경_설정.md) | [12_개발_가이드.md](./12_개발_가이드.md)
> **환경 변수 공통 테이블**: 배포 파이프라인에서 사용되는 모든 환경 변수는 [08_환경_설정.md](./08_환경_설정.md)의 표를 단일 소스(True North)로 참조합니다. Netlify > Site Settings > Environment 탭에 동일 키를 입력하여 프론트엔드/백엔드가 일관된 값을 사용하도록 합니다.

> **🔄 HTML + Alpine.js + HTMX + Supabase 스택 기반 배포**: 이 가이드는 비전공자도 쉽게 배포할 수 있도록 단순화된 HTML 기반 정적 사이트 배포 방식을 제공합니다. 복잡한 빌드 과정 없이 HTML 파일을 직접 배포하는 방식으로 구성되어 있습니다.

---

## 11.1 배포 아키텍처 (HTML + Alpine.js + HTMX)

### 11.1.1 새로운 배포 환경 구성
- **프론트엔드**: Netlify (HTML5 정적 사이트 + Alpine.js + HTMX)
- **백엔드**: Supabase (PostgreSQL + Auth + Storage + Edge Functions)
- **도메인**: iepon.site (공식 도메인)
- **CDN**: Netlify Edge Network
- **모니터링**: Supabase 내장 모니터링 + 브라우저 개발자 도구
- **실시간 통신**: HTMX + Supabase Realtime

### 11.1.2 단순화된 배포 플로우
```
개발 → GitHub → Netlify → 프로덕션
  ↓        ↓        ↓         ↓
로컬HTML → 코드푸시 → 정적배포 → 즉시서비스

✅ 빌드 과정 없음 (HTML 직접 배포)
✅ 의존성 최소화 (CDN 라이브러리 사용)
✅ 배포 시간 단축 (정적 파일만 업로드)
✅ 디버깅 용이 (브라우저에서 직접 확인)
```

### 11.1.3 기술 스택별 배포 특징

#### HTML5 + CSS3
- **배포 방식**: 정적 파일 직접 업로드
- **캐싱**: 브라우저 캐시 + CDN 캐시
- **최적화**: 이미지 압축, CSS/JS 최소화

#### Alpine.js (CDN 방식)
```html
<!-- Alpine.js CDN 로드 -->
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
```

#### HTMX (CDN 방식)
```html
<!-- HTMX CDN 로드 -->
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
```

#### Supabase 클라이언트
```html
<!-- Supabase 클라이언트 CDN 로드 -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
```

---

## 11.2 Netlify 정적 사이트 배포 설정

### 11.2.1 netlify.toml (HTML + Alpine.js + HTMX)
```toml
# 🌟 단순화된 HTML 정적 사이트 배포 설정
# Next.js 빌드 과정 없이 HTML 파일 직접 배포

[build]
  # 빌드 명령어 없음 (HTML 파일 직접 사용)
  publish = "public"
  # 또는 루트 디렉토리 사용: publish = "."

# Next.js 플러그인 제거 (더 이상 필요 없음)
# [[plugins]]
#   package = "@netlify/plugin-nextjs"

[build.environment]
  # Node.js 버전 (최소한의 환경 설정)
  NODE_VERSION = "18"
  # UTF-8 인코딩 지원
  LANG = "ko_KR.UTF-8"
  LC_ALL = "ko_KR.UTF-8"

# 🔒 보안 헤더 설정 (Alpine.js + HTMX 호환)
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Strict-Transport-Security = "max-age=31536000; includeSubDomains"
    # Alpine.js와 HTMX를 위한 CSP 설정
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; img-src 'self' data: https:; font-src 'self' data: https://cdn.jsdelivr.net; connect-src 'self' https://*.supabase.co wss://*.supabase.co;"

# 🌐 도메인 리디렉션
[[redirects]]
  from = "https://www.iepon.site/*"
  to = "https://iepon.site/:splat"
  status = 301
  force = true

# 🔄 SPA 라우팅 (HTML 페이지 기반)
[[redirects]]
  from = "/dashboard/*"
  to = "/dashboard/index.html"
  status = 200

[[redirects]]
  from = "/students/*"
  to = "/students/index.html"
  status = 200

[[redirects]]
  from = "/curriculum/*"
  to = "/curriculum/index.html"
  status = 200

[[redirects]]
  from = "/reports/*"
  to = "/reports/index.html"
  status = 200

# 기본 페이지 리디렉션
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# 🎯 프로덕션 환경 설정
[context.production]
  # 빌드 명령어 없음 (정적 파일 직접 배포)
  
[context.production.environment]
  ENVIRONMENT = "production"
  SITE_DOMAIN = "iepon.site"
  SITE_URL = "https://iepon.site"
  # Supabase 환경 변수는 Netlify UI에서 설정

# 🧪 미리보기 환경 설정
[context.deploy-preview]
  
[context.deploy-preview.environment]
  ENVIRONMENT = "preview"
  SITE_DOMAIN = "deploy-preview--iepon.netlify.app"

# 📁 정적 파일 캐싱 설정
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=86400"

[[headers]]
  for = "/js/*"
  [headers.values]
    Cache-Control = "public, max-age=86400"

[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=604800"
```

### 11.2.2 프로젝트 디렉토리 구조
```
iepon-project/
├── public/                    # 배포될 정적 파일들
│   ├── index.html            # 메인 페이지
│   ├── dashboard/
│   │   └── index.html        # 대시보드 페이지
│   ├── students/
│   │   └── index.html        # 학생 관리 페이지
│   ├── curriculum/
│   │   └── index.html        # 교육과정 페이지
│   ├── reports/
│   │   └── index.html        # 보고서 페이지
│   ├── css/
│   │   ├── main.css          # 메인 스타일시트
│   │   └── components.css    # 컴포넌트 스타일
│   ├── js/
│   │   ├── app.js           # 메인 애플리케이션 로직
│   │   ├── supabase.js      # Supabase 클라이언트 설정
│   │   └── components/      # Alpine.js 컴포넌트들
│   ├── images/              # 이미지 파일들
│   └── assets/              # 기타 정적 자원들
├── netlify.toml             # Netlify 배포 설정
└── README.md                # 프로젝트 문서
```

### 11.2.3 단순화된 배포 스크립트
```bash
#!/bin/bash
# deploy.sh - IEPON HTML 정적 사이트 배포 스크립트
# 🌟 비전공자도 쉽게 사용할 수 있는 단순화된 배포 프로세스
# Next.js 빌드 과정 없이 HTML 파일 직접 배포

set -e  # 에러 발생 시 즉시 중단

echo "🚀 IEPON HTML 정적 사이트 배포 시작..."
echo "📋 HTML + Alpine.js + HTMX + Supabase 스택 배포"

# UTF-8 인코딩 환경 설정 (한글 지원)
export LANG=ko_KR.UTF-8
export LC_ALL=ko_KR.UTF-8

# 🔍 환경 변수 확인
if [ -z "$NETLIFY_AUTH_TOKEN" ]; then
  echo "❌ 오류: NETLIFY_AUTH_TOKEN 환경 변수가 설정되지 않았습니다."
  echo "💡 해결 방법: Netlify 대시보드에서 Personal Access Token을 생성하여 설정해주세요."
  echo "🔗 참조: https://app.netlify.com/user/applications#personal-access-tokens"
  exit 1
fi

if [ -z "$NETLIFY_SITE_ID" ]; then
  echo "❌ 오류: NETLIFY_SITE_ID 환경 변수가 설정되지 않았습니다."
  echo "💡 해결 방법: Netlify 사이트 설정에서 Site ID를 확인하여 설정해주세요."
  echo "🔗 참조: Site Settings > General > Site details > Site ID"
  exit 1
fi

# 📁 HTML 파일 검증 (빌드 과정 없음)
echo "📄 HTML 파일 구조 검증 중..."
if [ ! -f "public/index.html" ]; then
  echo "❌ 오류: public/index.html 파일이 존재하지 않습니다."
  echo "💡 해결 방법: 메인 HTML 파일을 public/index.html에 생성해주세요."
  exit 1
fi

# 필수 HTML 페이지 검증
echo "🔍 필수 페이지 검증 중..."
required_pages=("dashboard/index.html" "students/index.html" "curriculum/index.html" "reports/index.html")
for page in "${required_pages[@]}"; do
  if [ ! -f "public/$page" ]; then
    echo "⚠️ 경고: public/$page 파일이 존재하지 않습니다."
    echo "💡 권장사항: 해당 페이지를 생성하거나 netlify.toml에서 리디렉션을 제거해주세요."
  fi
done

# CSS/JS 파일 검증
echo "🎨 스타일시트 및 스크립트 검증 중..."
if [ ! -f "public/css/main.css" ]; then
  echo "⚠️ 경고: public/css/main.css 파일이 존재하지 않습니다."
  echo "💡 권장사항: 메인 스타일시트를 생성해주세요."
fi

if [ ! -f "public/js/app.js" ]; then
  echo "⚠️ 경고: public/js/app.js 파일이 존재하지 않습니다."
  echo "💡 권장사항: 메인 JavaScript 파일을 생성해주세요."
fi

# HTML 문법 검증 (간단한 체크)
echo "✅ HTML 문법 기본 검증 중..."
for html_file in $(find public -name "*.html"); do
  if ! grep -q "<!DOCTYPE html>" "$html_file"; then
    echo "⚠️ 경고: $html_file에 DOCTYPE 선언이 없습니다."
  fi
  if ! grep -q "<html" "$html_file"; then
    echo "❌ 오류: $html_file에 html 태그가 없습니다."
    exit 1
  fi
done

# UTF-8 인코딩 검증
echo "🌏 UTF-8 인코딩 검증 중..."
for html_file in $(find public -name "*.html"); do
  if ! grep -q 'charset="utf-8"\|charset=utf-8' "$html_file"; then
    echo "⚠️ 경고: $html_file에 UTF-8 charset 선언이 없습니다."
    echo "💡 권장사항: <meta charset=\"utf-8\"> 태그를 추가해주세요."
  fi
done

# Alpine.js 및 HTMX CDN 링크 검증
echo "🔗 CDN 라이브러리 링크 검증 중..."
for html_file in $(find public -name "*.html"); do
  if grep -q "x-data\|x-show\|x-if" "$html_file" && ! grep -q "alpinejs" "$html_file"; then
    echo "⚠️ 경고: $html_file에서 Alpine.js를 사용하지만 CDN 링크가 없습니다."
    echo "💡 권장사항: Alpine.js CDN 스크립트를 추가해주세요."
  fi
  
  if grep -q "hx-get\|hx-post\|hx-" "$html_file" && ! grep -q "htmx" "$html_file"; then
    echo "⚠️ 경고: $html_file에서 HTMX를 사용하지만 CDN 링크가 없습니다."
    echo "💡 권장사항: HTMX CDN 스크립트를 추가해주세요."
  fi
done

# 접근성 기본 검증 (특수교육 접근성 고려)
echo "♿ 접근성 기본 검증 중..."
for html_file in $(find public -name "*.html"); do
  if ! grep -q "lang=" "$html_file"; then
    echo "⚠️ 경고: $html_file에 언어 속성(lang)이 없습니다."
    echo "💡 권장사항: <html lang=\"ko\"> 속성을 추가해주세요."
  fi
done

# 🚀 Netlify 배포 실행 (HTML 파일 직접 배포)
echo "🌐 Netlify에 HTML 파일 직접 배포 중..."
if ! netlify deploy --prod --dir=public; then
  echo "❌ 오류: 배포 실행에 실패했습니다."
  echo "💡 해결 방법: Netlify 설정을 확인하고 다시 시도해주세요."
  exit 1
fi

echo "✅ HTML 정적 사이트 배포 완료!"
echo "🌐 사이트 URL: https://iepon.site"
echo "📊 배포 상태 확인: https://app.netlify.com/sites/iepon/deploys"
echo "🔔 배포 완료 알림: IEPON HTML 정적 사이트가 성공적으로 배포되었습니다!"
echo "🚀 빠른 배포: 빌드 시간 없이 HTML 파일 직접 배포 완료"
echo "🔧 디버깅: 브라우저 개발자 도구로 즉시 확인 가능"
```

---

## 11.3 Supabase 백엔드 설정

### 11.3.1 프로덕션 데이터베이스 설정 (HTML + Alpine.js + HTMX 호환)
```sql
-- 🗄️ 프로덕션 환경 초기 설정 (HTML + Alpine.js + HTMX + Supabase)
-- 1. 관리자 계정 생성
INSERT INTO auth.users (
  id,
  email,
  encrypted_password,
  email_confirmed_at,
  raw_user_meta_data,
  created_at,
  updated_at
) VALUES (
  gen_random_uuid(),
  'ieponsystem@gmail.com',
  crypt('your-secure-password', gen_salt('bf')),
  NOW(),
  '{"role": "super_admin", "name": "IEPON 시스템 관리자", "ui_mode": "html_alpine"}',
  NOW(),
  NOW()
);

-- 2. RLS 정책 활성화 (모든 테이블)
ALTER TABLE students ENABLE ROW LEVEL SECURITY;
ALTER TABLE current_levels ENABLE ROW LEVEL SECURITY;
ALTER TABLE monthly_plans ENABLE ROW LEVEL SECURITY;
ALTER TABLE monthly_evaluations ENABLE ROW LEVEL SECURITY;
ALTER TABLE payments ENABLE ROW LEVEL SECURITY;
ALTER TABLE licenses ENABLE ROW LEVEL SECURITY;
ALTER TABLE system_settings ENABLE ROW LEVEL SECURITY;
ALTER TABLE notifications ENABLE ROW LEVEL SECURITY;

-- 3. 스토리지 버킷 생성 (파일 업로드용)
INSERT INTO storage.buckets (id, name, public) VALUES ('files', 'files', false);
INSERT INTO storage.buckets (id, name, public) VALUES ('avatars', 'avatars', true);
INSERT INTO storage.buckets (id, name, public) VALUES ('reports', 'reports', false);

-- 4. 스토리지 정책 설정 (사용자별 파일 접근)
CREATE POLICY "Users can upload files" ON storage.objects
FOR INSERT WITH CHECK (auth.uid()::text = (storage.foldername(name))[1]);

CREATE POLICY "Users can view own files" ON storage.objects
FOR SELECT USING (auth.uid()::text = (storage.foldername(name))[1]);

CREATE POLICY "Users can delete own files" ON storage.objects
FOR DELETE USING (auth.uid()::text = (storage.foldername(name))[1]);

-- 5. HTMX 실시간 업데이트를 위한 함수 생성
CREATE OR REPLACE FUNCTION notify_htmx_update()
RETURNS trigger AS $$
BEGIN
  PERFORM pg_notify('htmx_update', json_build_object(
    'table', TG_TABLE_NAME,
    'action', TG_OP,
    'data', row_to_json(NEW)
  )::text);
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- 6. 주요 테이블에 HTMX 업데이트 트리거 추가
CREATE TRIGGER students_htmx_notify
  AFTER INSERT OR UPDATE OR DELETE ON students
  FOR EACH ROW EXECUTE FUNCTION notify_htmx_update();

CREATE TRIGGER monthly_plans_htmx_notify
  AFTER INSERT OR UPDATE OR DELETE ON monthly_plans
  FOR EACH ROW EXECUTE FUNCTION notify_htmx_update();
```

### 11.3.2 HTML + Alpine.js 환경 설정
```javascript
// public/js/supabase.js - HTML에서 직접 사용하는 Supabase 클라이언트
// 🌟 CDN 방식으로 로드된 Supabase 클라이언트 설정

// 환경 변수 (HTML에서 직접 설정)
const SUPABASE_CONFIG = {
  url: 'https://your-project.supabase.co', // 실제 Supabase URL로 변경
  anonKey: 'your-anon-key', // 실제 anon key로 변경
  serviceRoleKey: 'your-service-role-key' // Edge Functions용 (보안 주의)
};

// Supabase 클라이언트 초기화 (전역 변수)
window.supabaseClient = supabase.createClient(
  SUPABASE_CONFIG.url,
  SUPABASE_CONFIG.anonKey,
  {
    auth: {
      persistSession: true,
      autoRefreshToken: true,
      detectSessionInUrl: true,
      // HTML 페이지 기반 리디렉션
      redirectTo: window.location.origin + '/dashboard/'
    },
    db: {
      schema: 'public'
    },
    global: {
      headers: {
        'X-Client-Info': 'iepon-html-alpine@1.0.0',
        'X-UI-Framework': 'alpine-js-htmx'
      }
    }
  }
);

// 🔄 Alpine.js와 HTMX를 위한 인증 상태 관리
window.authManager = {
  // 현재 사용자 정보
  currentUser: null,
  isAuthenticated: false,
  
  // 인증 상태 변경 리스너
  init() {
    window.supabaseClient.auth.onAuthStateChange((event, session) => {
      this.currentUser = session?.user || null;
      this.isAuthenticated = !!session;
      
      // Alpine.js 컴포넌트에 상태 변경 알림
      window.dispatchEvent(new CustomEvent('auth-changed', {
        detail: { user: this.currentUser, authenticated: this.isAuthenticated }
      }));
      
      // HTMX 헤더 업데이트
      if (this.isAuthenticated) {
        document.body.setAttribute('hx-headers', JSON.stringify({
          'Authorization': `Bearer ${session.access_token}`,
          'X-User-ID': this.currentUser.id
        }));
      } else {
        document.body.removeAttribute('hx-headers');
      }
      
      console.log('인증 상태 변경:', event, this.isAuthenticated);
    });
  },
  
  // 로그인 함수
  async signIn(email, password) {
    try {
      const { data, error } = await window.supabaseClient.auth.signInWithPassword({
        email,
        password
      });
      
      if (error) throw error;
      return { success: true, data };
    } catch (error) {
      console.error('로그인 오류:', error);
      return { success: false, error: error.message };
    }
  },
  
  // 로그아웃 함수
  async signOut() {
    try {
      const { error } = await window.supabaseClient.auth.signOut();
      if (error) throw error;
      
      // 메인 페이지로 리디렉션
      window.location.href = '/';
      return { success: true };
    } catch (error) {
      console.error('로그아웃 오류:', error);
      return { success: false, error: error.message };
    }
  }
};

// 🚀 HTMX 실시간 업데이트를 위한 Supabase Realtime 설정
window.realtimeManager = {
  subscriptions: new Map(),
  
  // 테이블 변경 사항 구독
  subscribe(tableName, callback) {
    const subscription = window.supabaseClient
      .channel(`public:${tableName}`)
      .on('postgres_changes', 
        { event: '*', schema: 'public', table: tableName },
        (payload) => {
          console.log(`${tableName} 테이블 변경:`, payload);
          
          // HTMX 요소 자동 새로고침
          const htmxElements = document.querySelectorAll(`[hx-get*="${tableName}"]`);
          htmxElements.forEach(element => {
            if (window.htmx) {
              window.htmx.trigger(element, 'refresh');
            }
          });
          
          // 콜백 함수 실행
          if (callback) callback(payload);
        }
      )
      .subscribe();
    
    this.subscriptions.set(tableName, subscription);
    return subscription;
  },
  
  // 구독 해제
  unsubscribe(tableName) {
    const subscription = this.subscriptions.get(tableName);
    if (subscription) {
      window.supabaseClient.removeChannel(subscription);
      this.subscriptions.delete(tableName);
    }
  }
};

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', () => {
  window.authManager.init();
  console.log('🚀 IEPON Supabase 클라이언트 초기화 완료');
});
```

---

## 11.4 도메인 및 SSL 설정 (HTML 정적 사이트)

### 11.4.1 도메인 설정 (iepon.site)
```bash
# 🌐 DNS 설정 (Cloudflare 또는 도메인 제공업체)
# A 레코드: @ → Netlify Load Balancer IP
# CNAME 레코드: www → iepon.site
# CNAME 레코드: api → your-supabase-project.supabase.co (Supabase API 연결)

# Netlify CLI를 통한 도메인 설정
netlify sites:update --name iepon-html-site --custom-domain iepon.site

# 또는 Netlify 대시보드에서 직접 설정
# Site Settings > Domain management > Add custom domain
```

### 11.4.2 SSL 인증서 자동 설정 (Netlify)
```bash
# 🔒 Netlify에서 자동 SSL 인증서 발급 (Let's Encrypt)
# netlify.toml에서 이미 설정된 보안 헤더가 적용됨

# SSL 강제 리디렉션 확인
netlify sites:show --json | grep -i ssl

# 도메인 검증 상태 확인
netlify sites:show --json | grep -i domain
```

---

## 11.5 GitHub Actions CI/CD (단순화)

### 11.5.1 HTML 정적 사이트용 워크플로우
```yaml
# .github/workflows/deploy.yml
name: Deploy HTML Site to Netlify

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 코드
        uses: actions/checkout@v4
      
      - name: HTML 파일 검증
        run: |
          echo "🔍 HTML 파일 구조 검증 중..."
          if [ ! -f "public/index.html" ]; then
            echo "❌ public/index.html이 없습니다."
            exit 1
          fi
          echo "✅ HTML 파일 검증 완료"
      
      - name: UTF-8 인코딩 검증
        run: |
          echo "🌏 UTF-8 인코딩 검증 중..."
          find public -name "*.html" -exec grep -l "charset=utf-8\|charset=\"utf-8\"" {} \; || echo "⚠️ 일부 파일에 UTF-8 선언이 없습니다."
      
      - name: Netlify에 배포
        uses: nwtgck/actions-netlify@v2.0
        with:
          publish-dir: './public'
          production-branch: main
          github-token: ${{ secrets.GITHUB_TOKEN }}
          deploy-message: "🚀 HTML 정적 사이트 자동 배포"
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
```

---

## 11.6 모니터링 및 성능 최적화

### 11.6.1 브라우저 개발자 도구 활용
```javascript
// public/js/monitoring.js - 간단한 성능 모니터링
window.performanceMonitor = {
  // 페이지 로드 시간 측정
  measurePageLoad() {
    window.addEventListener('load', () => {
      const loadTime = performance.now();
      console.log(`📊 페이지 로드 시간: ${loadTime.toFixed(2)}ms`);
      
      // 로컬 스토리지에 성능 데이터 저장
      const perfData = {
        loadTime,
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent
      };
      
      localStorage.setItem('iepon_perf_' + Date.now(), JSON.stringify(perfData));
    });
  },
  
  // HTMX 요청 성능 모니터링
  monitorHTMX() {
    document.body.addEventListener('htmx:beforeRequest', (e) => {
      e.detail.requestConfig.startTime = performance.now();
    });
    
    document.body.addEventListener('htmx:afterRequest', (e) => {
      const duration = performance.now() - e.detail.requestConfig.startTime;
      console.log(`🔄 HTMX 요청 시간: ${duration.toFixed(2)}ms`);
    });
  }
};

// 자동 초기화
document.addEventListener('DOMContentLoaded', () => {
  window.performanceMonitor.measurePageLoad();
  window.performanceMonitor.monitorHTMX();
});
```

### 11.6.2 Supabase 내장 모니터링
```javascript
// Supabase 대시보드에서 확인 가능한 지표들:
// - API 요청 수 및 응답 시간
// - 데이터베이스 쿼리 성능
// - 실시간 연결 상태
// - 스토리지 사용량
// - 인증 이벤트 로그

// 추가 로깅이 필요한 경우
window.supabaseLogger = {
  logQuery(tableName, operation, duration) {
    console.log(`📊 DB 쿼리: ${tableName}.${operation} (${duration}ms)`);
  },
  
  logAuth(event, userEmail) {
    console.log(`🔐 인증 이벤트: ${event} - ${userEmail}`);
  }
};
```

---

## 📋 **배포 체크리스트 (HTML + Alpine.js + HTMX)**

### 배포 전 준비
- [ ] `public/index.html` 파일 존재 확인
- [ ] 필수 페이지들 (`dashboard/`, `students/`, `curriculum/`, `reports/`) 생성
- [ ] UTF-8 charset 선언 확인 (`<meta charset="utf-8">`)
- [ ] Alpine.js CDN 링크 확인
- [ ] HTMX CDN 링크 확인
- [ ] Supabase 클라이언트 설정 확인
- [ ] `netlify.toml` 설정 파일 확인

### 배포 실행
- [ ] GitHub에 코드 푸시
- [ ] Netlify 자동 배포 확인
- [ ] 빌드 로그 확인 (에러 없음)
- [ ] 배포 완료 확인

### 배포 후 검증
- [ ] 사이트 접속 확인 (https://iepon.site)
- [ ] 모든 페이지 라우팅 동작 확인
- [ ] Alpine.js 컴포넌트 동작 확인
- [ ] HTMX 요청/응답 확인
- [ ] Supabase 연결 확인
- [ ] 모바일 반응형 확인
- [ ] 접근성 기본 확인

### 성능 및 보안 확인
- [ ] 페이지 로드 속도 확인 (3초 이내)
- [ ] CDN 캐싱 동작 확인
- [ ] SSL 인증서 확인
- [ ] 보안 헤더 확인
- [ ] CORS 설정 확인

---

## 🔗 **관련 문서**

- **[01_시스템_아키텍처.md](./01_시스템_아키텍처.md)**: HTML + Alpine.js + HTMX 시스템 구조
- **[08_환경_설정.md](./08_환경_설정.md)**: 환경별 설정 가이드
- **[12_개발_가이드.md](./12_개발_가이드.md)**: HTML 기반 개발 가이드라인
- **[10_보안_권한.md](./10_보안_권한.md)**: Alpine.js 보안 정책 및 권한 관리

---

## 🎯 **HTML + Alpine.js + HTMX 배포의 장점**

### ✅ **비전공자 친화적**
- 복잡한 빌드 과정 없음
- 브라우저에서 직접 디버깅 가능
- HTML 파일 직접 수정으로 즉시 반영

### ✅ **빠른 배포**
- 빌드 시간 0초 (정적 파일 직접 업로드)
- CDN을 통한 전 세계 빠른 서비스
- 캐싱 최적화로 재방문 속도 향상

### ✅ **안정성**
- 서버 다운타임 없음 (정적 호스팅)
- Supabase 백엔드 안정성
- 단순한 구조로 오류 가능성 최소화

### ✅ **비용 효율성**
- Netlify 무료 플랜으로도 충분
- Supabase 무료 티어 활용
- 별도 서버 관리 비용 없음
    ];
  },
};
```

---

## 10.5 CI/CD 파이프라인

### 10.5.1 GitHub Actions 워크플로우
```yaml
# .github/workflows/deploy.yml
name: Deploy to Netlify

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      # HTML 정적 사이트 검증 도구 설치 (선택사항)
      - name: Install HTML validation tools (optional)
        run: |
          npm install -g html-validate
          npm install -g stylelint
      
      - name: Validate HTML files
        run: |
          # HTML 파일 구조 검증
          find public -name "*.html" -exec html-validate {} \;
          echo "✅ HTML 파일 검증 완료"
      
      - name: Check CSS syntax
        run: |
          # CSS 구문 검사
          find public -name "*.css" -exec stylelint {} \;
          echo "✅ CSS 구문 검사 완료"
      
      - name: UTF-8 encoding check
        run: |
          # UTF-8 인코딩 검증
          find public -name "*.html" -exec file {} \; | grep -v "UTF-8" && exit 1 || echo "✅ UTF-8 인코딩 검증 완료"

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v3
      
      # Node.js 설정 (HTML 검증 도구용)
      - name: Setup Node.js (for validation tools)
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      # 빌드 과정 없음 - HTML 파일 직접 배포
      - name: Prepare static files
        run: |
          echo "🚀 HTML 정적 파일 배포 준비 중..."
          ls -la public/
        env:
          SITE_DOMAIN: iepon.site
          SITE_URL: https://iepon.site
      
      - name: Deploy to Netlify
        uses: netlify/actions/cli@master
        with:
          args: deploy --prod --dir=.next
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
```

---

## 10.6 모니터링 및 로깅

### 10.6.1 Sentry 설정
```javascript
// sentry.client.config.js
import * as Sentry from '@sentry/nextjs';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 1.0,
  debug: false,
  integrations: [
    new Sentry.BrowserTracing({
      tracingOrigins: ['localhost', 'iepon.site', /^\//],
  
  // 로그 레벨 우선순위
  levels: {
    error: 0,
    warn: 1,
    info: 2,
    debug: 3
  },
  
  // 로그 출력 함수
  log(level, message, data = null) {
    const timestamp = new Date().toISOString();
    const logData = {
      timestamp,
      level,
      message,
      data,
      userAgent: navigator.userAgent,
      url: window.location.href
    };
    
    // 콘솔 출력
    if (this.levels[level] <= this.levels[this.level]) {
      console[level](`[${timestamp}] ${level.toUpperCase()}: ${message}`, data);
    }
    
    // 에러는 Supabase에 저장 (선택사항)
    if (level === 'error' && window.supabaseClient) {
      this.saveToSupabase(logData);
    }
  },
  
  // Supabase에 에러 로그 저장
  async saveToSupabase(logData) {
    try {
      await window.supabaseClient
        .from('error_logs')
        .insert([logData]);
    } catch (error) {
      console.error('로그 저장 실패:', error);
    }
  },
  
  error: (message, data) => window.Logger.log('error', message, data),
  warn: (message, data) => window.Logger.log('warn', message, data),
  info: (message, data) => window.Logger.log('info', message, data),
  debug: (message, data) => window.Logger.log('debug', message, data)
};
```

---

## 10.7 성능 최적화 (HTML + Alpine.js + HTMX)

### 10.7.1 정적 파일 최적화 (빌드 과정 없음)
```html
<!-- 성능 최적화된 HTML 구조 -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- 중요한 CSS 우선 로드 -->
  <link rel="preload" href="/css/main.css" as="style">
  <link rel="stylesheet" href="/css/main.css">
  
  <!-- CDN 라이브러리 최적화 로드 -->
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="//unpkg.com">
  
  <!-- Alpine.js 지연 로드 -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  
  <!-- Supabase 클라이언트 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <!-- 메인 콘텐츠 -->
  <div x-data="appData()">
    <!-- 성능 최적화된 컴포넌트 -->
  </div>
  
  <!-- 중요하지 않은 스크립트는 하단에 -->
  <script src="/js/app.js"></script>
</body>
</html>
```

### 10.7.2 캐싱 전략
```javascript
// lib/cache.ts
import { unstable_cache } from 'next/cache';

export const getCachedStudents = unstable_cache(
  async (userId: string) => {
    // 학생 데이터 조회 로직
  },
  ['students'],
  {
    revalidate: 300, // 5분 캐시
    tags: ['students'],
  }
);

export const getCachedEducationPlans = unstable_cache(
  async (studentId: string, semester: string) => {
    // 교육계획 데이터 조회 로직
  },
  ['education-plans'],
  {
    revalidate: 600, // 10분 캐시
    tags: ['education-plans'],
  }
);
```

---

## 10.8 백업 및 복구

### 10.8.1 데이터베이스 백업
```bash
#!/bin/bash
# backup.sh

# Supabase 데이터베이스 백업
supabase db dump --project-id your-project-id > backup_$(date +%Y%m%d_%H%M%S).sql

# 백업 파일을 클라우드 스토리지에 업로드
aws s3 cp backup_*.sql s3://iepon-backups/database/

# 7일 이상 된 백업 파일 삭제
find . -name "backup_*.sql" -mtime +7 -delete
```

### 10.8.2 복구 절차
```bash
#!/bin/bash
# restore.sh

# 백업 파일에서 데이터베이스 복구
supabase db reset --project-id your-project-id
psql -h your-db-host -U postgres -d postgres < backup_file.sql

# 마이그레이션 실행
supabase db push --project-id your-project-id
```

---

## 📋 **배포 체크리스트**

### 배포 전 준비
- [ ] 환경 변수 설정 확인
- [ ] 데이터베이스 마이그레이션 완료
- [ ] 테스트 통과 확인
- [ ] 보안 설정 검토

### 배포 실행
- [ ] GitHub에 코드 푸시
- [ ] CI/CD 파이프라인 실행
- [ ] 빌드 성공 확인
- [ ] 배포 완료 확인

### 배포 후 검증
- [ ] 사이트 접속 확인 (https://iepon.site)
- [ ] 주요 기능 동작 확인
- [ ] 성능 모니터링 확인
- [ ] 에러 로그 확인

### 모니터링 설정
- [ ] Sentry 에러 모니터링
- [ ] 성능 지표 추적
- [ ] 백업 스케줄 설정
- [ ] 알림 설정 구성

---

## 🔗 **관련 문서**

- **[01_시스템_아키텍처.md](./01_시스템_아키텍처.md)**: 전체 시스템 구조
- **[08_환경_설정.md](./08_환경_설정.md)**: 환경별 설정 가이드
- **[12_개발_가이드.md](./12_개발_가이드.md)**: 개발 및 배포 가이드라인
- **[10_보안_권한.md](./10_보안_권한.md)**: 보안 정책 및 권한 관리
