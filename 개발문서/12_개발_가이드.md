# ğŸ› ï¸ IEPON ê°œë°œ ê°€ì´ë“œ

> **ì—°ê²° ë¬¸ì„œ**: [08_í™˜ê²½_ì„¤ì •.md](./08_í™˜ê²½_ì„¤ì •.md) | [11_ë°°í¬_ê°€ì´ë“œ.md](./11_ë°°í¬_ê°€ì´ë“œ.md) | [README.md](./README.md)

> **ğŸŒŸ HTML + Alpine.js + HTMX + Supabase ê°œë°œ ê°€ì´ë“œ**: ì´ ë¬¸ì„œëŠ” ë¹„ì „ê³µìë„ ì‰½ê²Œ ë”°ë¼í•  ìˆ˜ ìˆëŠ” ë‹¨ìˆœí™”ëœ HTML ê¸°ë°˜ ê°œë°œ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤. ë³µì¡í•œ ë¹Œë“œ ë„êµ¬ë‚˜ í”„ë ˆì„ì›Œí¬ ì—†ì´ ì§ê´€ì ì¸ ê°œë°œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## 12.1 ë‹¨ìˆœí™”ëœ ê°œë°œ í™˜ê²½ ì„¤ì • (HTML + Alpine.js + HTMX)

### 12.1.1 ìµœì†Œí•œì˜ í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜
```bash
# ğŸŒ ë¸Œë¼ìš°ì €ë§Œ ìˆìœ¼ë©´ ê°œë°œ ê°€ëŠ¥! (ì¶”ê°€ ë„êµ¬ëŠ” ì„ íƒì‚¬í•­)

# 1. ê¸°ë³¸ ë„êµ¬ (ì„ íƒì‚¬í•­)
# Git ì„¤ì • (ë²„ì „ ê´€ë¦¬ìš©)
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# 2. ë¡œì»¬ ê°œë°œ ì„œë²„ (ì„ íƒì‚¬í•­)
# Python ê°„ë‹¨ ì„œë²„ (Python 3 ê¸°ë³¸ ì„¤ì¹˜ë˜ì–´ ìˆìŒ)
python3 -m http.server 8000

# ë˜ëŠ” Node.js ì„œë²„ (ì„ íƒì‚¬í•­)
npx http-server -p 8000

# ë˜ëŠ” PHP ì„œë²„ (ì„ íƒì‚¬í•­)
php -S localhost:8000

# 3. Supabase CLI (ë°±ì—”ë“œ ê´€ë¦¬ìš©, ì„ íƒì‚¬í•­)
npm install -g supabase
```

### 12.1.2 í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì • (ë‹¨ìˆœí™”ëœ ë°©ì‹)
```bash
# ğŸ“ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ìƒì„±
mkdir iepon-html-project
cd iepon-html-project

# ê¸°ë³¸ í´ë” êµ¬ì¡° ìƒì„±
mkdir -p public/{css,js,images,dashboard,students,curriculum,reports}

# ê¸°ë³¸ HTML íŒŒì¼ ìƒì„±
touch public/index.html
touch public/dashboard/index.html
touch public/students/index.html
touch public/curriculum/index.html
touch public/reports/index.html

# CSS ë° JS íŒŒì¼ ìƒì„±
touch public/css/main.css
touch public/css/components.css
touch public/js/app.js
touch public/js/supabase.js

# í™˜ê²½ ì„¤ì • íŒŒì¼ (ì„ íƒì‚¬í•­)
touch .env
touch netlify.toml
touch README.md

echo "ğŸ‰ HTML + Alpine.js + HTMX í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì • ì™„ë£Œ!"
echo "ğŸš€ ë¸Œë¼ìš°ì €ì—ì„œ public/index.htmlì„ ì—´ì–´ ê°œë°œì„ ì‹œì‘í•˜ì„¸ìš”."
```

### 12.1.3 ê¸°ë³¸ HTML í…œí”Œë¦¿ ìƒì„±
```html
<!-- public/index.html - ê¸°ë³¸ í…œí”Œë¦¿ -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IEPON - AI ê¸°ë°˜ ë§ì¶¤í˜• êµìœ¡ í”Œë«í¼</title>
  
  <!-- CSS íŒŒì¼ -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/components.css">
  
  <!-- Alpine.js CDN -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- HTMX CDN -->
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  
  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
  <div id="app" x-data="appData()">
    <header class="header">
      <h1>IEPON ì‹œìŠ¤í…œ</h1>
      <nav>
        <a href="/dashboard/">ëŒ€ì‹œë³´ë“œ</a>
        <a href="/students/">í•™ìƒ ê´€ë¦¬</a>
        <a href="/curriculum/">êµìœ¡ê³¼ì •</a>
        <a href="/reports/">ë³´ê³ ì„œ</a>
      </nav>
    </header>
    
    <main class="main-content">
      <h2>í™˜ì˜í•©ë‹ˆë‹¤!</h2>
      <p>HTML + Alpine.js + HTMX + Supabase ê¸°ë°˜ IEPON ì‹œìŠ¤í…œ</p>
      
      <!-- Alpine.js ì»´í¬ë„ŒíŠ¸ ì˜ˆì‹œ -->
      <div x-data="{ message: 'ì•ˆë…•í•˜ì„¸ìš”!' }">
        <p x-text="message"></p>
        <button @click="message = 'ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤!'">Click Me</button>
      </div>
    </main>
  </div>
  
  <!-- JavaScript íŒŒì¼ -->
  <script src="/js/supabase.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
```

---

## 12.2 ë‹¨ìˆœí™”ëœ ì½”ë”© í‘œì¤€ ë° ì»¨ë²¤ì…˜ (HTML + Alpine.js + HTMX)

### 12.2.1 íŒŒì¼ ë° í´ë” êµ¬ì¡° (ì •ì  HTML ê¸°ë°˜)
```
public/                     # ğŸŒ ì›¹ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ (ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì ‘ê·¼)
â”œâ”€â”€ index.html             # ë©”ì¸ ëœë”© í˜ì´ì§€
â”œâ”€â”€ auth/                  # ì¸ì¦ ê´€ë ¨ í˜ì´ì§€
â”‚   â”œâ”€â”€ login.html        # ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â”œâ”€â”€ register.html     # íšŒì›ê°€ì… í˜ì´ì§€
â”‚   â””â”€â”€ forgot-password.html # ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
â”œâ”€â”€ dashboard/             # ëŒ€ì‹œë³´ë“œ í˜ì´ì§€
â”‚   â”œâ”€â”€ index.html        # ë©”ì¸ ëŒ€ì‹œë³´ë“œ
â”‚   â”œâ”€â”€ analytics.html    # ë¶„ì„ í˜ì´ì§€
â”‚   â””â”€â”€ settings.html     # ì„¤ì • í˜ì´ì§€
â”œâ”€â”€ students/              # í•™ìƒ ê´€ë¦¬ í˜ì´ì§€
â”‚   â”œâ”€â”€ index.html        # í•™ìƒ ëª©ë¡
â”‚   â”œâ”€â”€ add.html          # í•™ìƒ ì¶”ê°€
â”‚   â”œâ”€â”€ edit.html         # í•™ìƒ í¸ì§‘
â”‚   â””â”€â”€ profile.html      # í•™ìƒ í”„ë¡œí•„
â”œâ”€â”€ curriculum/            # êµìœ¡ê³¼ì • í˜ì´ì§€
â”‚   â”œâ”€â”€ index.html        # êµìœ¡ê³¼ì • ëª©ë¡
â”‚   â”œâ”€â”€ create.html       # êµìœ¡ê³¼ì • ìƒì„±
â”‚   â””â”€â”€ manage.html       # êµìœ¡ê³¼ì • ê´€ë¦¬
â”œâ”€â”€ reports/               # ë³´ê³ ì„œ í˜ì´ì§€
â”‚   â”œâ”€â”€ index.html        # ë³´ê³ ì„œ ëª©ë¡
â”‚   â”œâ”€â”€ generate.html     # ë³´ê³ ì„œ ìƒì„±
â”‚   â””â”€â”€ view.html         # ë³´ê³ ì„œ ë³´ê¸°
â”œâ”€â”€ admin/                 # ê´€ë¦¬ì í˜ì´ì§€
â”‚   â”œâ”€â”€ index.html        # ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
â”‚   â”œâ”€â”€ users.html        # ì‚¬ìš©ì ê´€ë¦¬
â”‚   â””â”€â”€ system.html       # ì‹œìŠ¤í…œ ì„¤ì •
â”œâ”€â”€ css/                   # ìŠ¤íƒ€ì¼ì‹œíŠ¸ íŒŒì¼
â”‚   â”œâ”€â”€ main.css          # ë©”ì¸ ìŠ¤íƒ€ì¼
â”‚   â”œâ”€â”€ components.css    # ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼
â”‚   â”œâ”€â”€ dashboard.css     # ëŒ€ì‹œë³´ë“œ ì „ìš© ìŠ¤íƒ€ì¼
â”‚   â””â”€â”€ responsive.css    # ë°˜ì‘í˜• ìŠ¤íƒ€ì¼
â”œâ”€â”€ js/                    # JavaScript íŒŒì¼
â”‚   â”œâ”€â”€ app.js            # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§
â”‚   â”œâ”€â”€ supabase.js       # Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
â”‚   â”œâ”€â”€ auth.js           # ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜
â”‚   â”œâ”€â”€ students.js       # í•™ìƒ ê´€ë¦¬ ë¡œì§
â”‚   â”œâ”€â”€ curriculum.js     # êµìœ¡ê³¼ì • ë¡œì§
â”‚   â”œâ”€â”€ reports.js        # ë³´ê³ ì„œ ë¡œì§
â”‚   â”œâ”€â”€ utils.js          # ê³µí†µ ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ validation.js     # ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
â”œâ”€â”€ images/                # ì´ë¯¸ì§€ íŒŒì¼
â”‚   â”œâ”€â”€ logo.png          # ë¡œê³ 
â”‚   â”œâ”€â”€ icons/            # ì•„ì´ì½˜ íŒŒì¼ë“¤
â”‚   â””â”€â”€ avatars/          # ì‚¬ìš©ì ì•„ë°”íƒ€
â”œâ”€â”€ components/            # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ HTML ì»´í¬ë„ŒíŠ¸ (í…œí”Œë¦¿)
â”‚   â”œâ”€â”€ header.html       # ê³µí†µ í—¤ë”
â”‚   â”œâ”€â”€ footer.html       # ê³µí†µ í‘¸í„°
â”‚   â”œâ”€â”€ sidebar.html      # ì‚¬ì´ë“œë°”
â”‚   â””â”€â”€ modals.html       # ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸ë“¤
â””â”€â”€ data/                  # ì •ì  ë°ì´í„° íŒŒì¼ (ì„ íƒì‚¬í•­)
    â”œâ”€â”€ sample-students.json # ìƒ˜í”Œ í•™ìƒ ë°ì´í„°
    â””â”€â”€ config.json       # ì„¤ì • íŒŒì¼
```

### 12.2.2 ëª…ëª… ê·œì¹™ (HTML + Alpine.js + JavaScript)
```javascript
// ğŸ·ï¸ Alpine.js ì»´í¬ë„ŒíŠ¸: camelCase
function studentFormData() { ... }
function dashboardData() { ... }

// ğŸ”§ JavaScript í•¨ìˆ˜: camelCase
const fetchStudentData = async () => { ... };
const validateForm = (formData) => { ... };

// ğŸ“¦ ë³€ìˆ˜: camelCase
const studentList = [];
const currentUser = null;

// ğŸ”’ ìƒìˆ˜: UPPER_SNAKE_CASE
const MAX_FILE_SIZE = 10 * 1024 * 1024;
const API_BASE_URL = 'https://your-project.supabase.co';

// ğŸ¯ Alpine.js ë°ì´í„° ì†ì„±: kebab-case
// x-data="studentForm"
// x-model="student.name"
// @click="handleSubmit"

// ğŸ“„ íŒŒì¼ëª…: kebab-case
// student-form.html
// education-plan.html
// user-profile.js

// ğŸ¨ CSS í´ë˜ìŠ¤: kebab-case
// .student-card
// .form-container
// .btn-primary

// ğŸ†” HTML ID: kebab-case
// id="student-form"
// id="dashboard-container"
```

### 12.2.3 HTML + Alpine.js ì½”ë“œ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
```html
<!-- âœ… ì¢‹ì€ ì˜ˆì‹œ: í•™ìƒ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ -->
<div class="student-card" 
     x-data="{
       student: {},
       isLoading: false,
       isEditing: false
     }"
     x-init="loadStudentData()">
  
  <!-- í•™ìƒ ì •ë³´ í‘œì‹œ -->
  <div class="student-info">
    <h3 class="student-name" x-text="student.name">í•™ìƒ ì´ë¦„</h3>
    <p class="student-school" x-text="student.school_name">í•™êµëª…</p>
    <p class="student-grade" x-text="`${student.grade}í•™ë…„`">í•™ë…„</p>
  </div>
  
  <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
  <div class="student-actions">
    <button class="btn btn-edit" 
            @click="startEdit()" 
            :disabled="isLoading"
            x-show="!isEditing">
      <span x-show="!isLoading">í¸ì§‘</span>
      <span x-show="isLoading">ë¡œë”©ì¤‘...</span>
    </button>
    
    <button class="btn btn-save" 
            @click="saveStudent()" 
            :disabled="isLoading"
            x-show="isEditing">
      ì €ì¥
    </button>
    
    <button class="btn btn-delete" 
            @click="deleteStudent()" 
            :disabled="isLoading"
            x-confirm="ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?">
      ì‚­ì œ
    </button>
  </div>
  
  <!-- í¸ì§‘ í¼ (ì¡°ê±´ë¶€ í‘œì‹œ) -->
  <form class="edit-form" 
        x-show="isEditing" 
        @submit.prevent="saveStudent()">
    <input type="text" 
           x-model="student.name" 
           placeholder="í•™ìƒ ì´ë¦„"
           required>
    <input type="text" 
           x-model="student.school_name" 
           placeholder="í•™êµëª…"
           required>
    <select x-model="student.grade">
      <option value="1">1í•™ë…„</option>
      <option value="2">2í•™ë…„</option>
      <option value="3">3í•™ë…„</option>
    </select>
  </form>
</div>

<script>
// âœ… ì¢‹ì€ ì˜ˆì‹œ: Alpine.js ì»´í¬ë„ŒíŠ¸ í•¨ìˆ˜
function studentCardData() {
  return {
    student: {},
    isLoading: false,
    isEditing: false,
    
    // ğŸ”„ í•™ìƒ ë°ì´í„° ë¡œë“œ
    async loadStudentData() {
      this.isLoading = true;
      try {
        const { data, error } = await supabase
          .from('students')
          .select('*')
          .eq('id', this.studentId)
          .single();
          
        if (error) throw error;
        this.student = data;
      } catch (error) {
        console.error('í•™ìƒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        alert('í•™ìƒ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      } finally {
        this.isLoading = false;
      }
    },
    
    // âœï¸ í¸ì§‘ ëª¨ë“œ ì‹œì‘
    startEdit() {
      this.isEditing = true;
    },
    
    // ğŸ’¾ í•™ìƒ ì •ë³´ ì €ì¥
    async saveStudent() {
      if (!this.validateStudent()) return;
      
      this.isLoading = true;
      try {
        const { error } = await supabase
          .from('students')
          .update(this.student)
          .eq('id', this.student.id);
          
        if (error) throw error;
        
        this.isEditing = false;
        alert('í•™ìƒ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } catch (error) {
        console.error('ì €ì¥ ì‹¤íŒ¨:', error);
        alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      } finally {
        this.isLoading = false;
      }
    },
    
    // ğŸ—‘ï¸ í•™ìƒ ì‚­ì œ
    async deleteStudent() {
      this.isLoading = true;
      try {
        const { error } = await supabase
          .from('students')
          .delete()
          .eq('id', this.student.id);
          
        if (error) throw error;
        
        // HTMXë¡œ UI ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°
        htmx.trigger(document.body, 'student-deleted', { 
          detail: { studentId: this.student.id } 
        });
      } catch (error) {
        console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
        alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      } finally {
        this.isLoading = false;
      }
    },
    
    // âœ… ìœ íš¨ì„± ê²€ì‚¬
    validateStudent() {
      if (!this.student.name?.trim()) {
        alert('í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return false;
      }
      if (!this.student.school_name?.trim()) {
        alert('í•™êµëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return false;
      }
      return true;
    }
  };
}
</script>
```

### 12.2.3 ì½”ë“œ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ (Alpine.js + HTML íŒ¨í„´)
```html
<!-- âœ… ì¢‹ì€ ì˜ˆì‹œ: Alpine.js í•™ìƒ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ -->
<div class="student-card p-4 border rounded-lg" 
     x-data="studentCardData(student)"
     x-init="init()">
  
  <!-- í•™ìƒ ì •ë³´ í‘œì‹œ -->
  <h3 class="text-lg font-semibold" x-text="student.name"></h3>
  <p class="text-gray-600" x-text="student.school_name"></p>
  
  <!-- ë²„íŠ¼ ì˜ì—­ -->
  <div class="mt-4 flex gap-2">
    <button class="btn btn-primary" 
            @click="handleEdit()" 
            :disabled="isLoading"
            :class="{ 'opacity-50 cursor-not-allowed': isLoading }">
      <span x-show="!isLoading">ìˆ˜ì •</span>
      <span x-show="isLoading" class="flex items-center">
        <svg class="animate-spin h-4 w-4 mr-2" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        ì²˜ë¦¬ì¤‘...
      </span>
    </button>
    
    <button class="btn btn-outline" 
            @click="handleDelete()"
            x-confirm="ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?">
      ì‚­ì œ
    </button>
  </div>
  
  <!-- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ -->
  <div x-show="error" 
       x-transition
       class="mt-2 text-sm text-red-600 bg-red-50 p-2 rounded">
    <span x-text="error"></span>
  </div>
</div>

<script>
// âœ… ì¢‹ì€ ì˜ˆì‹œ: Alpine.js ì»´í¬ë„ŒíŠ¸ í•¨ìˆ˜
function studentCardData(studentData = {}) {
  return {
    // ë°ì´í„° ìƒíƒœ
    student: studentData,
    isLoading: false,
    error: null,
    
    // ì´ˆê¸°í™” í•¨ìˆ˜
    init() {
      // UTF-8 ì¸ì½”ë”© ê²€ì¦
      this.validateUTF8();
    },
    
    // í•™ìƒ í¸ì§‘ ì²˜ë¦¬
    async handleEdit() {
      this.isLoading = true;
      this.error = null;
      
      try {
        // HTMX ìš”ì²­ìœ¼ë¡œ ì„œë²„ì™€ í†µì‹ 
        const response = await fetch(`/api/students/${this.student.id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(this.student)
        });
        
        if (!response.ok) {
          throw new Error('ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        
        const result = await response.json();
        
        // ì„±ê³µ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë˜ëŠ” ì´ë²¤íŠ¸ ë°œìƒ
        this.$dispatch('student-updated', { 
          student: result,
          message: 'í•™ìƒ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' 
        });
        
      } catch (error) {
        console.error('í¸ì§‘ ì‹¤íŒ¨:', error);
        this.error = error.message || 'í¸ì§‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
      } finally {
        this.isLoading = false;
      }
    },
    
    // í•™ìƒ ì‚­ì œ ì²˜ë¦¬
    async handleDelete() {
      this.isLoading = true;
      this.error = null;
      
      try {
        const response = await fetch(`/api/students/${this.student.id}`, {
          method: 'DELETE'
        });
        
        if (!response.ok) {
          throw new Error('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì„±ê³µ ì‹œ ì´ë²¤íŠ¸ ë°œìƒ
        this.$dispatch('student-deleted', { 
          studentId: this.student.id,
          message: 'í•™ìƒ ì •ë³´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.' 
        });
        
      } catch (error) {
        console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
        this.error = error.message || 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
      } finally {
        this.isLoading = false;
      }
    },
    
    // UTF-8 ì¸ì½”ë”© ê²€ì¦
    validateUTF8() {
      if (this.student.name && !this.isValidUTF8(this.student.name)) {
        console.warn('í•™ìƒ ì´ë¦„ UTF-8 ì¸ì½”ë”© ë¬¸ì œ ê°ì§€');
        this.error = 'í•™ìƒ ì´ë¦„ì— ì¸ì½”ë”© ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.';
      }
    },
    
    // UTF-8 ìœ íš¨ì„± ê²€ì‚¬ ìœ í‹¸ë¦¬í‹°
    isValidUTF8(str) {
      try {
        const encoded = new TextEncoder().encode(str);
        const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
        return decoded === str;
      } catch (error) {
        return false;
      }
    }
  };
}
</script>
```

---

## 12.3 ë‹¨ìˆœí™”ëœ ê°œë°œ ì›Œí¬í”Œë¡œìš° (HTML + Alpine.js + HTMX)

### 12.3.1 Git ë¸Œëœì¹˜ ì „ëµ (ë‹¨ìˆœí™”ëœ ë²„ì „)
```bash
# ğŸŒ³ ë¸Œëœì¹˜ êµ¬ì¡° (ë‹¨ìˆœí™”ëœ ë²„ì „)
main                    # í”„ë¡œë•ì…˜ ë°°í¬ìš© (HTML íŒŒì¼ë“¤)
â”œâ”€â”€ develop            # ê°œë°œ í†µí•© ë¸Œëœì¹˜
â”œâ”€â”€ feature/student-page    # í•™ìƒ ê´€ë¦¬ í˜ì´ì§€
â”œâ”€â”€ feature/dashboard-ui    # ëŒ€ì‹œë³´ë“œ UI
â””â”€â”€ bugfix/form-validation  # í¼ ìœ íš¨ì„± ê²€ì‚¬ ë²„ê·¸

# ğŸš€ ê¸°ëŠ¥ ê°œë°œ ì›Œí¬í”Œë¡œìš°
git checkout develop
git pull origin develop
git checkout -b feature/new-student-form

# HTML/CSS/JS íŒŒì¼ ìˆ˜ì • í›„
git add public/students/add.html public/css/components.css
git commit -m "feat(students): í•™ìƒ ì¶”ê°€ í¼ ë° ìœ íš¨ì„± ê²€ì‚¬ ì¶”ê°€"
git push origin feature/new-student-form
```

### 12.3.2 ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜ (HTML ê¸°ë°˜)
```bash
# ì˜ˆì‹œ
feat(auth): ë¡œê·¸ì¸ HTML í˜ì´ì§€ ë° Alpine.js ë¡œì§ ì¶”ê°€
fix(students): í•™ìƒ ëª©ë¡ HTMX ë¡œë”© ì˜¤ë¥˜ ìˆ˜ì •
style(dashboard): ëŒ€ì‹œë³´ë“œ ë°˜ì‘í˜• CSS ê°œì„ 
refactor(forms): ê³µí†µ í¼ ì»´í¬ë„ŒíŠ¸ Alpine.jsë¡œ ë¦¬íŒ©í† ë§
```

---

## 12.4 ë¸Œë¼ìš°ì € ê¸°ë°˜ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ (HTML + Alpine.js + HTMX)

### 12.4.1 ë¸Œë¼ìš°ì € ê¸°ë°˜ í…ŒìŠ¤íŠ¸ êµ¬ì¡° (HTML + Alpine.js)
```html
<!-- tests/student-form.test.html - ë¸Œë¼ìš°ì € ê¸°ë°˜ í…ŒìŠ¤íŠ¸ -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>StudentForm í…ŒìŠ¤íŠ¸</title>
  
  <!-- Alpine.js CDN -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- í…ŒìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ -->
  <style>
    .test-container { max-width: 600px; margin: 20px auto; padding: 20px; }
    .test-section { margin-bottom: 30px; border: 1px solid #ddd; padding: 15px; }
    .test-result { margin-top: 10px; padding: 10px; border-radius: 4px; }
    .test-pass { background: #d4edda; color: #155724; }
    .test-fail { background: #f8d7da; color: #721c24; }
    .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
    .btn-primary { background: #007bff; color: white; }
    .error { color: #dc3545; font-size: 12px; }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>í•™ìƒ ë“±ë¡ í¼ í…ŒìŠ¤íŠ¸</h1>
    
    <!-- í…ŒìŠ¤íŠ¸ 1: í¼ í•„ë“œ ë Œë”ë§ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section" x-data="testFormRendering()">
      <h3>Test 1: í¼ í•„ë“œ ë Œë”ë§ ê²€ì¦</h3>
      
      <!-- í•™ìƒ ë“±ë¡ í¼ -->
      <form x-data="studentFormData()" @submit.prevent="handleSubmit()">
        <div>
          <label for="student-name">í•™ìƒ ì´ë¦„</label>
          <input id="student-name" 
                 type="text" 
                 x-model="formData.name" 
                 required>
        </div>
        
        <div>
          <label for="birth-date">ìƒë…„ì›”ì¼</label>
          <input id="birth-date" 
                 type="date" 
                 x-model="formData.birth_date" 
                 required>
        </div>
        
        <div>
          <label for="school-name">í•™êµëª…</label>
          <input id="school-name" 
                 type="text" 
                 x-model="formData.school_name" 
                 required>
        </div>
        
        <button type="submit" class="btn btn-primary">ì €ì¥</button>
      </form>
      
      <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
      <div class="test-result" 
           :class="testResult.pass ? 'test-pass' : 'test-fail'" 
           x-text="testResult.message"></div>
      
      <button class="btn" @click="runTest()">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
    </div>
    
    <!-- í…ŒìŠ¤íŠ¸ 2: í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ -->
    <div class="test-section" x-data="testValidation()">
      <h3>Test 2: í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬</h3>
      
      <form x-data="studentFormData()" @submit.prevent="handleSubmit()">
        <div>
          <label for="test2-name">í•™ìƒ ì´ë¦„</label>
          <input id="test2-name" 
                 type="text" 
                 x-model="formData.name">
          <div class="error" x-show="errors.name" x-text="errors.name"></div>
        </div>
        
        <div>
          <label for="test2-birth">ìƒë…„ì›”ì¼</label>
          <input id="test2-birth" 
                 type="date" 
                 x-model="formData.birth_date">
          <div class="error" x-show="errors.birth_date" x-text="errors.birth_date"></div>
        </div>
        
        <button type="submit" class="btn btn-primary">ì €ì¥</button>
      </form>
      
      <div class="test-result" 
           :class="testResult.pass ? 'test-pass' : 'test-fail'" 
           x-text="testResult.message"></div>
           
      <button class="btn" @click="runValidationTest()">ìœ íš¨ì„± ê²€ì‚¬ í…ŒìŠ¤íŠ¸</button>
    </div>
    
    <!-- í…ŒìŠ¤íŠ¸ 3: ë°ì´í„° ì œì¶œ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section" x-data="testSubmission()">
      <h3>Test 3: ì˜¬ë°”ë¥¸ ë°ì´í„° ì œì¶œ í…ŒìŠ¤íŠ¸</h3>
      
      <form x-data="studentFormData()" @submit.prevent="handleSubmit()" x-ref="testForm">
        <div>
          <input type="text" 
                 x-model="formData.name" 
                 placeholder="í•™ìƒ ì´ë¦„">
        </div>
        <div>
          <input type="date" 
                 x-model="formData.birth_date">
        </div>
        <button type="submit">ì €ì¥</button>
      </form>
      
      <div class="test-result" 
           :class="testResult.pass ? 'test-pass' : 'test-fail'" 
           x-text="testResult.message"></div>
           
      <button class="btn" @click="runSubmissionTest()">ì œì¶œ í…ŒìŠ¤íŠ¸</button>
    </div>
  </div>
  
  <script>
    // í•™ìƒ í¼ ë°ì´í„° ì»´í¬ë„ŒíŠ¸
    function studentFormData() {
      return {
        formData: {
          name: '',
          birth_date: '',
          school_name: ''
        },
        errors: {},
        
        validateForm() {
          this.errors = {};
          
          if (!this.formData.name?.trim()) {
            this.errors.name = 'ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤';
          }
          
          if (!this.formData.birth_date) {
            this.errors.birth_date = 'ìƒë…„ì›”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤';
          }
          
          return Object.keys(this.errors).length === 0;
        },
        
        handleSubmit() {
          if (this.validateForm()) {
            // ì„±ê³µ ì‹œ ì´ë²¤íŠ¸ ë°œìƒ
            this.$dispatch('form-submitted', this.formData);
            console.log('ì œì¶œ ë°ì´í„°:', this.formData);
          }
        }
      };
    }
    
    // í…ŒìŠ¤íŠ¸ 1: í¼ ë Œë”ë§
    function testFormRendering() {
      return {
        testResult: { pass: false, message: 'í…ŒìŠ¤íŠ¸ ëŒ€ê¸°ì¤‘...' },
        
        runTest() {
          try {
            // DOM ìš”ì†Œ í™•ì¸
            const nameField = document.querySelector('#student-name');
            const birthField = document.querySelector('#birth-date');
            const schoolField = document.querySelector('#school-name');
            
            if (nameField && birthField && schoolField) {
              this.testResult = {
                pass: true,
                message: 'âœ… PASS: ëª¨ë“  í•„ë“œê°€ ì˜¬ë°”ë¥´ê²Œ ë Œë”ë§ë˜ì—ˆìŠµë‹ˆë‹¤.'
              };
            } else {
              this.testResult = {
                pass: false,
                message: 'âŒ FAIL: ì¼ë¶€ í•„ë“œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.'
              };
            }
          } catch (error) {
            this.testResult = {
              pass: false,
              message: 'âŒ ERROR: ' + error.message
            };
          }
        }
      };
    }
    
    // í…ŒìŠ¤íŠ¸ 2: ìœ íš¨ì„± ê²€ì‚¬
    function testValidation() {
      return {
        testResult: { pass: false, message: 'í…ŒìŠ¤íŠ¸ ëŒ€ê¸°ì¤‘...' },
        
        runValidationTest() {
          try {
            // ë¹ˆ í¼ ì œì¶œ ì‹œë„
            const nameInput = document.querySelector('#test2-name');
            const submitBtn = nameInput.closest('form').querySelector('button[type="submit"]');
            
            // ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •
            nameInput.value = '';
            nameInput.dispatchEvent(new Event('input'));
            
            // ì œì¶œ ë²„íŠ¼ í´ë¦­
            submitBtn.click();
            
            // ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
            setTimeout(() => {
              const errorMsg = document.querySelector('.error[x-show="errors.name"]');
              if (errorMsg && errorMsg.textContent.includes('ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤')) {
                this.testResult = {
                  pass: true,
                  message: 'âœ… PASS: í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ ì„±ê³µ'
                };
              } else {
                this.testResult = {
                  pass: false,
                  message: 'âŒ FAIL: ìœ íš¨ì„± ê²€ì‚¬ê°€ ì‘ë™í•˜ì§€ ì•ŠìŒ'
                };
              }
            }, 100);
            
          } catch (error) {
            this.testResult = {
              pass: false,
              message: 'âŒ ERROR: ' + error.message
            };
          }
        }
      };
    }
    
    // í…ŒìŠ¤íŠ¸ 3: ë°ì´í„° ì œì¶œ
    function testSubmission() {
      return {
        testResult: { pass: false, message: 'í…ŒìŠ¤íŠ¸ ëŒ€ê¸°ì¤‘...' },
        submittedData: null,
        
        runSubmissionTest() {
          // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
          document.addEventListener('form-submitted', (event) => {
            this.submittedData = event.detail;
          });
          
          try {
            const form = this.$refs.testForm || document.querySelector('form');
            const nameInput = form.querySelector('input[type="text"]');
            const dateInput = form.querySelector('input[type="date"]');
            const submitBtn = form.querySelector('button[type="submit"]');
            
            // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì…ë ¥
            nameInput.value = 'í™ê¸¸ë™';
            dateInput.value = '2010-01-01';
            
            // ì´ë²¤íŠ¸ ë°œìƒì‹œí‚¤ê¸°
            nameInput.dispatchEvent(new Event('input'));
            dateInput.dispatchEvent(new Event('input'));
            
            // í¼ ì œì¶œ
            submitBtn.click();
            
            // ê²°ê³¼ í™•ì¸
            setTimeout(() => {
              if (this.submittedData && 
                  this.submittedData.name === 'í™ê¸¸ë™' && 
                  this.submittedData.birth_date === '2010-01-01') {
                this.testResult = {
                  pass: true,
                  message: 'âœ… PASS: ì˜¬ë°”ë¥¸ ë°ì´í„°ë¡œ ì œì¶œ ì„±ê³µ'
                };
              } else {
                this.testResult = {
                  pass: false,
                  message: 'âŒ FAIL: ì œì¶œ ë°ì´í„°ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ'
                };
              }
            }, 100);
            
          } catch (error) {
            this.testResult = {
              pass: false,
              message: 'âŒ ERROR: ' + error.message
            };
          }
        }
      };
    }
  </script>
</body>
</html>
```

### 12.4.2 ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•
```bash
# 1. í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°
open tests/student-form.test.html

# 2. ë˜ëŠ” ë¡œì»¬ ì„œë²„ë¡œ ì‹¤í–‰
python3 -m http.server 8000
# ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8000/tests/student-form.test.html ì ‘ì†

# 3. ë‹¨ìˆœí•œ JavaScript ìë™ í…ŒìŠ¤íŠ¸ (Playwright ì„ íƒì‚¬í•­)
npm install playwright

# 4. Alpine.js ì „ìš© í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹° (cypress ì„ íƒì‚¬í•­)
npm install cypress --save-dev
npx cypress open
```

---

## 11.5 HTMX + Edge Functions ê°œë°œ ê°€ì´ë“œ

### 11.5.1 Edge Functions êµ¬ì¡°
```javascript
// supabase/functions/students/index.ts
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
};

serve(async (req) => {
  // CORS ì²˜ë¦¬
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders });
  }

  try {
    const supabaseClient = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_ANON_KEY') ?? '',
      {
        global: {
          headers: { Authorization: req.headers.get('Authorization')! },
        },
      }
    );

    const { data: { user } } = await supabaseClient.auth.getUser();
    
    if (!user) {
      return new Response(
        JSON.stringify({ error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' }),
        { 
          status: 401,
          headers: { ...corsHeaders, 'Content-Type': 'application/json' }
        }
      );
    }

    if (req.method === 'GET') {
      return await handleGetStudents(supabaseClient, user.id);
    } else if (req.method === 'POST') {
      const body = await req.json();
      return await handleCreateStudent(supabaseClient, user.id, body);
    }

    return new Response(
      JSON.stringify({ error: 'ì§€ì›í•˜ì§€ ì•ŠëŠ” ìš”ì²­ ë°©ì‹ì…ë‹ˆë‹¤' }),
      { 
        status: 405,
        headers: { ...corsHeaders, 'Content-Type': 'application/json' }
      }
    );
  } catch (error) {
    return new Response(
      JSON.stringify({ 
        success: false, 
        error: error.message || 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'
      }),
      { 
        status: 500,
        headers: { ...corsHeaders, 'Content-Type': 'application/json' }
      }
    );
  }
});

// í•™ìƒ ëª©ë¡ ì¡°íšŒ
async function handleGetStudents(supabase, userId) {
  const { data, error } = await supabase
    .from('students')
    .select('*')
    .eq('user_id', userId)
    .order('name');

  if (error) {
    throw new Error(`í•™ìƒ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`);
  }

  return new Response(
    JSON.stringify({
      success: true,
      data
    }),
    {
      headers: { ...corsHeaders, 'Content-Type': 'application/json' }
    }
  );
}

// í•™ìƒ ìƒì„±
async function handleCreateStudent(supabase, userId, body) {
  // UTF-8 ì¸ì½”ë”© ê²€ì¦
  if (body.name && !isValidUTF8(body.name)) {
    throw new Error('ì´ë¦„ì— ìœ íš¨í•˜ì§€ ì•Šì€ ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤');
  }

  // ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
  if (!body.name || body.name.trim().length === 0) {
    throw new Error('í•™ìƒ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤');
  }
  
  if (!body.grade || !['elementary', 'middle', 'high'].includes(body.grade)) {
    throw new Error('ìœ íš¨í•œ í•™ë…„ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
  }

  const { data, error } = await supabase
    .from('students')
    .insert([{
      name: body.name.trim(),
      grade: body.grade,
      birth_date: body.birth_date,
      user_id: userId
    }])
    .select()
    .single();

  if (error) {
    throw new Error(`í•™ìƒ ë“±ë¡ ì‹¤íŒ¨: ${error.message}`);
  }

  return new Response(
    JSON.stringify({
      success: true,
      data
    }),
    {
      headers: { ...corsHeaders, 'Content-Type': 'application/json' }
    }
  );
}

// UTF-8 ì¸ì½”ë”© ê²€ì¦ í•¨ìˆ˜
function isValidUTF8(str) {
  try {
    return str === decodeURIComponent(encodeURIComponent(str));
  } catch {
    return false;
  }
}
```

### 11.5.2 HTMX í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™
```html
<!-- students.html - í•™ìƒ ê´€ë¦¬ í˜ì´ì§€ -->
<div x-data="studentsManager()" class="students-container">
  <!-- í•™ìƒ ëª©ë¡ -->
  <div 
    hx-get="/functions/v1/students"
    hx-headers='{"Authorization": "Bearer " + Alpine.store("auth").token}'
    hx-target="#students-list"
    hx-trigger="load, students-updated from:body"
    hx-indicator="#loading"
  >
    <div id="loading" class="htmx-indicator">ë¡œë”© ì¤‘...</div>
    <div id="students-list">
      <!-- í•™ìƒ ëª©ë¡ì´ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
    </div>
  </div>

  <!-- í•™ìƒ ë“±ë¡ í¼ -->
  <form 
    hx-post="/functions/v1/students"
    hx-headers='{"Authorization": "Bearer " + Alpine.store("auth").token}'
    hx-target="#form-result"
    hx-on::after-request="handleStudentFormResponse"
    @submit.prevent
  >
    <input 
      type="text" 
      name="name" 
      placeholder="í•™ìƒ ì´ë¦„"
      required
      maxlength="100"
      x-model="formData.name"
    >
    
    <select name="grade" required x-model="formData.grade">
      <option value="">í•™ë…„ ì„ íƒ</option>
      <option value="elementary">ì´ˆë“±í•™ìƒ</option>
      <option value="middle">ì¤‘í•™ìƒ</option>
      <option value="high">ê³ ë“±í•™ìƒ</option>
    </select>
    
    <input 
      type="date" 
      name="birth_date"
      x-model="formData.birth_date"
    >
    
    <button type="submit" class="btn-primary">
      í•™ìƒ ë“±ë¡
    </button>
  </form>
  
  <div id="form-result"></div>
</div>

<script>
function studentsManager() {
  return {
    formData: {
      name: '',
      grade: '',
      birth_date: ''
    },
    
    handleStudentFormResponse(event) {
      const response = JSON.parse(event.detail.xhr.responseText);
      
      if (response.success) {
        // ì„±ê³µ ì‹œ í¼ ì´ˆê¸°í™” ë° ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        this.formData = {
          name: '',
          grade: '',
          birth_date: ''
        };
        
        // í•™ìƒ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ë°œìƒ
        document.body.dispatchEvent(new CustomEvent('students-updated'));
        
        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        Alpine.store('toast').show('í•™ìƒì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } else {
        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        Alpine.store('toast').show(response.error || 'ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
    }
  };
}
</script>
```

### 11.5.3 ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´
```javascript
// js/error-handler.js - í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬ ì²˜ë¦¬
class APIErrorHandler {
  static handle(error, context = '') {
    console.error(`API Error ${context}:`, error);
    
    // í•œê¸€ ì—ëŸ¬ ë©”ì‹œì§€ ë§¤í•‘
    const errorMessages = {
      'AUTHENTICATION_ERROR': 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤',
      'AUTHORIZATION_ERROR': 'ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤',
      'VALIDATION_ERROR': 'ì…ë ¥ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”',
      'NOT_FOUND': 'ìš”ì²­í•˜ì‹  ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
      'INTERNAL_ERROR': 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'
    };
    
    let message = error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤';
    
    // ì—ëŸ¬ ì½”ë“œê°€ ìˆëŠ” ê²½ìš° í•œê¸€ ë©”ì‹œì§€ë¡œ ë³€í™˜
    if (error.code && errorMessages[error.code]) {
      message = errorMessages[error.code];
    }
    
    // UTF-8 ì¸ì½”ë”© ì˜¤ë¥˜ ì²´í¬
    if (!this.isValidUTF8(message)) {
      message = 'í…ìŠ¤íŠ¸ ì¸ì½”ë”© ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤';
    }
    
    // Toast ë©”ì‹œì§€ë¡œ ì‚¬ìš©ìì—ê²Œ í‘œì‹œ
    Alpine.store('toast').show(message, 'error');
    
    return {
      success: false,
      error: message
    };
  }
  
  static isValidUTF8(str) {
    try {
      return str === decodeURIComponent(encodeURIComponent(str));
    } catch {
      return false;
    }
  }
  
  // HTMX ì‘ë‹µ ì—ëŸ¬ ì²˜ë¦¬
  static handleHTMXError(event) {
    const xhr = event.detail.xhr;
    let errorMessage = 'ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤';
    
    try {
      const response = JSON.parse(xhr.responseText);
      errorMessage = response.error || response.message || errorMessage;
    } catch {
      // JSON íŒŒì‹± ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ë©”ì‹œì§€ ì‚¬ìš©
    }
    
    this.handle({ message: errorMessage }, `HTTP ${xhr.status}`);
  }
}

// ì „ì—­ HTMX ì—ëŸ¬ í•¸ë“¤ëŸ¬ ì„¤ì •
document.addEventListener('htmx:responseError', (event) => {
  APIErrorHandler.handleHTMXError(event);
});

document.addEventListener('htmx:sendError', (event) => {
  APIErrorHandler.handle({ 
    message: 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”' 
  }, 'Network Error');
});
```

### 11.5.4 Edge Functions ë°°í¬
```bash
# Edge Functions ë°°í¬ ëª…ë ¹ì–´
supabase functions deploy students
supabase functions deploy curriculum
supabase functions deploy ai-services

# í•¨ìˆ˜ ë¡œê·¸ í™•ì¸
supabase functions logs students

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
supabase secrets set OPENAI_API_KEY=your_openai_key
supabase secrets set TOSS_PAYMENTS_SECRET_KEY=your_toss_key
};
```

---

## 11.6 ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

### 11.6.1 ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
```sql
-- supabase/migrations/20240101000000_create_students_table.sql
CREATE TABLE students (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  name VARCHAR(100) NOT NULL,
  birth_date DATE NOT NULL,
  school_name VARCHAR(200),
  grade INTEGER,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS ì •ì±… ì¶”ê°€
ALTER TABLE students ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own students" ON students
FOR ALL USING (user_id = auth.uid());

-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX idx_students_user_id ON students(user_id);
CREATE INDEX idx_students_name ON students(name);
```

### 11.6.2 ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
```bash
# ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
supabase migration new create_students_table

# ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
supabase db push

# ì›ê²© ë°ì´í„°ë² ì´ìŠ¤ì— ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
supabase db push --project-ref your-project-ref

# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
supabase migration list

# ë°ì´í„°ë² ì´ìŠ¤ ë¦¬ì…‹ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ)
supabase db reset
```

---

## 11.7 ì„±ëŠ¥ ìµœì í™”

### 11.7.1 Alpine.js ì„±ëŠ¥ ìµœì í™”
```html
<!-- í•™ìƒ ëª©ë¡ ì»´í¬ë„ŒíŠ¸ - x-for ìµœì í™” -->
<div x-data="studentListManager()" class="student-list-container">
  <!-- ì»¤ìŠ¤í…€ ë¡œë”© ì¸ë””ì¼€ì´í„° -->
  <div x-show="loading" class="loading-indicator">
    <div class="spinner"></div>
    <span>í•™ìƒ ëª©ë¡ ë¡œë”© ì¤‘...</span>
  </div>

  <!-- ê²€ìƒ‰ ë° í•„í„° -->
  <div class="search-filters mb-4">
    <input 
      type="text" 
      x-model="searchQuery" 
      @input.debounce.300ms="filterStudents"
      placeholder="í•™ìƒ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..."
      class="form-input"
    >
    <select x-model="gradeFilter" @change="filterStudents">
      <option value="">ëª¨ë“  í•™ë…„</option>
      <option value="elementary">ì´ˆë“±í•™ìƒ</option>
      <option value="middle">ì¤‘í•™ìƒ</option>
      <option value="high">ê³ ë“±í•™ìƒ</option>
    </select>
  </div>

  <!-- ê°€ìƒí™”ëœ ë¦¬ìŠ¤íŠ¸ (ì„±ëŠ¥ ìµœì í™”) -->
  <div class="virtual-list" x-show="!loading">
    <template x-for="(student, index) in paginatedStudents" :key="student.id">
      <div 
        class="student-card"
        x-data="{ editing: false }"
        :class="{ 'highlight': student.id === selectedStudentId }"
      >
        <div class="student-info">
          <h3 x-text="student.name" class="student-name"></h3>
          <p class="student-details">
            <span x-text="getGradeName(student.grade)"></span>
            <span x-show="student.school_name" x-text="' - ' + student.school_name"></span>
          </p>
        </div>
        
        <div class="student-actions">
          <button 
            @click="editStudent(student)"
            class="btn-edit"
            :disabled="editing"
          >
            í¸ì§‘
          </button>
          <button 
            @click="confirmDelete(student)"
            class="btn-delete"
            :disabled="editing"
          >
            ì‚­ì œ
          </button>
        </div>
      </div>
    </template>
  </div>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
  <div class="pagination" x-show="totalPages > 1">
    <button 
      @click="prevPage"
      :disabled="currentPage === 1"
      class="btn-pagination"
    >
      ì´ì „
    </button>
    <span class="page-info">
      <span x-text="currentPage"></span> / <span x-text="totalPages"></span>
    </span>
    <button 
      @click="nextPage"
      :disabled="currentPage === totalPages"
      class="btn-pagination"
    >
      ë‹¤ìŒ
    </button>
  </div>
</div>

<script>
function studentListManager() {
  return {
    // ë°ì´í„° ìƒíƒœ
    students: [],
    filteredStudents: [],
    paginatedStudents: [],
    loading: false,
    selectedStudentId: null,
    
    // ê²€ìƒ‰ ë° í•„í„°
    searchQuery: '',
    gradeFilter: '',
    
    // í˜ì´ì§€ë„¤ì´ì…˜
    currentPage: 1,
    itemsPerPage: 10,
    totalPages: 1,
    
    init() {
      this.loadStudents();
      // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ
      this.$watch('students', () => this.filterStudents());
    },
    
    async loadStudents() {
      this.loading = true;
      try {
        // HTMX ëŒ€ì‹  ì§ì ‘ Supabase í˜¸ì¶œë¡œ ì„±ëŠ¥ ìµœì í™”
        const response = await fetch('/functions/v1/students', {
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`,
            'Content-Type': 'application/json'
          }
        });
        
        const result = await response.json();
        if (result.success) {
          this.students = result.data;
        }
      } catch (error) {
        Alpine.store('toast').show('í•™ìƒ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨', 'error');
      } finally {
        this.loading = false;
      }
    },
    
    // ë””ë°”ìš´ì‹±ëœ ê²€ìƒ‰ (ì„±ëŠ¥ ìµœì í™”)
    filterStudents() {
      let filtered = this.students;
      
      if (this.searchQuery) {
        const query = this.searchQuery.toLowerCase();
        filtered = filtered.filter(student => 
          student.name.toLowerCase().includes(query) ||
          (student.school_name && student.school_name.toLowerCase().includes(query))
        );
      }
      
      if (this.gradeFilter) {
        filtered = filtered.filter(student => student.grade === this.gradeFilter);
      }
      
      this.filteredStudents = filtered;
      this.totalPages = Math.ceil(filtered.length / this.itemsPerPage);
      this.updatePagination();
    },
    
    updatePagination() {
      const start = (this.currentPage - 1) * this.itemsPerPage;
      const end = start + this.itemsPerPage;
      this.paginatedStudents = this.filteredStudents.slice(start, end);
    },
    
    prevPage() {
      if (this.currentPage > 1) {
        this.currentPage--;
        this.updatePagination();
      }
    },
    
    nextPage() {
      if (this.currentPage < this.totalPages) {
        this.currentPage++;
        this.updatePagination();
      }
    },
    
    // ì‚¬ìš©ì ì•¡ì…˜ (ë©”ëª¨ì´ì œì´ì…˜ íš¨ê³¼)
    editStudent(student) {
      this.selectedStudentId = student.id;
      Alpine.store('modal').openStudentEdit(student);
    },
    
    confirmDelete(student) {
      Alpine.store('modal').confirm(
        'í•™ìƒ ì‚­ì œ',
        `â€œ${student.name}â€ í•™ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,
        () => this.deleteStudent(student.id)
      );
    },
    
    async deleteStudent(studentId) {
      try {
        const response = await fetch(`/functions/v1/students/${studentId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          }
        });
        
        if (response.ok) {
          this.students = this.students.filter(s => s.id !== studentId);
          Alpine.store('toast').show('í•™ìƒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }
      } catch (error) {
        Alpine.store('toast').show('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
    },
    
    getGradeName(grade) {
      const gradeNames = {
        'elementary': 'ì´ˆë“±í•™ìƒ',
        'middle': 'ì¤‘í•™ìƒ',
        'high': 'ê³ ë“±í•™ìƒ'
      };
      return gradeNames[grade] || grade;
    }
  };
}
</script>
```

### 11.7.2 ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”
```typescript
// í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒ
const { data } = await supabase
  .from('students')
  .select('id, name, school_name, grade')
  .eq('user_id', userId);

// í˜ì´ì§€ë„¤ì´ì…˜
const { data } = await supabase
  .from('students')
  .select('*')
  .range(0, 9) // 0-9ë²ˆì§¸ ë ˆì½”ë“œ
  .order('name');

// ì¡°ì¸ ìµœì í™”
const { data } = await supabase
  .from('students')
  .select(`
    id,
    name,
    current_levels (
      semester,
      lang_summary
    )
  `)
  .eq('user_id', userId);
```

---

## 11.8 ë””ë²„ê¹… ë° ë¡œê¹…

### 11.8.1 ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ë””ë²„ê¹…
```html
<!-- ë””ë²„ê¹… ì½˜ì†” ì»´í¬ë„ŒíŠ¸ -->
<div x-data="debugConsole()" x-show="isDevelopment" class="debug-console">
  <div class="debug-header">
    <h3>ğŸ” ë””ë²„ê¹… ì½˜ì†”</h3>
    <button @click="toggleConsole" class="toggle-btn">
      <span x-text="isVisible ? 'ìˆ¨ê¸°ê¸°' : 'ë³´ì´ê¸°'"></span>
    </button>
  </div>
  
  <div x-show="isVisible" class="debug-content">
    <!-- ë¡œê·¸ ë¦¬ìŠ¤íŠ¸ -->
    <div class="log-container">
      <div class="log-header">
        <span>ë¡œê·¸ ê¸°ë¡</span>
        <button @click="clearLogs" class="clear-btn">ì§€ìš°ê¸°</button>
      </div>
      <div class="log-list">
        <template x-for="(log, index) in logs" :key="index">
          <div class="log-entry" :class="'log-' + log.type">
            <span class="log-time" x-text="log.timestamp"></span>
            <span class="log-message" x-text="log.message"></span>
            <details x-show="log.data">
              <summary>ë°ì´í„° ë³´ê¸°</summary>
              <pre x-text="JSON.stringify(log.data, null, 2)"></pre>
            </details>
          </div>
        </template>
      </div>
    </div>
    
    <!-- Alpine.js ìƒíƒœ ëª¨ë‹ˆí„°ë§ -->
    <div class="state-monitor">
      <h4>Alpine.js ìƒíƒœ ëª¨ë‹ˆí„°ë§</h4>
      <div class="state-item">
        <strong>ì¸ì¦:</strong>
        <span x-text="JSON.stringify(Alpine.store('auth').$data, null, 2)"></span>
      </div>
      <div class="state-item">
        <strong>í•™ìƒ ë°ì´í„°:</strong>
        <span x-text="JSON.stringify(Alpine.store('students').$data, null, 2)"></span>
      </div>
    </div>
  </div>
</div>

<!-- í•™ìƒ í¼ ì»´í¬ë„ŒíŠ¸ (ë””ë²„ê¹… ê¸°ëŠ¥ í¬í•¨) -->
<div x-data="studentFormDebug()" class="student-form-debug">
  <form @submit.prevent="submitForm">
    <input 
      type="text" 
      x-model="formData.name" 
      @input="logFormChange('name', $event.target.value)"
      placeholder="í•™ìƒ ì´ë¦„"
      required
    >
    <select 
      x-model="formData.grade" 
      @change="logFormChange('grade', $event.target.value)"
      required
    >
      <option value="">í•™ë…„ ì„ íƒ</option>
      <option value="elementary">ì´ˆë“±í•™ìƒ</option>
      <option value="middle">ì¤‘í•™ìƒ</option>
      <option value="high">ê³ ë“±í•™ìƒ</option>
    </select>
    <button type="submit">ë“±ë¡</button>
  </form>
  
  <!-- ì‹¤ì‹œê°„ í¼ ë°ì´í„° ëª¨ë‹ˆí„°ë§ -->
  <div x-show="isDevelopment" class="form-debug-info">
    <h4>í¼ ë°ì´í„° ìƒíƒœ:</h4>
    <pre x-text="JSON.stringify(formData, null, 2)"></pre>
  </div>
</div>

<script>
// ë””ë²„ê¹… ì½˜ì†” ê´€ë¦¬
function debugConsole() {
  return {
    isDevelopment: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1',
    isVisible: false,
    logs: [],
    
    init() {
      // ì „ì—­ ë””ë²„ê¹… í•¨ìˆ˜ ë“±ë¡
      window.debugLog = this.log.bind(this);
      
      // Alpine.js ì˜¤ë¥˜ ìº¡ì²˜
      window.addEventListener('alpine:init', () => {
        Alpine.store('debug', {
          log: this.log.bind(this),
          error: (message, data) => this.log(message, data, 'error'),
          warn: (message, data) => this.log(message, data, 'warn'),
          info: (message, data) => this.log(message, data, 'info')
        });
      });
    },
    
    toggleConsole() {
      this.isVisible = !this.isVisible;
    },
    
    log(message, data = null, type = 'info') {
      if (!this.isDevelopment) return;
      
      const timestamp = new Date().toLocaleTimeString();
      this.logs.unshift({
        timestamp,
        message,
        data,
        type
      });
      
      // ë¡œê·¸ ì œí•œ (100ê°œ)
      if (this.logs.length > 100) {
        this.logs = this.logs.slice(0, 100);
      }
      
      // ë¸Œë¼ìš°ì € ì½˜ì†”ì—ë„ ì¶œë ¥
      console.log(`[IEPON ${type.toUpperCase()}] ${message}`, data);
    },
    
    clearLogs() {
      this.logs = [];
    }
  };
}

// í•™ìƒ í¼ ë””ë²„ê¹…
function studentFormDebug() {
  return {
    formData: {
      name: '',
      grade: '',
      birth_date: ''
    },
    isDevelopment: window.location.hostname === 'localhost',
    
    init() {
      // í¼ ë°ì´í„° ë³€í™” ëª¨ë‹ˆí„°ë§
      this.$watch('formData', (newValue, oldValue) => {
        if (this.isDevelopment) {
          window.debugLog('í¼ ë°ì´í„° ë³€ê²½', {
            before: oldValue,
            after: newValue
          });
        }
      }, { deep: true });
    },
    
    logFormChange(field, value) {
      if (this.isDevelopment) {
        window.debugLog(`í¼ í•„ë“œ ë³€ê²½: ${field}`, {
          field,
          value,
          formData: { ...this.formData }
        });
      }
    },
    
    async submitForm() {
      window.debugLog('í¼ ì œì¶œ ì‹œë„', this.formData);
      
      try {
        const response = await fetch('/functions/v1/students', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: JSON.stringify(this.formData)
        });
        
        const result = await response.json();
        window.debugLog('í¼ ì œì¶œ ì‘ë‹µ', result);
        
        if (result.success) {
          this.formData = { name: '', grade: '', birth_date: '' };
          Alpine.store('toast').show('í•™ìƒì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        } else {
          Alpine.store('toast').show(result.error, 'error');
        }
      } catch (error) {
        window.debugLog('í¼ ì œì¶œ ì˜¤ë¥˜', error, 'error');
        Alpine.store('toast').show('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
    }
  };
}
</script>
```

### 11.8.2 ì—ëŸ¬ ë¡œê¹…
```typescript
// lib/logger.ts
export const logError = (error: Error, context?: any) => {
  const errorInfo = {
    message: error.message,
    stack: error.stack,
    context,
    timestamp: new Date().toISOString(),
    url: window.location.href,
    userAgent: navigator.userAgent
  };

  // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì½˜ì†”ì— ì¶œë ¥
  if (process.env.NODE_ENV === 'development') {
    console.error('Error logged:', errorInfo);
  }

  // í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì™¸ë¶€ ì„œë¹„ìŠ¤ë¡œ ì „ì†¡
  if (process.env.NODE_ENV === 'production') {
    // Sentry, LogRocket ë“±ìœ¼ë¡œ ì „ì†¡
    window.Sentry?.captureException(error, { extra: context });
  }
};

// ì‚¬ìš© ì˜ˆì‹œ
try {
  await saveStudent(studentData);
} catch (error) {
  logError(error, { studentData, userId });
  throw error;
}

export async function generateEvaluationReport(evaluationData: EvaluationData): Promise<string> {
  // í‰ê°€ ë³´ê³ ì„œ ìë™ ìƒì„± êµ¬í˜„
}
```

### 11.10.2 AI ê¸°ëŠ¥ ì»´í¬ë„ŒíŠ¸
```html
<!-- AI êµìœ¡ëª©í‘œ ìƒì„± ì»´í¬ë„ŒíŠ¸ -->
<div x-data="aiGoalGenerator()" class="ai-goal-generator bg-blue-50 p-4 rounded-lg">
  <div class="header mb-4">
    <h3 class="text-lg font-semibold mb-2">ğŸ¤– AI êµìœ¡ëª©í‘œ ìƒì„±</h3>
    <p class="text-sm text-gray-600">
      í•™ìƒì˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ AIê°€ ê°œë³„í™”ëœ êµìœ¡ëª©í‘œë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.
    </p>
  </div>

  <!-- í•™ìƒ ì •ë³´ ì…ë ¥ -->
  <div class="student-info mb-4">
    <input 
      type="hidden" 
      x-model="studentInfo.id" 
      name="student_id"
    >
    <div class="info-display p-3 bg-white rounded border">
      <div class="student-name">
        <strong>í•™ìƒ:</strong> 
        <span x-text="studentInfo.name || 'í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”'"></span>
      </div>
      <div class="student-grade" x-show="studentInfo.grade">
        <strong>í•™ë…„:</strong> 
        <span x-text="getGradeName(studentInfo.grade)"></span>
      </div>
      <div class="student-level" x-show="studentInfo.current_level">
        <strong>í˜„ì¬ ìˆ˜ì¤€:</strong> 
        <span x-text="studentInfo.current_level"></span>
      </div>
    </div>
  </div>

  <!-- AI ëª©í‘œ ìƒì„± ë²„íŠ¼ -->
  <div class="generation-controls mb-4">
    <button
      @click="generateGoal"
      :disabled="isGenerating || !studentInfo.id"
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
    >
      <span x-show="!isGenerating">AI ëª©í‘œ ìƒì„±</span>
      <span x-show="isGenerating" class="flex items-center">
        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
        ìƒì„± ì¤‘...
      </span>
    </button>
    
    <button
      x-show="!isGenerating && generatedGoal"
      @click="regenerateGoal"
      class="ml-2 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"
    >
      ë‹¤ì‹œ ìƒì„±
    </button>
  </div>

  <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
  <div 
    x-show="error" 
    x-transition
    class="error-message mt-2 p-3 bg-red-100 text-red-700 text-sm rounded border-l-4 border-red-500"
  >
    <div class="flex items-center">
      <span class="mr-2">âš ï¸</span>
      <span x-text="error"></span>
    </div>
    <button @click="error = null" class="mt-1 text-xs underline">ë‹«ê¸°</button>
  </div>

  <!-- ìƒì„±ëœ ëª©í‘œ ê²°ê³¼ -->
  <div 
    x-show="generatedGoal" 
    x-transition
    class="generated-goal mt-4 p-4 bg-green-50 border border-green-200 rounded"
  >
    <div class="goal-header flex justify-between items-center mb-3">
      <h4 class="font-semibold text-green-800">âœ¨ AI ìƒì„± êµìœ¡ëª©í‘œ</h4>
      <div class="actions">
        <button
          @click="copyGoal"
          class="text-xs bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700"
        >
          ë³µì‚¬
        </button>
        <button
          @click="saveGoal"
          class="ml-1 text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700"
        >
          ì €ì¥
        </button>
      </div>
    </div>
    <div class="goal-content text-sm text-gray-700 whitespace-pre-line" x-text="generatedGoal"></div>
  </div>
</div>

<script>
function aiGoalGenerator() {
  return {
    // í•™ìƒ ì •ë³´ ë°ì´í„°
    studentInfo: {
      id: '',
      name: '',
      grade: '',
      current_level: '',
      birth_date: ''
    },
    
    // ìƒíƒœ ê´€ë¦¬
    isGenerating: false,
    generatedGoal: '',
    error: null,
    
    init() {
      // ì „ì—­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (í•™ìƒ ì„ íƒ ì‹œ)
      document.addEventListener('student-selected', (event) => {
        this.studentInfo = event.detail;
        this.error = null;
      });
    },
    
    async generateGoal() {
      if (!this.studentInfo.id) {
        this.error = 'í•™ìƒì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”';
        return;
      }
      
      this.isGenerating = true;
      this.error = null;
      
      try {
        // UTF-8 ì¸ì½”ë”© ê²€ì¦
        if (!this.isValidUTF8(this.studentInfo.name)) {
          throw new Error('í•™ìƒ ì´ë¦„ì— ì¸ì½”ë”© ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤');
        }
        
        const response = await fetch('/functions/v1/ai-services/generate-goal', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: JSON.stringify({
            student_id: this.studentInfo.id,
            student_info: this.studentInfo
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          this.generatedGoal = result.data.goal;
          
          // ìƒì„± ì™„ë£Œ ì´ë²¤íŠ¸ ë°œìƒ
          document.dispatchEvent(new CustomEvent('ai-goal-generated', {
            detail: {
              studentId: this.studentInfo.id,
              goal: this.generatedGoal
            }
          }));
          
          Alpine.store('toast').show('AI êµìœ¡ëª©í‘œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        } else {
          throw new Error(result.error || 'AI ëª©í‘œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
        }
      } catch (error) {
        this.error = error.message || 'AI ëª©í‘œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤';
        Alpine.store('toast').show(this.error, 'error');
      } finally {
        this.isGenerating = false;
      }
    },
    
    async regenerateGoal() {
      this.generatedGoal = '';
      await this.generateGoal();
    },
    
    async copyGoal() {
      try {
        await navigator.clipboard.writeText(this.generatedGoal);
        Alpine.store('toast').show('ëª©í‘œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
      } catch (error) {
        Alpine.store('toast').show('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
      }
    },
    
    async saveGoal() {
      if (!this.generatedGoal) return;
      
      try {
        const response = await fetch('/functions/v1/education-plans', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${Alpine.store('auth').token}`
          },
          body: JSON.stringify({
            student_id: this.studentInfo.id,
            goals: this.generatedGoal,
            type: 'ai_generated',
            status: 'draft'
          })
        });
        
        if (response.ok) {
          Alpine.store('toast').show('êµìœ¡ëª©í‘œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }
      } catch (error) {
        Alpine.store('toast').show('ëª©í‘œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
      }
    },
    
    getGradeName(grade) {
      const gradeNames = {
        'elementary': 'ì´ˆë“±í•™ìƒ',
        'middle': 'ì¤‘í•™ìƒ',
        'high': 'ê³ ë“±í•™ìƒ'
      };
      return gradeNames[grade] || grade;
    },
    
    isValidUTF8(str) {
      try {
        return str === decodeURIComponent(encodeURIComponent(str));
      } catch {
        return false;
      }
    }
  };
}
</script>
```
```

---

## 11.11 íŒŒì¼ ì—…ë¡œë“œ ì‹œìŠ¤í…œ ê°œë°œ ê°€ì´ë“œ

### 11.11.1 ë³´ì•ˆ íŒŒì¼ ì—…ë¡œë“œ êµ¬í˜„
```html
<!-- ë³´ì•ˆ íŒŒì¼ ì—…ë¡œë“œ ì»´í¬ë„ŒíŠ¸ -->
<div x-data="secureFileUpload()" class="secure-file-upload">
  <!-- ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ -->
  <div 
    x-ref="dropzone"
    @drop.prevent="handleDrop($event)"
    @dragover.prevent="dragActive = true"
    @dragleave.prevent="dragActive = false"
    @click="$refs.fileInput.click()"
    class="border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors"
    :class="{
      'border-blue-500 bg-blue-50': dragActive,
      'border-gray-300 hover:border-gray-400': !dragActive
    }"
  >
    <!-- ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ -->
    <input 
      x-ref="fileInput"
      type="file" 
      @change="handleFileSelect($event)" 
      :accept="allowedTypes.join(',')"
      class="hidden"
      multiple="false"
    >
    
    <!-- ì—…ë¡œë“œ ìƒíƒœ í‘œì‹œ -->
    <div x-show="uploading" class="text-blue-600">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"></div>
      <span>ì—…ë¡œë“œ ì¤‘...</span>
    </div>
    
    <!-- ê¸°ë³¸ ìƒíƒœ í‘œì‹œ -->
    <div x-show="!uploading">
      <div class="text-gray-600 mb-2">
        <span x-show="dragActive">íŒŒì¼ì„ ì—¬ê¸°ì— ë†“ìœ¼ì„¸ìš”</span>
        <span x-show="!dragActive">íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</span>
      </div>
      <div class="text-sm text-gray-500">
        ìµœëŒ€ <span x-text="Math.round(maxSize / 1024 / 1024)"></span>MB, 
        <span x-text="allowedTypes.join(', ')"></span>
      </div>
    </div>
    
    <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
    <div x-show="error" x-transition class="mt-2 p-2 bg-red-100 text-red-600 text-sm rounded">
      <span x-text="error"></span>
      <button @click="error = null" class="ml-2 underline">ë‹«ê¸°</button>
    </div>
  </div>
  
  <!-- ì—…ë¡œë“œ ì§„í–‰ë¥  -->
  <div x-show="uploading" class="mt-4">
    <div class="bg-gray-200 rounded-full h-2">
      <div 
        class="bg-blue-600 h-2 rounded-full transition-all duration-300"
        :style="`width: ${uploadProgress}%`"
      ></div>
    </div>
    <div class="text-xs text-gray-500 mt-1 text-center">
      <span x-text="uploadProgress"></span>% ì™„ë£Œ
    </div>
  </div>
</div>

<script>
function secureFileUpload(options = {}) {
  return {
    // ì„¤ì • ì˜µì…˜
    allowedTypes: options.allowedTypes || ['image/jpeg', 'image/png', 'application/pdf'],
    maxSize: options.maxSize || 10 * 1024 * 1024, // 10MB
    linkTable: options.linkTable || null,
    linkId: options.linkId || null,
    
    // ìƒíƒœ ê´€ë¦¬
    uploading: false,
    error: null,
    dragActive: false,
    uploadProgress: 0,
    
    init() {
      // ì „ì—­ íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.addEventListener('file-upload-complete', (event) => {
        console.log('íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ:', event.detail);
      });
    },
    
    handleDrop(event) {
      this.dragActive = false;
      const files = Array.from(event.dataTransfer.files);
      if (files.length > 0) {
        this.processFile(files[0]);
      }
    },
    
    handleFileSelect(event) {
      const files = Array.from(event.target.files);
      if (files.length > 0) {
        this.processFile(files[0]);
      }
    },
    
    async processFile(file) {
      // íŒŒì¼ í¬ê¸° ê²€ì¦
      if (file.size > this.maxSize) {
        this.error = `íŒŒì¼ í¬ê¸°ëŠ” ${Math.round(this.maxSize / 1024 / 1024)}MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
        return;
      }
      
      // íŒŒì¼ íƒ€ì… ê²€ì¦
      if (!this.allowedTypes.includes(file.type)) {
        this.error = 'í—ˆìš©ë˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
        return;
      }
      
      // UTF-8 íŒŒì¼ëª… ê²€ì¦
      if (!this.isValidUTF8(file.name)) {
        this.error = 'íŒŒì¼ëª…ì— ì¸ì½”ë”© ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. íŒŒì¼ëª…ì„ ì˜ë¬¸ìœ¼ë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”.';
        return;
      }
      
      await this.uploadFile(file);
    },
    
    async uploadFile(file) {
      this.uploading = true;
      this.error = null;
      this.uploadProgress = 0;
      
      try {
        // FormData ìƒì„±
        const formData = new FormData();
        formData.append('file', file);
        if (this.linkTable) formData.append('link_table', this.linkTable);
        if (this.linkId) formData.append('link_id', this.linkId);
        
        // XMLHttpRequestë¥¼ ì‚¬ìš©í•œ ì—…ë¡œë“œ ì§„í–‰ë¥  ì¶”ì 
        const uploadResult = await this.uploadWithProgress(formData);
        
        // ì—…ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸ ë°œìƒ
        document.dispatchEvent(new CustomEvent('file-upload-complete', {
          detail: {
            fileInfo: uploadResult,
            linkTable: this.linkTable,
            linkId: this.linkId
          }
        }));
        
        Alpine.store('toast').show('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        
        // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
        this.$refs.fileInput.value = '';
        
      } catch (error) {
        this.error = error.message || 'íŒŒì¼ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤';
        Alpine.store('toast').show(this.error, 'error');
      } finally {
        this.uploading = false;
        this.uploadProgress = 0;
      }
    },
    
    uploadWithProgress(formData) {
      return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        
        // ì—…ë¡œë“œ ì§„í–‰ë¥  ì¶”ì 
        xhr.upload.addEventListener('progress', (event) => {
          if (event.lengthComputable) {
            this.uploadProgress = Math.round((event.loaded / event.total) * 100);
          }
        });
        
        xhr.onload = () => {
          if (xhr.status >= 200 && xhr.status < 300) {
            try {
              const response = JSON.parse(xhr.responseText);
              if (response.success) {
                resolve(response.data);
              } else {
                reject(new Error(response.error || 'ì—…ë¡œë“œ ì‹¤íŒ¨'));
              }
            } catch (error) {
              reject(new Error('ì„œë²„ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨'));
            }
          } else {
            reject(new Error(`HTTP ${xhr.status}: ${xhr.statusText}`));
          }
        };
        
        xhr.onerror = () => {
          reject(new Error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'));
        };
        
        xhr.open('POST', '/functions/v1/file-upload');
        xhr.setRequestHeader('Authorization', `Bearer ${Alpine.store('auth').token}`);
        xhr.send(formData);
      });
    },
    
    isValidUTF8(str) {
      try {
        return str === decodeURIComponent(encodeURIComponent(str));
      } catch {
        return false;
      }
    }
  };
}
</script>
```
```

---

## 11.12 ì‹¤ì‹œê°„ ê¸°ëŠ¥ ê°œë°œ ê°€ì´ë“œ

### 11.12.1 Alpine.js + Supabase Realtime í™œìš©
```html
<!-- ì‹¤ì‹œê°„ ë°ì´í„° ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸ -->
<div x-data="realtimeDataManager()" class="realtime-data-container">
  <!-- ë¡œë”© ìƒíƒœ -->
  <div x-show="loading" class="loading-state">
    <div class="animate-pulse flex space-x-4">
      <div class="rounded-full bg-gray-300 h-12 w-12"></div>
      <div class="flex-1 space-y-2 py-1">
        <div class="h-4 bg-gray-300 rounded w-3/4"></div>
        <div class="h-4 bg-gray-300 rounded w-1/2"></div>
      </div>
    </div>
  </div>
  
  <!-- ì—ëŸ¬ ìƒíƒœ -->
  <div x-show="error" x-transition class="error-state p-4 bg-red-100 border border-red-400 rounded">
    <div class="flex items-center">
      <span class="text-red-500 mr-2">âš ï¸</span>
      <span class="text-red-700" x-text="error"></span>
    </div>
    <button @click="retryLoad()" class="mt-2 text-sm bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
      ë‹¤ì‹œ ì‹œë„
    </button>
  </div>
  
  <!-- ì‹¤ì‹œê°„ ë°ì´í„° ë¦¬ìŠ¤íŠ¸ -->
  <div x-show="!loading && !error" class="data-list">
    <!-- ì—°ê²° ìƒíƒœ í‘œì‹œ -->
    <div class="connection-status mb-4 flex items-center text-sm">
      <div class="flex items-center">
        <div 
          class="w-2 h-2 rounded-full mr-2"
          :class="connected ? 'bg-green-500' : 'bg-red-500'"
        ></div>
        <span x-text="connected ? 'ì‹¤ì‹œê°„ ì—°ê²°ë¨' : 'ì—°ê²° ëŠì–´ì§'"></span>
      </div>
      <button 
        x-show="!connected" 
        @click="reconnect()" 
        class="ml-4 text-blue-600 hover:text-blue-800"
      >
        ì¬ì—°ê²°
      </button>
    </div>
    
    <!-- ë°ì´í„° ì•„ì´í…œë“¤ -->
    <div class="space-y-2">
      <template x-for="(item, index) in data" :key="item.id || index">
        <div 
          class="data-item p-3 border rounded transition-all"
          :class="{
            'bg-green-50 border-green-200': item._isNew,
            'bg-yellow-50 border-yellow-200': item._isUpdated,
            'bg-gray-50 border-gray-200': !item._isNew && !item._isUpdated
          }"
        >
          <!-- ì•„ì´í…œ ë‚´ìš©ì€ ì‚¬ìš©ìê°€ ì»¤ìŠ¤í…€í™” -->
          <div class="item-content">
            <span x-text="item.name || item.title || 'No Name'"></span>
            <span x-show="item.created_at" class="text-xs text-gray-500 ml-2">
              <span x-text="formatDate(item.created_at)"></span>
            </span>
          </div>
          
          <!-- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í‘œì‹œ -->
          <div x-show="item._isNew" class="text-xs text-green-600 mt-1">
            âœ¨ ìƒˆë¡œ ì¶”ê°€ë¨
          </div>
          <div x-show="item._isUpdated" class="text-xs text-yellow-600 mt-1">
            ğŸ”„ ì—…ë°ì´íŠ¸ë¨
          </div>
        </div>
      </template>
      
      <!-- ë¹„ì–´ìˆì„ ë•Œ -->
      <div x-show="data.length === 0" class="text-center py-8 text-gray-500">
        ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤
      </div>
    </div>
  </div>
</div>

<script>
function realtimeDataManager(options = {}) {
  return {
    // ì„¤ì •
    table: options.table || 'students',
    filter: options.filter || null,
    
    // ìƒíƒœ
    data: [],
    loading: true,
    error: null,
    connected: false,
    channel: null,
    
    init() {
      this.loadInitialData();
      this.setupRealtimeSubscription();
      
      // ì „ì—­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.addEventListener('realtime-data-update', (event) => {
        this.handleExternalUpdate(event.detail);
      });
    },
    
    async loadInitialData() {
      this.loading = true;
      this.error = null;
      
      try {
        const { createClient } = await import('@supabase/supabase-js');
        const supabase = createClient(
          window.SUPABASE_URL || '',
          window.SUPABASE_ANON_KEY || ''
        );
        
        let query = supabase.from(this.table).select('*');
        
        // í•„í„° ì ìš©
        if (this.filter) {
          const [column, operator, value] = this.filter.split('=');
          if (operator === 'eq') {
            query = query.eq(column, value);
          } else if (operator === 'neq') {
            query = query.neq(column, value);
          } else if (operator === 'gt') {
            query = query.gt(column, value);
          } else if (operator === 'lt') {
            query = query.lt(column, value);
          }
        }
        
        // ì¸ì¦ëœ ì‚¬ìš©ì ë°ì´í„°ë§Œ ë¡œë“œ
        if (Alpine.store('auth').token) {
          query = query.order('created_at', { ascending: false });
        }
        
        const { data, error } = await query;
        
        if (error) {
          throw new Error(`ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
        }
        
        // UTF-8 ì¸ì½”ë”© ê²€ì¦
        const validData = (data || []).filter(item => {
          if (item.name && !this.isValidUTF8(item.name)) {
            console.warn('ì¸ì½”ë”© ë¬¸ì œê°€ ìˆëŠ” ë°ì´í„° ë°œê²¬:', item);
            return false;
          }
          return true;
        });
        
        this.data = validData;
        
      } catch (error) {
        this.error = error.message || 'ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤';
        console.error('Realtime data load error:', error);
      } finally {
        this.loading = false;
      }
    },
    
    async setupRealtimeSubscription() {
      try {
        const { createClient } = await import('@supabase/supabase-js');
        const supabase = createClient(
          window.SUPABASE_URL || '',
          window.SUPABASE_ANON_KEY || ''
        );
        
        this.channel = supabase
          .channel(`realtime_${this.table}_${Date.now()}`)
          .on('postgres_changes', 
            { 
              event: '*', 
              schema: 'public', 
              table: this.table,
              filter: this.filter
            },
            (payload) => {
              this.handleRealtimeUpdate(payload);
            }
          )
          .on('system', {}, (payload) => {
            // ì—°ê²° ìƒíƒœ ë³€ê²½ ì²˜ë¦¬
            if (payload.event === 'connected') {
              this.connected = true;
              console.log('ì‹¤ì‹œê°„ ì—°ê²° ì„±ê³µ');
            } else if (payload.event === 'disconnected') {
              this.connected = false;
              console.log('ì‹¤ì‹œê°„ ì—°ê²° ëŠì–´ì§');
            }
          })
          .subscribe((status) => {
            if (status === 'SUBSCRIBED') {
              this.connected = true;
            } else if (status === 'CHANNEL_ERROR') {
              this.connected = false;
              console.error('ì‹¤ì‹œê°„ êµ¬ë… ì˜¤ë¥˜');
            }
          });
          
      } catch (error) {
        console.error('ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì • ì‹¤íŒ¨:', error);
      }
    },
    
    handleRealtimeUpdate(payload) {
      const { eventType, new: newRecord, old: oldRecord } = payload;
      
      // UTF-8 ì¸ì½”ë”© ê²€ì¦
      if (newRecord && newRecord.name && !this.isValidUTF8(newRecord.name)) {
        console.warn('ì¸ì½”ë”© ë¬¸ì œê°€ ìˆëŠ” ì‹¤ì‹œê°„ ë°ì´í„°:', newRecord);
        return;
      }
      
      switch (eventType) {
        case 'INSERT':
          // ìƒˆ ë°ì´í„° í‘œì‹œ
          newRecord._isNew = true;
          this.data.unshift(newRecord);
          
          // 3ì´ˆ í›„ í‘œì‹œ ì œê±°
          setTimeout(() => {
            const index = this.data.findIndex(item => item.id === newRecord.id);
            if (index !== -1) {
              this.data[index]._isNew = false;
            }
          }, 3000);
          
          // ì•Œë¦¼ í‘œì‹œ
          Alpine.store('toast').show(`ìƒˆë¡œìš´ ${this.table} í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`, 'info');
          break;
          
        case 'UPDATE':
          const updateIndex = this.data.findIndex(item => item.id === newRecord.id);
          if (updateIndex !== -1) {
            newRecord._isUpdated = true;
            this.data[updateIndex] = newRecord;
            
            // 3ì´ˆ í›„ í‘œì‹œ ì œê±°
            setTimeout(() => {
              const currentIndex = this.data.findIndex(item => item.id === newRecord.id);
              if (currentIndex !== -1) {
                this.data[currentIndex]._isUpdated = false;
              }
            }, 3000);
          }
          break;
          
        case 'DELETE':
          this.data = this.data.filter(item => item.id !== oldRecord.id);
          Alpine.store('toast').show(`${this.table} í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤`, 'info');
          break;
      }
      
      // ì „ì—­ ì´ë²¤íŠ¸ ë°œìƒ
      document.dispatchEvent(new CustomEvent('data-updated', {
        detail: {
          table: this.table,
          eventType,
          data: newRecord || oldRecord
        }
      }));
    },
    
    async retryLoad() {
      await this.loadInitialData();
    },
    
    async reconnect() {
      if (this.channel) {
        await this.channel.unsubscribe();
      }
      this.setupRealtimeSubscription();
    },
    
    formatDate(dateString) {
      return new Date(dateString).toLocaleString('ko-KR');
    },
    
    handleExternalUpdate(detail) {
      // ì™¸ë¶€ì—ì„œ ë°œìƒí•œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì²˜ë¦¬
      if (detail.table === this.table) {
        this.loadInitialData();
      }
    },
    
    isValidUTF8(str) {
      try {
        return str === decodeURIComponent(encodeURIComponent(str));
      } catch {
        return false;
      }
    },
    
    destroy() {
      if (this.channel) {
        this.channel.unsubscribe();
      }
    }
  };
}
</script>
```
```

### 11.12.2 Alpine.js ê¸°ë°˜ ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ
```html
<!-- ì‹¤ì‹œê°„ ì•Œë¦¼ ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸ -->
<div x-data="realtimeNotifications()" class="realtime-notifications">
  <!-- ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ -->
  <div 
    x-show="showPermissionRequest" 
    x-transition
    class="permission-request fixed top-4 right-4 z-50 bg-blue-100 border border-blue-400 rounded-lg p-4 max-w-sm"
  >
    <div class="flex items-center mb-2">
      <span class="text-blue-500 mr-2">ğŸ””</span>
      <h4 class="font-semibold text-blue-800">ë¸Œë¼ìš°ì € ì•Œë¦¼ í—ˆìš©</h4>
    </div>
    <p class="text-sm text-blue-700 mb-3">
      ì¤‘ìš”í•œ ì•Œë¦¼ì„ ë†“ì¹˜ì§€ ì•Šë„ë¡ ë¸Œë¼ìš°ì € ì•Œë¦¼ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.
    </p>
    <div class="flex space-x-2">
      <button 
        @click="requestNotificationPermission" 
        class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
      >
        í—ˆìš©
      </button>
      <button 
        @click="showPermissionRequest = false" 
        class="bg-gray-300 text-gray-700 px-3 py-1 rounded text-sm hover:bg-gray-400"
      >
        ë‹¤ìŒì—
      </button>
    </div>
  </div>

  <!-- ì•Œë¦¼ ë¦¬ìŠ¤íŠ¸ (ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆëŠ” UI) -->
  <div 
    x-show="showNotificationList" 
    x-transition
    class="notification-list fixed top-16 right-4 z-50 bg-white border border-gray-300 rounded-lg shadow-lg max-w-sm max-h-96 overflow-y-auto"
  >
    <div class="notification-header p-3 border-b border-gray-200">
      <div class="flex justify-between items-center">
        <h4 class="font-semibold text-gray-800">ì•Œë¦¼</h4>
        <div class="flex items-center space-x-2">
          <button 
            x-show="notifications.length > 0"
            @click="markAllAsRead"
            class="text-xs text-blue-600 hover:text-blue-800"
          >
            ëª¨ë‘ ì½ìŒ
          </button>
          <button 
            @click="showNotificationList = false"
            class="text-gray-500 hover:text-gray-700"
          >
            Ã—
          </button>
        </div>
      </div>
    </div>
    
    <div class="notification-items">
      <template x-for="(notification, index) in notifications" :key="notification.id">
        <div 
          class="notification-item p-3 border-b border-gray-100 cursor-pointer hover:bg-gray-50"
          :class="{ 'bg-blue-50': !notification.read }"
          @click="markAsRead(notification.id)"
        >
          <div class="flex items-start">
            <div class="notification-icon mr-3 mt-1">
              <span x-text="getNotificationIcon(notification.type)"></span>
            </div>
            <div class="notification-content flex-1">
              <p class="text-sm text-gray-800" x-text="notification.message"></p>
              <p class="text-xs text-gray-500 mt-1" x-text="formatTime(notification.created_at)"></p>
            </div>
            <div x-show="!notification.read" class="notification-badge">
              <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
            </div>
          </div>
        </div>
      </template>
      
      <div x-show="notifications.length === 0" class="p-6 text-center text-gray-500">
        <div class="mb-2">ğŸ””</div>
        <p class="text-sm">ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
      </div>
    </div>
  </div>
  
  <!-- ì•Œë¦¼ ë²„íŠ¼ (í—¤ë”ì— í‘œì‹œë˜ëŠ” ë²„íŠ¼) -->
  <button 
    @click="toggleNotificationList" 
    class="notification-trigger relative p-2 text-gray-600 hover:text-gray-800 transition-colors"
    :class="{ 'text-blue-600': unreadCount > 0 }"
  >
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M15 17h5l-3.5-3.5a7.5 7.5 0 01-1.5-4.5V9a6 6 0 00-12 0v1.5c0 1.5-.5 3-1.5 4.5L5 17h5m5 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
    </svg>
    <span 
      x-show="unreadCount > 0" 
      x-text="unreadCount" 
      class="notification-badge absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"
    ></span>
  </button>
</div>

<script>
function realtimeNotifications() {
  return {
    // ìƒíƒœ ê´€ë¦¬
    notifications: [],
    unreadCount: 0,
    showNotificationList: false,
    showPermissionRequest: false,
    notificationChannel: null,
    
    // ì„¤ì •
    maxNotifications: 50,
    
    init() {
      this.checkNotificationPermission();
      this.loadNotifications();
      this.setupRealtimeNotifications();
      
      // ì „ì—­ ì•Œë¦¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.addEventListener('show-notification', (event) => {
        this.addNotification(event.detail);
      });
    },
    
    checkNotificationPermission() {
      if ('Notification' in window) {
        if (Notification.permission === 'default') {
          // 5ì´ˆ í›„ì— ê¶Œí•œ ìš”ì²­ í‘œì‹œ
          setTimeout(() => {
            this.showPermissionRequest = true;
          }, 5000);
        }
      }
    },
    
    async requestNotificationPermission() {
      if ('Notification' in window) {
        const permission = await Notification.requestPermission();
        if (permission === 'granted') {
          Alpine.store('toast').show('ë¸Œë¼ìš°ì € ì•Œë¦¼ì´ í™œì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }
        this.showPermissionRequest = false;
      }
    },
    
    async loadNotifications() {
      try {
        const { createClient } = await import('@supabase/supabase-js');
        const supabase = createClient(
          window.SUPABASE_URL || '',
          window.SUPABASE_ANON_KEY || ''
        );
        
        const { data, error } = await supabase
          .from('notifications')
          .select('*')
          .eq('user_id', Alpine.store('auth').user?.id)
          .order('created_at', { ascending: false })
          .limit(this.maxNotifications);
          
        if (error) {
          console.error('ì•Œë¦¼ ë¡œë“œ ì‹¤íŒ¨:', error);
          return;
        }
        
        // UTF-8 ì¸ì½”ë”© ê²€ì¦
        const validNotifications = (data || []).filter(notification => {
          if (notification.message && !this.isValidUTF8(notification.message)) {
            console.warn('ì¸ì½”ë”© ë¬¸ì œê°€ ìˆëŠ” ì•Œë¦¼:', notification);
            return false;
          }
          return true;
        });
        
        this.notifications = validNotifications;
        this.updateUnreadCount();
        
      } catch (error) {
        console.error('ì•Œë¦¼ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    },
    
    async setupRealtimeNotifications() {
      if (!Alpine.store('auth').user?.id) return;
      
      try {
        const { createClient } = await import('@supabase/supabase-js');
        const supabase = createClient(
          window.SUPABASE_URL || '',
          window.SUPABASE_ANON_KEY || ''
        );
        
        this.notificationChannel = supabase
          .channel('realtime_notifications')
          .on('postgres_changes', 
            {
              event: 'INSERT',
              schema: 'public',
              table: 'notifications',
              filter: `user_id=eq.${Alpine.store('auth').user.id}`
            },
            (payload) => {
              this.handleNewNotification(payload.new);
            }
          )
          .subscribe();
          
      } catch (error) {
        console.error('ì‹¤ì‹œê°„ ì•Œë¦¼ ì„¤ì • ì‹¤íŒ¨:', error);
      }
    },
    
    handleNewNotification(notification) {
      // UTF-8 ì¸ì½”ë”© ê²€ì¦
      if (!this.isValidUTF8(notification.message)) {
        console.warn('ì¸ì½”ë”© ë¬¸ì œê°€ ìˆëŠ” ì‹¤ì‹œê°„ ì•Œë¦¼:', notification);
        return;
      }
      
      // ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
      this.notifications.unshift(notification);
      
      // ì œí•œ ì´ˆê³¼ ì‹œ ê°€ì¥ ì˜¤ë˜ëœ ì•Œë¦¼ ì œê±°
      if (this.notifications.length > this.maxNotifications) {
        this.notifications = this.notifications.slice(0, this.maxNotifications);
      }
      
      this.updateUnreadCount();
      
      // Toast ì•Œë¦¼ í‘œì‹œ
      Alpine.store('toast').show(notification.message, notification.type || 'info', {
        icon: this.getNotificationIcon(notification.type),
        duration: 5000
      });
      
      // ë¸Œë¼ìš°ì € ì•Œë¦¼ (ê¶Œí•œì´ ìˆëŠ” ê²½ìš°)
      if (Notification.permission === 'granted') {
        new Notification(notification.title || 'IEPON ì•Œë¦¼', {
          body: notification.message,
          icon: '/favicon.ico',
          badge: '/favicon.ico',
          tag: notification.id
        });
      }
    },
    
    addNotification(notificationData) {
      // ìˆ˜ë™ìœ¼ë¡œ ì•Œë¦¼ ì¶”ê°€ (ì „ì—­ ì´ë²¤íŠ¸ë¡œë¶€í„°)
      const notification = {
        id: Date.now().toString(),
        message: notificationData.message,
        type: notificationData.type || 'info',
        created_at: new Date().toISOString(),
        read: false
      };
      
      this.handleNewNotification(notification);
    },
    
    async markAsRead(notificationId) {
      try {
        const notification = this.notifications.find(n => n.id === notificationId);
        if (!notification || notification.read) return;
        
        // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
        notification.read = true;
        this.updateUnreadCount();
        
        // ì„œë²„ì— ì—…ë°ì´íŠ¸
        const { createClient } = await import('@supabase/supabase-js');
        const supabase = createClient(
          window.SUPABASE_URL || '',
          window.SUPABASE_ANON_KEY || ''
        );
        
        await supabase
          .from('notifications')
          .update({ read: true })
          .eq('id', notificationId);
          
      } catch (error) {
        console.error('ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
      }
    },
    
    async markAllAsRead() {
      try {
        // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
        this.notifications.forEach(notification => {
          notification.read = true;
        });
        this.updateUnreadCount();
        
        // ì„œë²„ì— ì—…ë°ì´íŠ¸
        const { createClient } = await import('@supabase/supabase-js');
        const supabase = createClient(
          window.SUPABASE_URL || '',
          window.SUPABASE_ANON_KEY || ''
        );
        
        await supabase
          .from('notifications')
          .update({ read: true })
          .eq('user_id', Alpine.store('auth').user?.id)
          .eq('read', false);
          
      } catch (error) {
        console.error('ì•Œë¦¼ ëª¨ë‘ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
      }
    },
    
    toggleNotificationList() {
      this.showNotificationList = !this.showNotificationList;
    },
    
    updateUnreadCount() {
      this.unreadCount = this.notifications.filter(n => !n.read).length;
    },
    
    getNotificationIcon(type) {
      const icons = {
        'success': 'âœ…',
        'warning': 'âš ï¸',
        'error': 'âŒ',
        'info': 'â„¹ï¸'
      };
      return icons[type] || 'â„¹ï¸';
    },
    
    formatTime(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffInMinutes = Math.floor((now - date) / (1000 * 60));
      
      if (diffInMinutes < 1) return 'ë°©ê¸ˆ ì „';
      if (diffInMinutes < 60) return `${diffInMinutes}ë¶„ ì „`;
      if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}ì‹œê°„ ì „`;
      return date.toLocaleDateString('ko-KR');
    },
    
    isValidUTF8(str) {
      try {
        return str === decodeURIComponent(encodeURIComponent(str));
      } catch {
        return false;
      }
    },
    
    destroy() {
      if (this.notificationChannel) {
        this.notificationChannel.unsubscribe();
      }
    }
  };
}
</script>
```
```

---

## ğŸ“‹ **ì²´í¬ë¦¬ìŠ¤íŠ¸**

### ê°œë°œ í™˜ê²½ ì„¤ì • (HTML + Alpine.js + HTMX)
- [ ] ì •ì  íŒŒì¼ í˜¸ìŠ¤íŒ… í™˜ê²½ ì¤€ë¹„
- [ ] Alpine.js/HTMX CDN ë§í¬ ì„¤ì •
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (window.ENV)
- [ ] Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
- [ ] ê´€ë¦¬ì ê³„ì • ìë™ ìƒì„±
- [ ] ê²°ì œ ì‹œìŠ¤í…œ êµ¬ì¶• (Toss Payments ìœ„ì ¯)
- [ ] AI ê¸°ëŠ¥ í†µí•© (Edge Functions)
- [ ] íŒŒì¼ ì—…ë¡œë“œ ì‹œìŠ¤í…œ êµ¬ì¶• (Supabase Storage)
- [ ] ì‹¤ì‹œê°„ ê¸°ëŠ¥ êµ¬ì¶• (HTMX + Supabase Realtime)

### ì½”ë“œ í’ˆì§ˆ (JavaScript + HTML)
- [ ] JSDoc ì£¼ì„ ì‘ì„± (TypeScript ëŒ€ì‹ )
- [ ] ESLint/Prettier ì„¤ì • (JavaScript ì „ìš©)
- [ ] HTML ìœ íš¨ì„± ê²€ì‚¬ (html-validate)
- [ ] ì ‘ê·¼ì„± ê²€ì‚¬ (WAVE, axe-core)
- [ ] ì½”ë“œ ë¦¬ë·° ì™„ë£Œ

### ì„±ëŠ¥ ë° ë³´ì•ˆ
- [ ] ì„±ëŠ¥ ìµœì í™” ì ìš©
- [ ] ë³´ì•ˆ ê²€ì¦ ì™„ë£Œ
- [ ] ì—ëŸ¬ ì²˜ë¦¬ êµ¬í˜„
- [ ] ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì„±

### ë°°í¬ ì¤€ë¹„
- [ ] ë¹Œë“œ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] í™˜ê²½ë³„ ì„¤ì • í™•ì¸
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì¤€ë¹„

---

## 11.9 ê´€ë¦¬ì ì‹œìŠ¤í…œ ê°œë°œ ê°€ì´ë“œ

### 11.9.1 ê´€ë¦¬ì ê³„ì • ì´ˆê¸°í™”
```bash
# 1. ì´ˆê¸° ê´€ë¦¬ì ê³„ì • ì„¤ì •
# Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ì§ì ‘ ê´€ë¦¬ì ê³„ì • ìƒì„± (ê¶Œì¥ ë°©ë²•)
# ë˜ëŠ” ì•„ë˜ SQL ì¿¼ë¦¬ë¥¼ Supabase SQL Editorì—ì„œ ì‹¤í–‰

# 2. ìˆ˜ë™ ì„¤ì •
psql -h localhost -d iepon -U postgres
```

```sql
-- ì´ˆê¸° super_admin ê³„ì • ìƒì„±
INSERT INTO auth.users (
  id,
  email,
  encrypted_password,
  email_confirmed_at,
  created_at,
  updated_at,
  raw_user_meta_data
) VALUES (
  gen_random_uuid(),
  'admin@iepon.site',
  crypt('IeponAdmin2024!', gen_salt('bf')),
  now(),
  now(),
  now(),
  '{"role": "super_admin"}'
);

-- user_profiles í…Œì´ë¸”ì— í”„ë¡œí•„ ìƒì„±
INSERT INTO user_profiles (
  id,
  email,
  full_name,
  role,
  is_active,
  organization,
  department
) SELECT 
  id,
  email,
  'ì‹œìŠ¤í…œ ê´€ë¦¬ì',
  'super_admin',
  true,
  'IEPON',
    </div>

    <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
    <div 
      x-show="error" 
      x-transition
      class="error-message mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded"
    >
      <div class="flex justify-between items-center">
        <span x-text="error"></span>
        <button 
          @click="clearError"
          class="ml-2 text-red-500 hover:text-red-700 font-bold"
        >
          Ã—
        </button>
      </div>
    </div>

    <!-- ë¡œë”© ìƒíƒœ -->
    <div x-show="loading" class="loading-overlay fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50">
      <div class="loading-spinner">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
        <p class="mt-2 text-gray-600">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>

    <!-- í†µê³„ ì¹´ë“œ ì„¹ì…˜ -->
    <div class="statistics-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <!-- í™œì„± ì‚¬ìš©ì ìˆ˜ -->
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
          <div class="stat-icon bg-blue-100 text-blue-600 p-3 rounded-lg">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"></path>
            </svg>
          </div>
          <div class="ml-4">
            <p class="stat-value text-2xl font-bold text-gray-800" x-text="statistics.activeUsers || 0"></p>
            <p class="stat-label text-sm text-gray-600">í™œì„± ì‚¬ìš©ì</p>
          </div>
        </div>
      </div>

      <!-- ì´ í•™ìƒ ìˆ˜ -->
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
          <div class="stat-icon bg-green-100 text-green-600 p-3 rounded-lg">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
            </svg>
          </div>
          <div class="ml-4">
            <p class="stat-value text-2xl font-bold text-gray-800" x-text="statistics.totalStudents || 0"></p>
            <p class="stat-label text-sm text-gray-600">ë“±ë¡ í•™ìƒ ìˆ˜</p>
          </div>
        </div>
      </div>

      <!-- ì´ ê²°ì œ ê¸ˆì•¡ -->
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
          <div class="stat-icon bg-yellow-100 text-yellow-600 p-3 rounded-lg">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
            </svg>
          </div>
          <div class="ml-4">
            <p class="stat-value text-2xl font-bold text-gray-800" x-text="formatCurrency(statistics.totalPayments || 0)"></p>
            <p class="stat-label text-sm text-gray-600">ì´ ê²°ì œ ê¸ˆì•¡</p>
          </div>
        </div>
      </div>

      <!-- í™œì„± ë¼ì´ì„ ìŠ¤ -->
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
          <div class="stat-icon bg-purple-100 text-purple-600 p-3 rounded-lg">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
          </div>
          <div class="ml-4">
            <p class="stat-value text-2xl font-bold text-gray-800" x-text="statistics.activeLicenses || 0"></p>
            <p class="stat-label text-sm text-gray-600">í™œì„± ë¼ì´ì„ ìŠ¤</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ê´€ë¦¬ ë©”ë‰´ ì„¹ì…˜ -->
    <div class="management-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      <!-- ì‚¬ìš©ì ê´€ë¦¬ -->
      <div class="management-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center mb-4">
          <div class="icon bg-blue-100 text-blue-600 p-3 rounded-lg">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"></path>
            </svg>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-gray-800">ì‚¬ìš©ì ê´€ë¦¬</h3>
        </div>
        <p class="text-gray-600 mb-4">ì‚¬ìš©ì ê³„ì •, ê¶Œí•œ, í”„ë¡œí•„ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
        <button 
          @click="navigateTo('/admin/users')"
          class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors"
        >
          ê´€ë¦¬í•˜ê¸°
        </button>
      </div>

      <!-- í•™ìƒ ê´€ë¦¬ -->
      <div class="management-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center mb-4">
          <div class="icon bg-green-100 text-green-600 p-3 rounded-lg">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
            </svg>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-gray-800">í•™ìƒ ê´€ë¦¬</h3>
        </div>
        <p class="text-gray-600 mb-4">í•™ìƒ ì •ë³´, êµìœ¡ê³¼ì • ë°°ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
        <button 
          @click="navigateTo('/admin/students')"
          class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors"
        >
          ê´€ë¦¬í•˜ê¸°
        </button>
      </div>

      <!-- ì‹œìŠ¤í…œ ì„¤ì • -->
      <div class="management-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center mb-4">
          <div class="icon bg-gray-100 text-gray-600 p-3 rounded-lg">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.107 1.204l.527.738c.32.447.27 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.27-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-gray-800">ì‹œìŠ¤í…œ ì„¤ì •</h3>
        </div>
        <p class="text-gray-600 mb-4">ì‹œìŠ¤í…œ í™˜ê²½ ì„¤ì •, ë³´ì•ˆ ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
        <button 
          @click="navigateTo('/admin/settings')"
          class="w-full bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-700 transition-colors"
        >
          ì„¤ì •í•˜ê¸°
        </button>
      </div>
    </div>

    <!-- ìµœê·¼ í™œë™ ë¡œê·¸ -->
    <div class="activity-log bg-white rounded-lg shadow-md p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">ìµœê·¼ í™œë™</h3>
      <div x-show="activityLogs.length === 0" class="text-center text-gray-500 py-8">
        í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
      </div>
      <div x-show="activityLogs.length > 0" class="space-y-3">
        <template x-for="(log, index) in activityLogs.slice(0, 10)" :key="log.id">
          <div class="activity-item flex items-center p-3 bg-gray-50 rounded">
            <div class="activity-icon mr-3">
              <span x-text="getActivityIcon(log.action)"></span>
            </div>
            <div class="activity-content flex-1">
              <p class="text-sm text-gray-800" x-text="log.description"></p>
              <p class="text-xs text-gray-500" x-text="formatDateTime(log.created_at)"></p>
            </div>
            <div class="activity-user">
              <span class="text-xs text-gray-600" x-text="log.user_name || 'ì‹œìŠ¤í…œ'"></span>
            </div>
          </div>
        </template>
      </div>
      <button 
        @click="navigateTo('/admin/activity-logs')"
        class="mt-4 w-full text-center text-blue-600 hover:text-blue-800 text-sm"
      >
        ì „ì²´ í™œë™ ë¡œê·¸ ë³´ê¸°
      </button>
    </div>
  </div>

  <script>
  function adminDashboard() {
    return {
      // ìƒíƒœ ê´€ë¦¬
      statistics: {
        activeUsers: 0,
        totalStudents: 0,
        totalPayments: 0,
        activeLicenses: 0
      },
      activityLogs: [],
      loading: false,
      error: '',
      lastUpdated: '',
      
      async init() {
        await this.checkAdminPermission();
        await this.loadDashboardData();
        this.setupAutoRefresh();
      },
      
      async checkAdminPermission() {
        try {
          const user = Alpine.store('auth').user;
          if (!user) {
            window.location.href = '/auth/login.html';
            return;
          }
          
          const profile = await Alpine.store('auth').getProfile();
          if (!profile || !['admin', 'super_admin'].includes(profile.role) || !profile.is_active) {
            window.location.href = '/dashboard.html';
            return;
          }
        } catch (error) {
          console.error('ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨:', error);
          this.error = 'ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        }
      },
      
      async loadDashboardData() {
        this.loading = true;
        try {
          await Promise.all([
            this.loadStatistics(),
            this.loadActivityLogs()
          ]);
          this.lastUpdated = this.formatDateTime(new Date().toISOString());
        } catch (error) {
          console.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
          this.error = 'ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        } finally {
          this.loading = false;
        }
      },
      
      async loadStatistics() {
        try {
          const response = await fetch('/functions/v1/admin/statistics', {
            headers: {
              'Authorization': `Bearer ${Alpine.store('auth').token}`,
              'Content-Type': 'application/json'
            }
          });
          
          const result = await response.json();
          if (result.success) {
            this.statistics = result.data;
          }
        } catch (error) {
          console.error('í†µê³„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        }
      },
      
      async loadActivityLogs() {
        try {
          const response = await fetch('/functions/v1/admin/activity-logs?limit=10', {
            headers: {
              'Authorization': `Bearer ${Alpine.store('auth').token}`,
              'Content-Type': 'application/json'
            }
          });
          
          const result = await response.json();
          if (result.success) {
            // UTF-8 ì¸ì½”ë”© ê²€ì¦
            this.activityLogs = (result.data || []).filter(log => {
              if (log.description && !this.isValidUTF8(log.description)) {
                console.warn('ì¸ì½”ë”© ë¬¸ì œê°€ ìˆëŠ” í™œë™ ë¡œê·¸:', log);
                return false;
              }
              return true;
            });
          }
        } catch (error) {
          console.error('í™œë™ ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:', error);
        }
      },
      
      setupAutoRefresh() {
        // 5ë¶„ë§ˆë‹¤ ìë™ ê°±ì‹ 
        setInterval(() => {
          this.loadStatistics();
        }, 5 * 60 * 1000);
      },
      
      async refreshAll() {
        await this.loadDashboardData();
        Alpine.store('toast').show('ëŒ€ì‹œë³´ë“œê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      },
      
      clearError() {
        this.error = '';
      },
      
      navigateTo(path) {
        window.location.href = path;
      },
      
      formatCurrency(amount) {
        return new Intl.NumberFormat('ko-KR', {
          style: 'currency',
          currency: 'KRW'
        }).format(amount);
      },
      
      formatDateTime(dateString) {
        const date = new Date(dateString);
        return new Intl.DateTimeFormat('ko-KR', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        }).format(date);
      },
      
      getActivityIcon(action) {
        const icons = {
          'login': 'ğŸ”‘',
          'logout': 'ğŸšª',
          'create': 'â•',
          'update': 'âœï¸',
          'delete': 'ğŸ—‘ï¸',
          'payment': 'ğŸ’³',
          'system': 'âš™ï¸'
        };
        return icons[action] || 'ğŸ“';
      },
      
      isValidUTF8(str) {
        try {
          return str === decodeURIComponent(encodeURIComponent(str));
        } catch {
          return false;
        }
      }
    };
import { NextApiRequest, NextApiResponse } from 'next';
import { createServerSupabaseClient } from '@supabase/auth-helpers-nextjs';
import { adminAuthMiddleware } from '@/middleware/adminAuth';

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  // ê¶Œí•œ ê²€ì‚¬
  const authResult = await adminAuthMiddleware(req);
  if (authResult.error) {
    return res.status(authResult.status).json({ error: authResult.error });
  }

  const supabase = createServerSupabaseClient({ req, res });

  switch (req.method) {
    case 'GET':
      return handleGetUsers(req, res, supabase);
    case 'POST':
      return handleCreateUser(req, res, supabase);
    default:
      return res.status(405).json({ error: 'Method not allowed' });
  }
}

async function handleGetUsers(req: NextApiRequest, res: NextApiResponse, supabase: any) {
  try {
    const { 
      page = 1, 
      limit = 20, 
      search = '', 
      role = 'all',
      status = 'all' 
    } = req.query;

    let query = supabase
      .from('user_profiles')
      .select('*', { count: 'exact' })
      .order('created_at', { ascending: false });

    // ê²€ìƒ‰ í•„í„°
    if (search) {
      query = query.or(`full_name.ilike.%${search}%,email.ilike.%${search}%`);
    }

    // ì—­í•  í•„í„°
    if (role !== 'all') {
      query = query.eq('role', role);
    }

    // ìƒíƒœ í•„í„°
    if (status !== 'all') {
      query = query.eq('is_active', status === 'active');
    }

    // í˜ì´ì§€ë„¤ì´ì…˜
    const offset = (Number(page) - 1) * Number(limit);
    query = query.range(offset, offset + Number(limit) - 1);

    const { data, count, error } = await query;

    if (error) throw error;

    return res.status(200).json({
      success: true,
      data,
      pagination: {
        page: Number(page),
        limit: Number(limit),
        total: count,
        totalPages: Math.ceil((count || 0) / Number(limit))
      }
    });
  } catch (error: any) {
    return res.status(500).json({ 
      success: false, 
      error: error.message 
    });
  }
}
```

### 11.9.4 ì‹œìŠ¤í…œ ì„¤ì • ê´€ë¦¬
```typescript
// pages/api/admin/system-settings/[key].ts
import { NextApiRequest, NextApiResponse } from 'next';
import { createServerSupabaseClient } from '@supabase/auth-helpers-nextjs';

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const { key } = req.query;
  const supabase = createServerSupabaseClient({ req, res });

  // super_admin ê¶Œí•œ í•„ìš”
  const { data: { session } } = await supabase.auth.getSession();
  if (!session) {
    return res.status(401).json({ error: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤' });
  }

  const { data: profile } = await supabase
    .from('user_profiles')
    .select('role')
    .eq('id', session.user.id)
    .single();

  if (profile?.role !== 'super_admin') {
    return res.status(403).json({ error: 'ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤' });
  }

  switch (req.method) {
    case 'GET':
      return handleGetSetting(key as string, supabase, res);
    case 'PATCH':
      return handleUpdateSetting(key as string, req.body, supabase, res);
    default:
      return res.status(405).json({ error: 'Method not allowed' });
  }
}

async function handleUpdateSetting(
  key: string,
  body: any,
  supabase: any,
  res: NextApiResponse
) {
  try {
    const { value } = body;
    
    const { data, error } = await supabase
      .from('system_settings')
      .update({ 
        setting_value: value,
        updated_at: new Date().toISOString()
      })
      .eq('setting_key', key)
      .select()
      .single();

    if (error) throw error;

    // ì„¤ì • ë³€ê²½ ë¡œê·¸ ê¸°ë¡
    await supabase.from('admin_activity_logs').insert({
      action: 'system_setting_updated',
      details: { setting_key: key, new_value: value },
      created_at: new Date().toISOString()
    });

    return res.status(200).json({ success: true, data });
  } catch (error: any) {
    return res.status(500).json({ 
      success: false, 
      error: error.message 
    });
  }
}
```

### 11.9.5 ì•Œë¦¼ ì‹œìŠ¤í…œ ê°œë°œ
```typescript
// lib/notifications/manager.ts
import { createServerSupabaseClient } from '@supabase/auth-helpers-nextjs';

export class NotificationManager {
  private supabase: any;

  constructor(supabase: any) {
    this.supabase = supabase;
  }

  // ì „ì²´ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ ë°œì†¡
  async sendToAll(notification: {
    title: string;
    message: string;
    type: 'info' | 'warning' | 'error' | 'success';
  }) {
    try {
      const { data: users } = await this.supabase
        .from('user_profiles')
        .select('id')
        .eq('is_active', true);

      const notifications = users.map((user: any) => ({
        user_id: user.id,
        title: notification.title,
        message: notification.message,
        type: notification.type,
        is_read: false,
        created_at: new Date().toISOString()
      }));

      const { error } = await this.supabase
        .from('notifications')
        .insert(notifications);

      if (error) throw error;

      return { success: true, count: notifications.length };
    } catch (error) {
      console.error('ì•Œë¦¼ ë°œì†¡ ì˜¤ë¥˜:', error);
      return { success: false, error };
    }
  }

  // íŠ¹ì • ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ ë°œì†¡
  async sendToUser(
    userId: string,
    notification: {
      title: string;
      message: string;
      type: 'info' | 'warning' | 'error' | 'success';
    }
  ) {
    try {
      const { error } = await this.supabase
        .from('notifications')
        .insert({
          user_id: userId,
          title: notification.title,
          message: notification.message,
          type: notification.type,
          is_read: false,
          created_at: new Date().toISOString()
        });

      if (error) throw error;
      return { success: true };
    } catch (error) {
      console.error('ì•Œë¦¼ ë°œì†¡ ì˜¤ë¥˜:', error);
      return { success: false, error };
    }
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
export async function sendMaintenanceNotification() {
  const supabase = createServerSupabaseClient({});
  const notificationManager = new NotificationManager(supabase);
  
  await notificationManager.sendToAll({
    title: 'ì‹œìŠ¤í…œ ì ê²€ ì•Œë¦¼',
    message: 'ì˜¤ëŠ˜ ë°¤ 2ì‹œë¶€í„° 4ì‹œê¹Œì§€ ì‹œìŠ¤í…œ ì ê²€ì´ ì˜ˆì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.',
    type: 'warning'
  });
}
```

### 11.9.6 ê´€ë¦¬ì ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ë°±ì—”ë“œ ê°œë°œ
- [ ] ê´€ë¦¬ì ê³„ì • ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
- [ ] ê´€ë¦¬ì ê¶Œí•œ ë¯¸ë“¤ì›¨ì–´
- [ ] ì‚¬ìš©ì ê´€ë¦¬ API êµ¬í˜„
- [ ] ì‹œìŠ¤í…œ ì„¤ì • API êµ¬í˜„
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ API êµ¬í˜„
- [ ] ë¡œê·¸ì¸ ê¸°ë¡ API êµ¬í˜„
- [ ] í†µê³„ ë°ì´í„° API êµ¬í˜„

#### í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ
- [ ] ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í˜ì´ì§€
- [ ] ì‚¬ìš©ì ê´€ë¦¬ í˜ì´ì§€
- [ ] ì‹œìŠ¤í…œ ì„¤ì • í˜ì´ì§€
- [ ] ì•Œë¦¼ ì„¼í„° ì»´í¬ë„ŒíŠ¸
- [ ] ë¡œê·¸ì¸ ê¸°ë¡ ë·°ì–´
- [ ] Zustand ìŠ¤í† ì–´ ì—°ë™
- [ ] ë¦¬ì–¼íƒ€ì„ ì—…ë°ì´íŠ¸ ì²˜ë¦¬

#### ë³´ì•ˆ ë° í…ŒìŠ¤íŠ¸
- [ ] ê¶Œí•œ ë³„ ì ‘ê³„ ì œí•œ í…ŒìŠ¤íŠ¸
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ë³´ì•ˆ í…ŒìŠ¤íŠ¸
- [ ] ë¡œê·¸ì¸ ê¸°ë¡ ë° ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (ëŒ€ìš©ëŸ‰ ë°ì´í„°)

#### ë°°í¬ ë° ìš´ì˜
- [ ] ê´€ë¦¬ì í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] ë³´ì•ˆ ì„¤ì • ì ìš©
- [ ] ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ì„¤ì •
- [ ] ë°±ì—… ë° ë³µêµ¬ ë°©ì¹¨
- [ ] ìš´ì˜ ë§¤ë‰´ì–¼ ì‘ì„±

---

## ğŸ”— **ê´€ë ¨ ë¬¸ì„œ**

- **[08_í™˜ê²½_ì„¤ì •.md](./08_í™˜ê²½_ì„¤ì •.md)**: ê°œë°œ í™˜ê²½ ìƒì„¸ ì„¤ì •
- **[11_ë°°í¬_ê°€ì´ë“œ.md](./11_ë°°í¬_ê°€ì´ë“œ.md)**: ë°°í¬ í”„ë¡œì„¸ìŠ¤
- **[10_ë³´ì•ˆ_ê¶Œí•œ.md](./10_ë³´ì•ˆ_ê¶Œí•œ.md)**: ë³´ì•ˆ ê°œë°œ ê°€ì´ë“œë¼ì¸
- **[README.md](./README.md)**: í”„ë¡œì íŠ¸ ì „ì²´ ê°€ì´ë“œ

---

## ğŸ†˜ **ë¬¸ì œ í•´ê²° ê°€ì´ë“œ**

### ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œë“¤

#### 1. Supabase ì—°ê²° ì˜¤ë¥˜
```bash
# í•´ê²° ë°©ë²•
supabase status
supabase start
# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
```

#### 2. ë¹Œë“œ ì˜¤ë¥˜
```bash
# ìºì‹œ ì‚­ì œ í›„ ì¬ë¹Œë“œ
rm -rf .next
pnpm clean
pnpm install
pnpm build
```

#### 3. íƒ€ì… ì˜¤ë¥˜
```bash
# íƒ€ì… ì •ì˜ ì¬ìƒì„±
supabase gen types typescript --project-id your-project > src/types/database.ts
```

#### 4. ê¶Œí•œ ì˜¤ë¥˜
```sql
-- RLS ì •ì±… í™•ì¸
SELECT * FROM pg_policies WHERE tablename = 'students';
-- ì‚¬ìš©ì ì—­í•  í™•ì¸
SELECT auth.jwt() ->> 'role' as user_role;
```

---

## 11.10 êµìœ¡ê³¼ì • ì‹œìŠ¤í…œ êµ¬í˜„ ê°€ì´ë“œ

### 11.10.1 êµìœ¡ê³¼ì • í…Œì´ë¸” ìƒì„±
```sql
-- curriculum_units í…Œì´ë¸” ìƒì„±
CREATE TABLE curriculum_units (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  subject VARCHAR(20) NOT NULL CHECK (subject IN ('êµ­ì–´', 'ìˆ˜í•™')),
  grade_level VARCHAR(10) NOT NULL CHECK (grade_level IN ('1í•™ë…„', '2í•™ë…„', '3í•™ë…„', '4í•™ë…„', '5í•™ë…„', '6í•™ë…„')),
  semester VARCHAR(10) NOT NULL CHECK (semester IN ('1í•™ê¸°', '2í•™ê¸°')),
  unit_number INTEGER NOT NULL,
  unit_name VARCHAR(200) NOT NULL,
  learning_objectives TEXT[] NOT NULL,
  achievement_standards TEXT[],
  learning_contents TEXT[] NOT NULL,
  key_concepts TEXT[],
  assessment_plan TEXT,
  evaluation_methods TEXT[],
  evaluation_criteria TEXT[],
  version VARCHAR(20) DEFAULT '1.0',
  is_active BOOLEAN DEFAULT true,
  created_by UUID REFERENCES auth.users(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(subject, grade_level, semester, unit_number)
);
```

### 11.10.2 API ë¼ìš°íŠ¸ êµ¬í˜„
```typescript
// pages/api/curriculum-units/index.ts
import { NextApiRequest, NextApiResponse } from 'next';
import { createServerSupabaseClient } from '@supabase/auth-helpers-nextjs';
import { getCurriculumUnits, createCurriculumUnit } from '@/lib/curriculum';

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  const supabase = createServerSupabaseClient({ req, res });
  
  try {
    if (req.method === 'GET') {
      const { subject, grade_level, semester, is_active } = req.query;
      const result = await getCurriculumUnits(supabase, {
        subject: subject as string,
        grade_level: grade_level as string,
        semester: semester as string,
        is_active: is_active === 'true'
      });
      
      if (result.success) {
        res.status(200).json(result);
      } else {
        res.status(400).json(result);
      }
    }
    
    else if (req.method === 'POST') {
      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
      const { data: user } = await supabase.auth.getUser();
      if (!user?.user || user.user.user_metadata?.role !== 'super_admin') {
        return res.status(403).json({ error: 'ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.' });
      }
      
      const result = await createCurriculumUnit(supabase, req.body);
      
      if (result.success) {
        res.status(201).json(result);
      } else {
        res.status(400).json(result);
      }
    }
    
    else {
      res.setHeader('Allow', ['GET', 'POST']);
      res.status(405).end(`Method ${req.method} Not Allowed`);
    }
  } catch (error) {
    res.status(500).json({ error: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' });
  }
}
```

### 11.10.3 Excel ì—…ë¡œë“œ ì²˜ë¦¬
```typescript
// pages/api/curriculum-units/upload.ts
import { NextApiRequest, NextApiResponse } from 'next';
import multer from 'multer';
import xlsx from 'xlsx';
import { validateCurriculumData } from '@/lib/curriculum-validation';

const upload = multer({
  storage: multer.memoryStorage(),
  limits: {
    fileSize: parseInt(process.env.CURRICULUM_UPLOAD_MAX_SIZE || '10485760') // 10MB
  },
  fileFilter: (req, file, cb) => {
    if (file.mimetype === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') {
      cb(null, true);
    } else {
      cb(new Error('Excel íŒŒì¼(.xlsx)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'));
    }
  }
});

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'POST ë©”ì†Œë“œë§Œ í—ˆìš©ë©ë‹ˆë‹¤.' });
  }

  try {
    // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
    upload.single('file')(req as any, res as any, async (err) => {
      if (err) {
        return res.status(400).json({ error: err.message });
      }

      const file = (req as any).file;
      if (!file) {
        return res.status(400).json({ error: 'íŒŒì¼ì´ ì—…ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' });
      }

      // Excel íŒŒì¼ íŒŒì‹±
      const workbook = xlsx.read(file.buffer, { type: 'buffer' });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const jsonData = xlsx.utils.sheet_to_json(worksheet, { header: 1 });

      // ë°ì´í„° ê²€ì¦ ë° ë³€í™˜
      const validationResult = await validateCurriculumData(jsonData);
      
      if (!validationResult.success) {
        return res.status(400).json({
          error: 'ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨',
          details: validationResult.errors
        });
      }

      // ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
      const uploadResult = await processCurriculumUpload(validationResult.data);
      
      res.status(200).json({
        success: true,
        data: uploadResult
      });
    });
  } catch (error) {
    res.status(500).json({ error: 'íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' });
  }
}

export const config = {
  api: {
    bodyParser: false,
  },
};
```

### 11.10.4 Alpine.js ê¸°ë°˜ êµìœ¡ê³¼ì • ê´€ë¦¬
```html
<!-- admin/curriculum.html -->
<div x-data="curriculumManagement()" x-init="init()" class="curriculum-container p-8">
  <!-- í—¤ë” -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">êµìœ¡ê³¼ì • ê´€ë¦¬</h1>
    <div class="flex space-x-3">
      <button @click="showUpload = true" class="btn-primary">ğŸ“„ Excel ì—…ë¡œë“œ</button>
      <button @click="openUnitEditor(null)" class="btn-secondary">â• ë‹¨ì› ì¶”ê°€</button>
    </div>
  </div>

  <!-- ê²€ìƒ‰ -->
  <div class="search-section mb-6">
    <input 
      type="text" 
      x-model="searchQuery"
      @input.debounce.500ms="searchUnits"
      placeholder="ë‹¨ì›ëª…ìœ¼ë¡œ ê²€ìƒ‰..."
      class="w-full px-4 py-2 border rounded-md"
    >
  </div>

  <!-- ë‹¨ì› ë¦¬ìŠ¤íŠ¸ -->
  <div class="units-list bg-white rounded-lg shadow-sm border">
    <template x-for="unit in filteredUnits" :key="unit.id">
      <div class="unit-item border-b p-4 hover:bg-gray-50" @click="openUnitEditor(unit)">
        <h4 class="font-semibold" x-text="unit.name"></h4>
        <div class="flex space-x-2 mt-2">
          <span class="badge" x-text="unit.grade"></span>
          <span class="badge" x-text="unit.subject"></span>
        </div>
        <div class="flex justify-end space-x-2 mt-3">
          <button @click.stop="openUnitEditor(unit)" class="btn-edit">í¸ì§‘</button>
          <button @click.stop="confirmDelete(unit)" class="btn-delete">ì‚­ì œ</button>
        </div>
      </div>
    </template>
  </div>

  <!-- Excel ì—…ë¡œë“œ ëª¨ë‹¬ -->
  <div x-show="showUpload" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
      <h3 class="text-lg font-semibold mb-4">Excel íŒŒì¼ ì—…ë¡œë“œ</h3>
      <input type="file" accept=".xlsx,.xls" @change="handleFileUpload($event.target.files[0])" class="mb-4">
      <div class="flex justify-end space-x-2">
        <button @click="showUpload = false" class="btn-cancel">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <!-- ë‹¨ì› í¸ì§‘ ëª¨ë‹¬ -->
  <div x-show="editingUnit" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-lg w-full mx-4">
      <h3 class="text-lg font-semibold mb-4" x-text="editingUnit?.id ? 'ë‹¨ì› ìˆ˜ì •' : 'ìƒˆ ë‹¨ì› ì¶”ê°€'"></h3>
      <form @submit.prevent="saveUnit">
        <div class="grid grid-cols-2 gap-4 mb-4">
          <input type="text" x-model="unitForm.name" placeholder="ë‹¨ì›ëª…" required class="input">
          <select x-model="unitForm.grade" required class="input">
            <option value="">í•™ë…„ ì„ íƒ</option>
            <option value="elementary">ì´ˆë“±í•™êµ</option>
            <option value="middle">ì¤‘í•™êµ</option>
            <option value="high">ê³ ë“±í•™êµ</option>
          </select>
        </div>
        <div class="flex justify-end space-x-2">
          <button type="button" @click="editingUnit = null" class="btn-cancel">ì·¨ì†Œ</button>
          <button type="submit" class="btn-primary">ì €ì¥</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function curriculumManagement() {
  return {
    units: [],
    filteredUnits: [],
    loading: false,
    error: '',
    searchQuery: '',
    showUpload: false,
    editingUnit: null,
    unitForm: { name: '', grade: '', subject: '' },
    
    init() {
      this.loadUnits();
    },
    
    async loadUnits() {
      this.loading = true;
      try {
        const response = await fetch('/functions/v1/curriculum', {
          headers: { 'Authorization': `Bearer ${Alpine.store('auth').token}` }
        });
        const result = await response.json();
        if (result.success) {
          this.units = result.data;
          this.filteredUnits = this.units;
        }
      } catch (error) {
        this.error = 'êµìœ¡ê³¼ì • ë¡œë“œ ì‹¤íŒ¨';
      } finally {
        this.loading = false;
      }
    },
    
    searchUnits() {
      this.filteredUnits = this.units.filter(unit => 
        unit.name.toLowerCase().includes(this.searchQuery.toLowerCase())
      );
    },
    
    openUnitEditor(unit) {
      this.editingUnit = unit || {};
      this.unitForm = unit ? { ...unit } : { name: '', grade: '', subject: '' };
    },
    
    async saveUnit() {
      try {
        const url = this.editingUnit.id ? 
          `/functions/v1/curriculum/${this.editingUnit.id}` : 
          '/functions/v1/curriculum';
        const method = this.editingUnit.id ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method,
          headers: {
            'Authorization': `Bearer ${Alpine.store('auth').token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(this.unitForm)
        });
        
        if (response.ok) {
          Alpine.store('toast').show('ë‹¨ì›ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
          this.editingUnit = null;
          this.loadUnits();
        }
      } catch (error) {
        Alpine.store('toast').show('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
      }
    },
    
    async handleFileUpload(file) {
      if (!file) return;
      
      try {
        const formData = new FormData();
        formData.append('file', file);
        
        const response = await fetch('/functions/v1/curriculum/upload', {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${Alpine.store('auth').token}` },
          body: formData
        });
        
        if (response.ok) {
          Alpine.store('toast').show('ì—…ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
          this.showUpload = false;
          this.loadUnits();
        }
      } catch (error) {
        Alpine.store('toast').show('ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
      }
    }
  };
}
    </div>
  );
}
```

### 11.10.5 ë°ì´í„° ê²€ì¦ ë¡œì§
```javascript
// public/js/curriculum-validation.js

/**
 * @typedef {Object} CurriculumValidationResult
 * @property {boolean} success - ê²€ì¦ ì„±ê³µ ì—¬ë¶€
 * @property {Array} data - ê²€ì¦ëœ êµìœ¡ê³¼ì • ë‹¨ì› ë°ì´í„° ë°°ì—´ (ì„±ê³µ ì‹œ)
 * @property {Array} errors - ê²€ì¦ ì˜¤ë¥˜ ëª©ë¡ (ì‹¤íŒ¨ ì‹œ)
 */

/**
 * @typedef {Object} ValidationError  
 * @property {number} row - ì˜¤ë¥˜ê°€ ë°œìƒí•œ í–‰ ë²ˆí˜¸
 * @property {string} field - ì˜¤ë¥˜ê°€ ë°œìƒí•œ í•„ë“œëª…
 * @property {string} message - ì˜¤ë¥˜ ë©”ì‹œì§€
 */

/**
 * êµìœ¡ê³¼ì • Excel ë°ì´í„° ê²€ì¦ í•¨ìˆ˜
 * @param {Array<Array>} rawData - Excelì—ì„œ ì½ì–´ì˜¨ ì›ì‹œ ë°ì´í„° ë°°ì—´
 * @returns {Promise<CurriculumValidationResult>} ê²€ì¦ ê²°ê³¼
 */
export async function validateCurriculumData(rawData) {
  // UTF-8 ì¸ì½”ë”© ì•ˆì „ì„± ê²€ì¦
  const validateUTF8 = (text) => {
    try {
      const encoded = new TextEncoder().encode(text);
      const decoded = new TextDecoder('utf-8', { fatal: true }).decode(encoded);
      return decoded === text;
    } catch (error) {
      return false;
    }
  };
  
  const errors = [];
  const validatedData = [];
  
  // í—¤ë” í™•ì¸ (ì²« ë²ˆì§¸ í–‰)
  const expectedHeaders = ['êµê³¼', 'í•™ë…„', 'í•™ê¸°', 'ë‹¨ì›ë²ˆí˜¸', 'ë‹¨ì›ëª…', 'êµìœ¡ëª©í‘œ(ì„±ì·¨ê¸°ì¤€)', 'êµìœ¡ë‚´ìš©', 'í‰ê°€ê³„íš'];
  const headers = rawData[0] || [];
  
  // í—¤ë” UTF-8 ì•ˆì „ì„± ê²€ì¦
  for (let i = 0; i < headers.length; i++) {
    if (typeof headers[i] === 'string' && !validateUTF8(headers[i])) {
      errors.push({
        row: 1,
        field: `header_${i}`,
        message: `í—¤ë” ${i + 1}ë²ˆì§¸ ì—´ì˜ UTF-8 ì¸ì½”ë”©ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.`
      });
    }
  }
  
  if (!expectedHeaders.every((header, index) => headers[index] === header)) {
    errors.push({
      row: 1,
      field: 'headers',
      message: 'í—¤ë”ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. í…œí”Œë¦¿ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ í™•ì¸í•˜ì„¸ìš”.'
    });
    return { success: false, errors };
  }
  
  // ë°ì´í„° í–‰ ê²€ì¦ (ë‘ ë²ˆì§¸ í–‰ë¶€í„°)
  for (let i = 1; i < rawData.length; i++) {
    const row = rawData[i] as string[];
    const rowNum = i + 1;
    
    // í•„ìˆ˜ í•„ë“œ ê²€ì¦
    const [subject, gradeLevel, semester, unitNumber, unitName, objectives, contents, assessment] = row;
    
    if (!subject || !['êµ­ì–´', 'ìˆ˜í•™'].includes(subject)) {
      errors.push({ row: rowNum, field: 'êµê³¼', message: 'êµ­ì–´ ë˜ëŠ” ìˆ˜í•™ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.' });
    }
    
    if (!gradeLevel || !['1í•™ë…„', '2í•™ë…„', '3í•™ë…„', '4í•™ë…„', '5í•™ë…„', '6í•™ë…„'].includes(gradeLevel)) {
      errors.push({ row: rowNum, field: 'í•™ë…„', message: '1í•™ë…„~6í•™ë…„ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.' });
    }
    
    if (!semester || !['1í•™ê¸°', '2í•™ê¸°'].includes(semester)) {
      errors.push({ row: rowNum, field: 'í•™ê¸°', message: '1í•™ê¸° ë˜ëŠ” 2í•™ê¸°ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.' });
    }
    
    if (!unitNumber || isNaN(parseInt(unitNumber))) {
      errors.push({ row: rowNum, field: 'ë‹¨ì›ë²ˆí˜¸', message: 'ë‹¨ì›ë²ˆí˜¸ëŠ” ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.' });
    }
    
    if (!unitName || unitName.length < 2 || unitName.length > 200) {
      errors.push({ row: rowNum, field: 'ë‹¨ì›ëª…', message: 'ë‹¨ì›ëª…ì€ 2~200ìì—¬ì•¼ í•©ë‹ˆë‹¤.' });
    }
    
    if (!objectives) {
      errors.push({ row: rowNum, field: 'êµìœ¡ëª©í‘œ', message: 'êµìœ¡ëª©í‘œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.' });
    }
    
    if (!contents) {
      errors.push({ row: rowNum, field: 'êµìœ¡ë‚´ìš©', message: 'êµìœ¡ë‚´ìš©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.' });
    }
    
    // ì˜¤ë¥˜ê°€ ì—†ìœ¼ë©´ ë°ì´í„° ì¶”ê°€
    if (errors.filter(e => e.row === rowNum).length === 0) {
      validatedData.push({
        subject: subject as 'êµ­ì–´' | 'ìˆ˜í•™',
        grade_level: gradeLevel as string,
        semester: semester as '1í•™ê¸°' | '2í•™ê¸°',
        unit_number: parseInt(unitNumber),
        unit_name: unitName,
        learning_objectives: objectives.split('\n').filter(obj => obj.trim()),
        learning_contents: contents.split('\n').filter(content => content.trim()),
        assessment_plan: assessment || ''
      });
    }
  }
  
  if (errors.length > 0) {
    return { success: false, errors };
  }
  
  return { success: true, data: validatedData };
}
```

### 11.10.6 ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ë°±ì—”ë“œ ê°œë°œ
- [ ] curriculum_units í…Œì´ë¸” ìƒì„± ë° ì¸ë±ìŠ¤ ì„¤ì •
- [ ] RLS ì •ì±… ì„¤ì •
- [ ] API ë¼ìš°íŠ¸ êµ¬í˜„ (CRUD)
- [ ] Excel ì—…ë¡œë“œ ì²˜ë¦¬ ë¡œì§
- [ ] ë°ì´í„° ê²€ì¦ ë¡œì§
- [ ] ì—ëŸ¬ í•¸ë“¤ë§

#### í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ
- [ ] êµìœ¡ê³¼ì • ê´€ë¦¬ í˜ì´ì§€ êµ¬í˜„
- [ ] CurriculumList ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- [ ] CurriculumUpload ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- [ ] CurriculumUnitEditor ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- [ ] Zustand ìŠ¤í† ì–´ ì—°ë™
- [ ] ë¡œë”© ìƒíƒœ ë° ì—ëŸ¬ ì²˜ë¦¬

#### í…ŒìŠ¤íŠ¸
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
- [ ] Excel ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
- [ ] ê¶Œí•œ í…ŒìŠ¤íŠ¸
SELECT raw_user_meta_data FROM auth.users WHERE email = 'user@example.com';
```

---

## 11.8 AI í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë° í’ˆì§ˆ ê´€ë¦¬

### 11.8.1 ê°œë³„í™”êµìœ¡ ê³„íš ìƒì„± í”„ë¡¬í”„íŠ¸
```typescript
// ê°œë³„í™”êµìœ¡ ê³„íš ìƒì„± í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
export const EDUCATION_PLAN_PROMPT = `
ë‹¹ì‹ ì€ íŠ¹ìˆ˜êµìœ¡ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°œë³„í™”êµìœ¡ ê³„íšì„ ì‘ì„±í•´ì£¼ì„¸ìš”.

**í•™ìƒ ì •ë³´:**
- ì´ë¦„: {{studentName}}
- ë‚˜ì´: {{studentAge}}
- ì¥ì•  ìœ í˜•: {{disabilityType}}
- í•™ë…„: {{grade}}

**í˜„í–‰ìˆ˜ì¤€:**
{{currentLevels}}

**êµìœ¡ê³¼ì • ì •ë³´:**
- ê³¼ëª©: {{subject}}
- ë‹¨ì›: {{unit}}
- ì„±ì·¨ê¸°ì¤€: {{standards}}
- êµìœ¡ë‚´ìš©: {{content}}

**êµì‚¬ ì„ í˜¸ë„:**
- êµìœ¡ì² í•™: {{philosophy}}
- ì„ í˜¸ êµìˆ˜ë²•: {{methods}}
- ë¬¸ì²´: {{formality}}

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”:

1. **êµìœ¡ëª©í‘œ** (êµ¬ì²´ì ì´ê³  ì¸¡ì • ê°€ëŠ¥í•œ ëª©í‘œ)
2. **êµìˆ˜ë°©ë²•** (ë‹¤ì–‘í•œ êµìˆ˜ì „ëµ 3-5ê°œ)
3. **í‰ê°€ê³„íš** (í‰ê°€ ë°©ë²• ë° ê¸°ì¤€)
4. **ê°œë³„í™” ì „ëµ** (í•™ìƒ íŠ¹ì„±ì— ë§ëŠ” ì „ëµ)

ì „ë¬¸ì ì´ê³  ì‹¤ìš©ì ì¸ ë‚´ìš©ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
`;

// í•™êµì¥ ì˜ê²¬ì„œ ìƒì„± í”„ë¡¬í”„íŠ¸
export const SCHOOL_OPINION_PROMPT = `
ë‹¹ì‹ ì€ íŠ¹ìˆ˜êµìœ¡ ì „ë¬¸ê°€ì´ì í•™êµì¥ì…ë‹ˆë‹¤. ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ {{opinionType}} ì˜ê²¬ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

**í•™ìƒ ì •ë³´:**
{{studentInfo}}

**í˜„í–‰ìˆ˜ì¤€ í‰ê°€:**
{{currentLevels}}

**êµìœ¡ê³„íš ë° ì„±ê³¼:**
{{educationPlans}}

**ì˜ê²¬ì„œ ìœ í˜•:** {{opinionType}}

ë‹¤ìŒ êµ¬ì„±ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”:

1. **í•™ìƒ í˜„í™© ìš”ì•½**
2. **êµìœ¡ì  ìš”êµ¬ ë¶„ì„**
3. **ì§€ì› ë°©ì•ˆ ë° ë°°ì¹˜ ì˜ê²¬**
4. **ê¸°ëŒ€ íš¨ê³¼ ë° ì„±ê³¼**
5. **ê²°ë¡  ë° ì¶”ì²œ ì‚¬í•­**

ê³µì‹ì ì´ê³  ì „ë¬¸ì ì¸ ì–´ì¡°ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
`;

// ìƒë‹´ ê°€ì´ë“œ ìƒì„± í”„ë¡¬í”„íŠ¸
export const COUNSELING_GUIDE_PROMPT = `
ë‹¹ì‹ ì€ íŠ¹ìˆ˜êµìœ¡ ìƒë‹´ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ {{counselingType}} ìƒë‹´ ê°€ì´ë“œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

**í•™ìƒ ì •ë³´:**
{{studentInfo}}

**í˜„ì¬ ìƒí™©:**
{{currentSituation}}

**ì£¼ìš” ê´€ì‹¬ì‚¬í•­:**
{{focusAreas}}

**ìƒë‹´ ìœ í˜•:** {{counselingType}}

ë‹¤ìŒ êµ¬ì„±ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”:

1. **ìƒë‹´ ëª©í‘œ ë° ë°©í–¥**
2. **ì£¼ìš” ìƒë‹´ í¬ì¸íŠ¸** (5-7ê°œ)
3. **êµ¬ì²´ì  ìƒë‹´ ì „ëµ** (3-5ê°œ)
4. **ì˜ˆìƒ ì§ˆë¬¸ ë° ëŒ€ì‘ ë°©ì•ˆ**
5. **í›„ì† ì¡°ì¹˜ ë° ì§€ì› ë°©ì•ˆ**

ì‹¤ìš©ì ì´ê³  ê³µê°ëŒ€ë¥¼ í˜•ì„±í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
`;
```

### 11.8.2 AI ì‘ë‹µ í›„ì²˜ë¦¬ ë° í’ˆì§ˆ ê²€ì¦
```typescript
// AI ì‘ë‹µ í›„ì²˜ë¦¬ í•¨ìˆ˜
export async function processAIResponse(
  response: string,
  type: 'education_plan' | 'opinion' | 'counseling' | 'admin_doc',
  context: any
): Promise<{
  processed: string;
  confidence: number;
  warnings: string[];
  suggestions: string[];
}> {
  const warnings: string[] = [];
  const suggestions: string[] = [];
  
  // 1. ê¸°ë³¸ í’ˆì§ˆ ê²€ì¦
  const qualityScore = await validateContentQuality(response);
  
  // 2. ì „ë¬¸ì„± ê²€ì¦
  const professionalScore = await validateProfessionalContent(response, type);
  
  // 3. ì ì ˆì„± ê²€ì¦
  const appropriatenessScore = await validateEducationalAppropriateness(response, context);
  
  // 4. ì „ì²´ ì‹ ë¢°ë„ ê³„ì‚°
  const confidence = (qualityScore + professionalScore + appropriatenessScore) / 3;
  
  // 5. ê²½ê³  ë° ì œì•ˆ ì‚¬í•­ ìƒì„±
  if (confidence < 0.8) {
    warnings.push('ìƒì„±ëœ ë‚´ìš©ì˜ ì‹ ë¢°ë„ê°€ ë‚®ìŠµë‹ˆë‹¤. ê²€í†  í›„ ì‚¬ìš©í•˜ì„¸ìš”.');
  }
  
  if (qualityScore < 0.7) {
    suggestions.push('ë‚´ìš©ì„ ë” êµ¬ì²´ì ì´ê³  ì²´ê³„ì ìœ¼ë¡œ ìˆ˜ì •í•´ë³´ì„¸ìš”.');
  }
  
  return {
    processed: response,
    confidence,
    warnings,
    suggestions
  };
}

// ë‚´ìš© í’ˆì§ˆ ê²€ì¦
async function validateContentQuality(content: string): Promise<number> {
  let score = 1.0;
  
  // ê¸¸ì´ ê²€ì¦
  if (content.length < 200) score -= 0.2;
  if (content.length > 5000) score -= 0.1;
  
  // êµ¬ì¡° ê²€ì¦
  const hasStructure = /\d+\.|\*\*|###/.test(content);
  if (!hasStructure) score -= 0.2;
  
  // ì „ë¬¸ ìš©ì–´ ê²€ì¦
  const specialEducationTerms = ['ê°œë³„í™”', 'íŠ¹ìˆ˜êµìœ¡', 'ì„±ì·¨ê¸°ì¤€', 'í‰ê°€'];
  const hasTerms = specialEducationTerms.some(term => content.includes(term));
  if (!hasTerms) score -= 0.1;
  
  return Math.max(0, score);
}

// ì „ë¬¸ì„± ê²€ì¦
async function validateProfessionalContent(
  content: string, 
  type: string
): Promise<number> {
  let score = 1.0;
  
  const requiredElements = {
    education_plan: ['êµìœ¡ëª©í‘œ', 'êµìˆ˜ë°©ë²•', 'í‰ê°€'],
    opinion: ['í˜„í™©', 'ì˜ê²¬', 'ì¶”ì²œ'],
    counseling: ['ìƒë‹´', 'ì „ëµ', 'ë°©ì•ˆ'],
    admin_doc: ['ìš”ì•½', 'ë¶„ì„', 'ê²°ë¡ ']
  };
  
  const required = requiredElements[type as keyof typeof requiredElements] || [];
  const missingElements = required.filter(element => !content.includes(element));
  
  score -= missingElements.length * 0.2;
  
  return Math.max(0, score);
}

// êµìœ¡ì  ì ì ˆì„± ê²€ì¦
async function validateEducationalAppropriateness(
  content: string,
  context: any
): Promise<number> {
  let score = 1.0;
  
  // ë‚˜ì´ ì ì ˆì„± ê²€ì¦
  if (context.studentAge) {
    const age = parseInt(context.studentAge);
    if (age < 7 && content.includes('ê³ ë“±í•™êµ')) score -= 0.3;
    if (age > 15 && content.includes('ìœ ì¹˜ì›')) score -= 0.3;
  }
  
  // ì¥ì•  ìœ í˜• ì ì ˆì„± ê²€ì¦
  if (context.disabilityType) {
    const inappropriate = [
      { disability: 'ì§€ì ì¥ì• ', avoid: ['ê³ ë“±ìˆ˜í•™', 'ì¶”ìƒì  ì‚¬ê³ '] },
      { disability: 'ìíì„±ì¥ì• ', avoid: ['ëŒ€ì§‘ë‹¨ í™œë™', 'ì†ŒìŒ í™˜ê²½'] }
    ];
    
    inappropriate.forEach(item => {
      if (context.disabilityType.includes(item.disability)) {
        item.avoid.forEach(term => {
          if (content.includes(term)) score -= 0.2;
        });
      }
    });
  }
  
  return Math.max(0, score);
}
```

### 11.8.3 AI ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë¡œì§
```typescript
// AI API ì˜¤ë¥˜ ì²˜ë¦¬
export async function handleAIError(
  error: any,
  requestData: any,
  retryCount: number = 0
): Promise<any> {
  const maxRetries = parseInt(process.env.AI_RETRY_COUNT || '3');
  
  // ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ì‹œ ë°±ì—… ëª¨ë¸ ì‚¬ìš©
  if (retryCount >= maxRetries) {
    console.log('ë°±ì—… ëª¨ë¸ë¡œ ì „í™˜:', process.env.AI_BACKUP_MODEL);
    return await callBackupModel(requestData);
  }
  
  // ì˜¤ë¥˜ ìœ í˜•ë³„ ì²˜ë¦¬
  if (error.code === 'rate_limit_exceeded') {
    // ì†ë„ ì œí•œ ì‹œ ëŒ€ê¸° í›„ ì¬ì‹œë„
    await new Promise(resolve => setTimeout(resolve, 2000 * (retryCount + 1)));
    return await retryAIRequest(requestData, retryCount + 1);
  }
  
  if (error.code === 'context_length_exceeded') {
    // ì»¨í…ìŠ¤íŠ¸ ê¸¸ì´ ì´ˆê³¼ ì‹œ ë‚´ìš© ìš”ì•½
    const summarizedData = await summarizeRequestData(requestData);
    return await retryAIRequest(summarizedData, retryCount + 1);
  }
  
  // ê¸°íƒ€ ì˜¤ë¥˜ ì‹œ ì¬ì‹œë„
  return await retryAIRequest(requestData, retryCount + 1);
}

// ë°±ì—… ëª¨ë¸ í˜¸ì¶œ
async function callBackupModel(requestData: any): Promise<any> {
  try {
    const response = await openai.chat.completions.create({
      model: process.env.AI_BACKUP_MODEL || 'gpt-3.5-turbo',
      messages: requestData.messages,
      max_tokens: 1500, // ë°±ì—… ëª¨ë¸ì€ ë” ì§§ê²Œ
      temperature: 0.5
    });
    
    return {
      content: response.choices[0].message.content,
      confidence: 0.6, // ë°±ì—… ëª¨ë¸ì€ ë‚®ì€ ì‹ ë¢°ë„
      isBackupModel: true
    };
  } catch (backupError) {
    throw new Error('ë°±ì—… ëª¨ë¸ë„ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
}
```
